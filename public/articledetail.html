<!DOCTYPE html>
<!-- saved from url=(0022)https://www.zhihu.com/ -->
<html lang="zh" data-hairline="true" data-theme="light" data-react-helmet="data-theme">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>(4 条消息) 首页 - 知乎</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg">
    <meta name="description" property="og:description"
        content="有问题，上知乎。知乎，可信赖的问答社区，以让每个人高效获得可信赖的解答为使命。知乎凭借认真、专业和友善的社区氛围，结构化、易获得的优质内容，基于问答的内容生产方式和独特的社区机制，吸引、聚集了各行各业中大量的亲历者、内行人、领域专家、领域爱好者，将高质量的内容透过人的节点来成规模地生产和分享。用户通过问答等交流方式建立信任和连接，打造和提升个人影响力，并发现、获得新机会。">
    <link data-react-helmet="true" rel="apple-touch-icon"
        href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.67c7b278.png">
    <link data-react-helmet="true" rel="apple-touch-icon"
        href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.67c7b278.png" sizes="152x152">
    <link data-react-helmet="true" rel="apple-touch-icon"
        href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.b3e6278d.png" sizes="120x120">
    <link data-react-helmet="true" rel="apple-touch-icon"
        href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.7a750095.png" sizes="76x76">
    <link data-react-helmet="true" rel="apple-touch-icon"
        href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.a4a761d4.png" sizes="60x60">
    <link rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/static/favicon.ico">
    <link rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/static/search.xml"
        title="知乎">
    <link rel="dns-prefetch" href="https://static.zhimg.com/">
    <link rel="dns-prefetch" href="https://pic1.zhimg.com/">
    <link rel="dns-prefetch" href="https://pic2.zhimg.com/">
    <link rel="dns-prefetch" href="https://pic3.zhimg.com/">
    <link rel="dns-prefetch" href="https://pic4.zhimg.com/">
    <style>
        .u-safeAreaInset-top {
            height: constant(safe-area-inset-top) !important;
            height: env(safe-area-inset-top) !important;

        }

        .u-safeAreaInset-bottom {
            height: constant(safe-area-inset-bottom) !important;
            height: env(safe-area-inset-bottom) !important;

        }
    </style>
    <link href="./(4 条消息) 首页 - 知乎_files/main.app.216a26f4.de59ebd0e93730a354bc.css" rel="stylesheet">
    <link href="./(4 条消息) 首页 - 知乎_files/main.topstory-routes.216a26f4.7793d96df0d47afa6662.css" rel="stylesheet">
    <script defer="" crossorigin="anonymous" src="./(4 条消息) 首页 - 知乎_files/init.js.下载"
        data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;1504-ac5965f1&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrors&quot;:[&quot;origin message&quot;,&quot;Network request failed&quot;,&quot;Loading chunk&quot;,&quot;这个系统不支持该功能。&quot;,&quot;Can&#39;t find variable: webkit&quot;,&quot;Can&#39;t find variable: $&quot;,&quot;内存不足&quot;,&quot;out of memory&quot;,&quot;DOM Exception 18&quot;,&quot;The operation is insecure&quot;,&quot;[object Event]&quot;,&quot;[object FileError]&quot;,&quot;[object DOMError]&quot;,&quot;[object Object]&quot;,&quot;拒绝访问。&quot;,&quot;Maximum call stack size exceeded&quot;,&quot;UploadError&quot;,&quot;无法 fetch&quot;,&quot;draft-js&quot;,&quot;缺少 JavaScript 对象&quot;,&quot;componentWillEnter&quot;,&quot;componentWillLeave&quot;,&quot;componentWillAppear&quot;,&quot;getInlineStyleAt&quot;,&quot;getCharacterList&quot;],&quot;whitelistUrls&quot;:[&quot;static.zhihu.com&quot;]}"></script>
    <style data-emotion-css="qqgmyv">
        .css-qqgmyv {
            width: auto;
            max-width: 1156px;
            min-width: 1000px;
            padding-left: 16px;
            padding-right: 30px;
        }

        .css-qqgmyv .AppHeader-userInfo {
            margin-left: 30px;
            width: auto;
        }

        .css-qqgmyv .AppHeader-TabsLink.is-active,
        .css-qqgmyv .AppHeader-TabsLink:hover {
            color: #121212;
        }
    </style>
    <style data-emotion-css="g0ay3v">
        .css-g0ay3v {
            margin-left: 25px;
            margin-right: 15px;
        }

        .css-g0ay3v .AppHeader-Tab {
            padding-left: 15px;
            padding-right: 15px;
        }

        .css-g0ay3v .Tabs-link.is-active::after {
            height: 4px;
        }
    </style>
    <style data-emotion-css="1acwmmj">
        .css-1acwmmj {
            box-sizing: border-box;
            margin: 0;
            min-width: 0;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -ms-flex-pack: center;
            justify-content: center;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
        }
    </style>
    <style data-emotion-css="10fy1q8">
        .css-10fy1q8 {
            max-width: 482px;
        }

        .css-10fy1q8 .SearchBar-input {
            border-radius: 999px;
            padding-left: 16px;
        }

        .css-10fy1q8 .SearchBar-askButton {
            border-radius: 999px;
            width: 70px;
            margin-left: 12px;
        }

        .css-10fy1q8 .SearchBar-searchButton {
            border-bottom-right-radius: 999px;
            border-top-right-radius: 999px;
        }
    </style>
    <style data-emotion-css="79elbk">
        .css-79elbk {
            position: relative;
        }
    </style>
    <style data-emotion-css="520aav">
        .css-520aav {
            font-size: 0;
            margin: 10px 10px -4px;
        }
    </style>
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.zswsdid.c67f49680846c9a6fd83.js.下载"></script>
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.mqtt.78b5c5e181129dedf9a0.js.下载"></script>
    <link rel="stylesheet" type="text/css"
        href="./(4 条消息) 首页 - 知乎_files/main.navbar-notifications.216a26f4.495b1690099cbe8bcf2f.css">
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.navbar-notifications.2372918ac6cefb985010.js.下载"></script>
    <link rel="stylesheet" type="text/css"
        href="./(4 条消息) 首页 - 知乎_files/main.navbar-messages.216a26f4.f7f700be891f6ff673c9.css">
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.navbar-messages.35dc949e01ce7d83fc24.js.下载"></script>
    <link rel="stylesheet" type="text/css" href="./(4 条消息) 首页 - 知乎_files/main.modals.216a26f4.4b643811a6edb83c8bba.css">
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.modals.5792dade716d39d4bfeb.js.下载"></script>
    <style data-emotion="css"></style>
    <link rel="stylesheet" type="text/css"
        href="./(4 条消息) 首页 - 知乎_files/main.user-hover-card.216a26f4.fe90e390ebd65fdbdbbb.css">
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.user-hover-card.bcecee546211e4273a89.js.下载"></script>
    <link rel="stylesheet" type="text/css" href="./(4 条消息) 首页 - 知乎_files/main.Labels.216a26f4.a3003dd6b44afdec8a72.css">
    <script charset="utf-8" src="./(4 条消息) 首页 - 知乎_files/main.Labels.112d850e323c32f427db.js.下载"></script>
</head>

<body class="Topstory-body Topstory-body--old" style="overflow: auto;" data-react-helmet="class">
    <div id="root">
        <div>
            <div class="LoadingBar"></div>
            <div>
                <header role="banner" class="Sticky AppHeader is-hidden is-fixed" data-za-module="TopNavBar"
                    style="width: 100%; top: 0px;">
                    <div class="AppHeader-inner css-qqgmyv"><a class="ZhihuLogoLink" href="https://www.zhihu.com/"
                            aria-label="知乎"><svg viewBox="0 0 200 91" fill="#0084FF" width="64" height="30">
                                <path
                                    d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z"
                                    fill-rule="evenodd"></path>
                            </svg></a>
                        <ul role="navigation" class="Tabs AppHeader-Tabs css-g0ay3v">
                            <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
                                    class="Tabs-link AppHeader-TabsLink is-active" href="https://www.zhihu.com/"
                                    data-za-not-track-link="true">首页</a></li>
                            <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
                                    class="Tabs-link AppHeader-TabsLink" href="https://www.zhihu.com/xen/vip-web"
                                    data-za-not-track-link="true">会员</a></li>
                            <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
                                    class="Tabs-link AppHeader-TabsLink" href="https://www.zhihu.com/explore"
                                    data-za-not-track-link="true">发现</a></li>
                            <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
                                    class="Tabs-link AppHeader-TabsLink" href="https://www.zhihu.com/question/waiting"
                                    data-za-not-track-link="true">等你来答</a></li>
                        </ul>
                        <div class="css-1acwmmj">
                            <div class="SearchBar AppHeader-SearchBar css-10fy1q8" role="search"
                                data-za-module="PresetWordItem">
                                <form class="SearchBar-tool">
                                    <div>
                                        <div class="Popover"><label
                                                class="SearchBar-input Input-wrapper Input-wrapper--grey"><input
                                                    type="text" maxlength="100" autocomplete="off" role="combobox"
                                                    aria-expanded="false" aria-autocomplete="list"
                                                    aria-activedescendant="AutoComplete2--1" id="Popover1-toggle"
                                                    aria-haspopup="true" aria-owns="Popover1-content" class="Input"
                                                    placeholder="河北新增 82 例本土确诊 " value=""><button aria-label="搜索"
                                                    type="button"
                                                    class="Button SearchBar-searchButton Button--primary"><span
                                                        style="display: inline-flex; align-items: center;">​<svg
                                                            class="Zi Zi--Search SearchBar-searchIcon"
                                                            fill="currentColor" viewBox="0 0 24 24" width="18"
                                                            height="18">
                                                            <path
                                                                d="M17.068 15.58a8.377 8.377 0 0 0 1.774-5.159 8.421 8.421 0 1 0-8.42 8.421 8.38 8.38 0 0 0 5.158-1.774l3.879 3.88c.957.573 2.131-.464 1.488-1.49l-3.879-3.878zm-6.647 1.157a6.323 6.323 0 0 1-6.316-6.316 6.323 6.323 0 0 1 6.316-6.316 6.323 6.323 0 0 1 6.316 6.316 6.323 6.323 0 0 1-6.316 6.316z"
                                                                fill-rule="evenodd"></path>
                                                        </svg></span></button></label></div>
                                    </div>
                                </form><button type="button"
                                    class="Button SearchBar-askButton Button--primary Button--blue">提问</button>
                            </div>
                        </div>
                        <div class="AppHeader-userInfo">
                            <div class="Popover"><button aria-label="4条通知" id="Popover17-toggle" aria-haspopup="true"
                                    aria-expanded="false" aria-owns="Popover17-content" type="button"
                                    class="Button AppHeader-notifications css-79elbk Button--plain"><span
                                        style="display: inline-flex; align-items: center;">​<svg class="Zi Zi--Bell"
                                            fill="currentColor" viewBox="0 0 24 24" width="22" height="22">
                                            <path
                                                d="M4.523 15.076l.804-6.757a6.753 6.753 0 0 1 4.945-5.7 1.823 1.823 0 0 1 3.623 0 6.753 6.753 0 0 1 4.945 5.7l.804 6.757a2.293 2.293 0 0 0 1.712 2.108 1.093 1.093 0 0 1-.297 2.15H3.108a1.093 1.093 0 0 1-.297-2.15 2.293 2.293 0 0 0 1.712-2.108zM12.083 23a2.758 2.758 0 0 1-2.753-2.509.229.229 0 0 1 .232-.24h5.043a.229.229 0 0 1 .232.24 2.759 2.759 0 0 1-2.753 2.51z">
                                            </path>
                                        </svg></span>
                                    <div class="css-ybodb">4</div>
                                </button></div>
                            <div>
                                <div class="Popover"><button aria-label="私信" id="Popover18-toggle" aria-haspopup="true"
                                        aria-expanded="false" aria-owns="Popover18-content" type="button"
                                        class="Button AppHeader-messages css-79elbk Button--plain"><span
                                            style="display: inline-flex; align-items: center;">​<svg
                                                class="Zi Zi--Comments" fill="currentColor" viewBox="0 0 24 24"
                                                width="22" height="22">
                                                <path
                                                    d="M11 2c5.571 0 9 4.335 9 8 0 6-6.475 9.764-11.481 8.022-.315-.07-.379-.124-.78.078-1.455.54-2.413.921-3.525 1.122-.483.087-.916-.25-.588-.581 0 0 .677-.417.842-1.904.064-.351-.14-.879-.454-1.171A8.833 8.833 0 0 1 2 10c0-3.87 3.394-8 9-8zm10.14 9.628c.758.988.86 2.009.86 3.15 0 1.195-.619 3.11-1.368 3.938-.209.23-.354.467-.308.722.12 1.073.614 1.501.614 1.501.237.239-.188.562-.537.5-.803-.146-1.495-.42-2.546-.811-.29-.146-.336-.106-.563-.057-2.043.711-4.398.475-6.083-.927 5.965-.524 8.727-3.03 9.93-8.016z"
                                                    fill-rule="evenodd"></path>
                                            </svg></span></button></div>
                            </div>
                            <div class="AppHeader-profile">
                                <div class="Popover AppHeader-menu"><button id="Popover15-toggle" aria-haspopup="true"
                                        aria-expanded="false" aria-owns="Popover15-content" type="button"
                                        class="Button AppHeader-profileEntry Button--plain"><img
                                            class="Avatar AppHeader-profileAvatar AppHeader-profileAvatar--old"
                                            width="30" height="30" src="./(4 条消息) 首页 - 知乎_files/da8e974dc_is.jpg"
                                            srcset="https://pic3.zhimg.com/da8e974dc_im.jpg 2x"></button></div>
                                <div class="Popover AppHeaderProfileMenu-creatorHintPopover">
                                    <div class="AppHeaderProfileMenu-creatorHintToggler" id="Popover16-toggle"
                                        aria-haspopup="true" aria-expanded="false" aria-owns="Popover16-content"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="PageHeader is-shown">
                            <div class="TopstoryPageHeader css-1kjxdzv">
                                <div class="TopstoryPageHeader-main css-tfoxxs">
                                    <div class="css-nxq4uo"><a class="ZhihuLogoLink" href="https://www.zhihu.com/"
                                            aria-label="知乎"><svg viewBox="0 0 200 91" fill="#0084FF" width="64"
                                                height="30">
                                                <path
                                                    d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z"
                                                    fill-rule="evenodd"></path>
                                            </svg></a>
                                        <nav class="TopstoryTabs TopstoryPageHeader-tabs"><a
                                                aria-controls="Topstory-recommend"
                                                class="TopstoryTabs-link TopstoryPageHeader-tabsLink is-active"
                                                data-za-detail-view-id="9122"
                                                data-za-extra="{&quot;button&quot;:{&quot;text&quot;:&quot;推荐&quot;}}"
                                                href="https://www.zhihu.com/">推荐</a><a aria-controls="Topstory-follow"
                                                class="TopstoryTabs-link TopstoryPageHeader-tabsLink"
                                                data-za-detail-view-id="9122"
                                                data-za-extra="{&quot;button&quot;:{&quot;text&quot;:&quot;关注&quot;}}"
                                                href="https://www.zhihu.com/follow">关注</a><a
                                                aria-controls="Topstory-hot"
                                                class="TopstoryTabs-link TopstoryPageHeader-tabsLink"
                                                data-za-detail-view-id="9122"
                                                data-za-extra="{&quot;button&quot;:{&quot;text&quot;:&quot;热榜&quot;}}"
                                                href="https://www.zhihu.com/hot">热榜</a></nav>
                                    </div>
                                </div>
                                <div class="css-1u8pbev"></div>
                                <div class="TopstoryPageHeader-aside css-1xgntgp">
                                    <form class="SimpleSearchBar-wrapper"><label
                                            class="SimpleSearchBar-input css-he33ld Input-wrapper"><input class="Input"
                                                placeholder="搜索你感兴趣的内容…" value=""><button type="button"
                                                class="Button SimpleSearchBar-plainSearchButton Button--primary"><span
                                                    style="display: inline-flex; align-items: center;">​<svg
                                                        class="Zi Zi--Search" fill="currentColor" viewBox="0 0 24 24"
                                                        width="18" height="18">
                                                        <path
                                                            d="M17.068 15.58a8.377 8.377 0 0 0 1.774-5.159 8.421 8.421 0 1 0-8.42 8.421 8.38 8.38 0 0 0 5.158-1.774l3.879 3.88c.957.573 2.131-.464 1.488-1.49l-3.879-3.878zm-6.647 1.157a6.323 6.323 0 0 1-6.316-6.316 6.323 6.323 0 0 1 6.316-6.316 6.323 6.323 0 0 1 6.316 6.316 6.323 6.323 0 0 1-6.316 6.316z"
                                                            fill-rule="evenodd"></path>
                                                    </svg></span></button></label></form><button type="button"
                                        class="Button TopstoryPageHeader-askButton css-ie8gsr Button--primary Button--blue">提问</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
                <div class="Sticky--holder"
                    style="position: relative; inset: 0px; display: block; float: none; margin: 0px; height: 52px;">
                </div>
            </div>
            <main role="main" class="App-main">
                <div class="Topstory Topstory--old">
                    <div class="Topstory-container">
                        <div class="Topstory-mainColumn">
                            <div class="Topstory-mainColumnCard">
                                <div class="Card Topstory-noMarginCard Topstory-tabCard">
                                    <nav class="TopstoryTabs Topstory-tabs"><a aria-controls="Topstory-recommend"
                                            class="TopstoryTabs-link Topstory-tabsLink is-active"
                                            data-za-detail-view-id="9122"
                                            data-za-extra="{&quot;button&quot;:{&quot;text&quot;:&quot;推荐&quot;}}"
                                            href="https://www.zhihu.com/">推荐</a><a aria-controls="Topstory-follow"
                                            class="TopstoryTabs-link Topstory-tabsLink" data-za-detail-view-id="9122"
                                            data-za-extra="{&quot;button&quot;:{&quot;text&quot;:&quot;关注&quot;}}"
                                            href="https://www.zhihu.com/follow">关注</a><a aria-controls="Topstory-hot"
                                            class="TopstoryTabs-link Topstory-tabsLink" data-za-detail-view-id="9122"
                                            data-za-extra="{&quot;button&quot;:{&quot;text&quot;:&quot;热榜&quot;}}"
                                            href="https://www.zhihu.com/hot">热榜</a></nav>
                                    <div>
                                        <div class="Sticky is-fixed" style="width: 694px; top: 52px; left: 451.5px;">
                                        </div>
                                        <div class="Sticky--holder"
                                            style="position: static; inset: auto; display: block; float: none; margin: 0px; height: 0px;">
                                        </div>
                                    </div>
                                </div>
                                <div id="TopstoryContent" class="Topstory-content">
                                    <div class="ListShortcut">
                                        <div class="Topstory-recommend" data-zop-feedlistfather="0">
                                            <div class="">
                                                <div class="Card TopstoryItem TopstoryItem--old TopstoryItem-isRecommend"
                                                    tabindex="0">
                                                    <div class="Feed" data-za-detail-view-path-module="FeedItem"
                                                        data-za-detail-view-path-index="0"
                                                        data-za-extra-module="{&quot;card&quot;:{&quot;card_type&quot;:&quot;Feed&quot;,&quot;feed_id&quot;:&quot;0_1610348810.215&quot;,&quot;has_image&quot;:false,&quot;has_video&quot;:false,&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;311184005&quot;}},&quot;attached_info_bytes&quot;:&quot;CvwCCMicxf7ilp/k/QEQBxoJMTU3MjgxNjkyIOCD9/0FKLIDMBhAAEoNCgRGUkZSEgEwGAAgAEoNCgRJQ0NPEgEwGAAgAFISZmVlZHJlX2FkZF9hcnRpY2xlWgcxMTIyNDI0cgkzMTExODQwMDV4AYIBUGh0dHBzOi8vcGljNC56aGltZy5jb20vdjItZWI2YjBmNWI3NGQyYmZmNTQxY2E2MjAxOTIyMTRiNzRfci5qcGc/c291cmNlPTE3MmFlMThiigEHbXVzaWNmZaoBCXJlY29tbWVuZPIBNQgAEjFydzowLjA7aXNvOjAuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJGVhY2Y4M2Q4LWIxYzgtNGU4OC1hOGNiLWUzMTIyYzZjZTUxN4gC9J+Tgu8ukgIgNGZlYWQwMjQxMzc3ZDM3ODc4NWY0NGFjNjhhMjcwNjWaAgA=&quot;}">
                                                        <div class="ContentItem ArticleItem"
                                                            data-zop="{&quot;authorName&quot;:&quot;云音乐前端技术团队&quot;,&quot;itemId&quot;:311184005,&quot;title&quot;:&quot;如何基于 TypeScript 实现控制反转&quot;,&quot;type&quot;:&quot;article&quot;}"
                                                            itemprop="article"
                                                            itemtype="http://schema.org/SocialMediaPosting" itemscope=""
                                                            data-za-detail-view-path-module="PostItem"
                                                            data-za-extra-module="{&quot;card&quot;:{&quot;has_image&quot;:false,&quot;has_video&quot;:false,&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;311184005&quot;,&quot;upvote_num&quot;:434,&quot;comment_num&quot;:24,&quot;publish_timestamp&quot;:1606271456000,&quot;parent_token&quot;:&quot;musicfe&quot;,&quot;author_member_hash_id&quot;:&quot;4fead0241377d378785f44ac68a27065&quot;}}}">
                                                            <h2 class="ContentItem-title"><a
                                                                    href="https://zhuanlan.zhihu.com/p/311184005"
                                                                    target="_blank" rel="noopener noreferrer"
                                                                    data-za-detail-view-element_name="Title"
                                                                    data-za-detail-view-id="2812">如何基于 TypeScript
                                                                    实现控制反转</a></h2>
                                                            <div class="ContentItem-meta">
                                                                <div class="AuthorInfo ArticleItem-authorInfo AuthorInfo--plain"
                                                                    itemprop="author" itemscope=""
                                                                    itemtype="http://schema.org/Person">
                                                                    <meta itemprop="name" content="云音乐前端技术团队">
                                                                    <meta itemprop="image"
                                                                        content="https://pic1.zhimg.com/50/v2-d100bfe808a6f97e061c34788691a3e2_m.jpg">
                                                                    <meta itemprop="url"
                                                                        content="https://www.zhihu.com/people/yun-yin-le-qian-duan-ji-zhu-tuan-dui">
                                                                    <meta itemprop="zhihu:followerCount"><span
                                                                        class="UserLink AuthorInfo-avatarWrapper">
                                                                        <div class="Popover">
                                                                            <div id="Popover34-toggle"
                                                                                aria-haspopup="true"
                                                                                aria-expanded="false"
                                                                                aria-owns="Popover34-content"><a
                                                                                    class="UserLink-link"
                                                                                    data-za-detail-view-element_name="User"
                                                                                    target="_blank"
                                                                                    href="https://www.zhihu.com/org/yun-yin-le-qian-duan-ji-zhu-tuan-dui"><img
                                                                                        class="Avatar AuthorInfo-avatar"
                                                                                        width="24" height="24"
                                                                                        src="./(4 条消息) 首页 - 知乎_files/v2-d100bfe808a6f97e061c34788691a3e2_s.jpg"
                                                                                        srcset="https://pic1.zhimg.com/50/v2-d100bfe808a6f97e061c34788691a3e2_xs.jpg 2x"
                                                                                        alt="云音乐前端技术团队"></a></div>
                                                                        </div>
                                                                    </span>
                                                                    <div class="AuthorInfo-content">
                                                                        <div class="AuthorInfo-head"><span
                                                                                class="UserLink AuthorInfo-name">
                                                                                <div class="Popover">
                                                                                    <div id="Popover35-toggle"
                                                                                        aria-haspopup="true"
                                                                                        aria-expanded="false"
                                                                                        aria-owns="Popover35-content"><a
                                                                                            class="UserLink-link"
                                                                                            data-za-detail-view-element_name="User"
                                                                                            target="_blank"
                                                                                            href="https://www.zhihu.com/org/yun-yin-le-qian-duan-ji-zhu-tuan-dui">云音乐前端技术团队</a>
                                                                                    </div>
                                                                                </div><a
                                                                                    href="https://www.zhihu.com/question/48510028"
                                                                                    target="_blank" class="css-n99yhz"
                                                                                    aria-label="已认证的官方帐号"
                                                                                    data-tooltip="已认证的官方帐号"><span
                                                                                        class="css-g9eqf4-StrutAlign">​<svg
                                                                                            viewBox="0 0 24 24"
                                                                                            class="css-svsrxm-Octangle"
                                                                                            width="18" height="18"><svg
                                                                                                viewBox="0 0 24 24"
                                                                                                x="-3" y="-3"
                                                                                                fill="#FFFFFF"
                                                                                                width="30" height="30">
                                                                                                <path
                                                                                                    d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z">
                                                                                                </path>
                                                                                            </svg>
                                                                                            <path
                                                                                                d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z"
                                                                                                fill="#0084FF"></path>
                                                                                            <svg class="Zi Zi--Check"
                                                                                                fill="#fff" x="6" y="6"
                                                                                                viewBox="0 0 24 24"
                                                                                                width="12" height="12">
                                                                                                <path
                                                                                                    d="M10.229 17.516c-.318.327-.75.484-1.199.484-.453 0-.884-.16-1.202-.488l-4.335-4.47a1.77 1.77 0 0 1 .007-2.459 1.663 1.663 0 0 1 2.397.01l3.137 3.246 9.072-9.329a1.662 1.662 0 0 1 2.397 0c.663.681.663 1.786 0 2.466L10.23 17.516z"
                                                                                                    fill-rule="evenodd">
                                                                                                </path>
                                                                                            </svg>
                                                                                        </svg></span></a>
                                                                            </span></div>
                                                                        <div class="AuthorInfo-detail">
                                                                            <div class="AuthorInfo-badge">
                                                                                <div class="AuthorInfo-badgeText">
                                                                                    已认证的官方帐号</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <meta itemprop="headline" content="如何基于 TypeScript 实现控制反转">
                                                            <meta itemprop="url"
                                                                content="//zhuanlan.zhihu.com/p/311184005">
                                                            <meta itemprop="datePublished"
                                                                content="2020-11-25T02:30:56.000Z">
                                                            <meta itemprop="dateModified"
                                                                content="2020-11-25T02:30:56.000Z">
                                                            <meta itemprop="commentCount" content="24">
                                                            <meta itemprop="image"
                                                                content="https://pic4.zhimg.com/50/v2-eb6b0f5b74d2bff541ca620192214b74_hd.jpg">
                                                            <div class="LabelContainer-wrapper"></div>
                                                            <div class="RichContent">
                                                                <div>
                                                                    <div class="ArticleItem-extraInfo"><span
                                                                            class="Voters"><button type="button"
                                                                                class="Button Button--plain">434
                                                                                人赞同了该文章</button></span></div><img
                                                                        class="ArticleItem-image"
                                                                        src="./(4 条消息) 首页 - 知乎_files/v2-eb6b0f5b74d2bff541ca620192214b74_hd.jpg"
                                                                        alt="如何基于 TypeScript 实现控制反转">
                                                                </div>
                                                                <div class="RichContent-inner"><span
                                                                        class="RichText ztext CopyrightRichText-richText"
                                                                        itemprop="articleBody">
                                                                        <blockquote>图片来源：<a
                                                                                href="https://link.zhihu.com/?target=https%3A//bz.zzzmh.cn/"
                                                                                class=" external" target="_blank"
                                                                                rel="nofollow noreferrer"
                                                                                data-za-detail-view-id="1043"><span
                                                                                    class="invisible">https://</span><span
                                                                                    class="visible">bz.zzzmh.cn/</span><span
                                                                                    class="invisible"></span></a><br>本文作者：陈光通
                                                                        </blockquote>
                                                                        <h2><b>一. 前言</b></h2>
                                                                        <p>最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS
                                                                            框架，在这个过程中参考了 <a
                                                                                href="https://link.zhihu.com/?target=https%3A//docs.nestjs.com/"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer"
                                                                                data-za-detail-view-id="1043">NestJS</a>
                                                                            、<a href="https://link.zhihu.com/?target=https%3A//midwayjs.org/midway/ioc.html"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer"
                                                                                data-za-detail-view-id="1043">Midway</a>
                                                                            等开源项目，发现它们都引入了一项重要特性 —— IoC ，于是笔者借这个机会对 IoC
                                                                            进行了一些学习和梳理。本文主要参考了 Midway 的源码，按自己的理解基于
                                                                            TypeScript 实现了 IoC，希望能给大家提供一些参考。</p>
                                                                        <h2><b>二. IoC</b></h2>
                                                                        <p>按照<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E6%258E%25A7%25E5%2588%25B6%25E5%258F%258D%25E8%25BD%25AC"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer"
                                                                                data-za-detail-view-id="1043">维基百科</a>，IoC（Inversion
                                                                            of
                                                                            Control）控制反转，是面向对象编程中的一种设计原则，用来降低计算机代码之间的耦合度。
                                                                        </p>
                                                                        <p>在传统面向对象的编码过程中，当类与类之间存在依赖关系时，通常会直接在类的内部创建依赖对象，这样就导致类与类之间形成了耦合，依赖关系越复杂，耦合程度就会越高，而耦合度高的代码会非常难以进行修改和单元测试。而
                                                                            IoC
                                                                            则是专门提供一个容器进行依赖对象的创建和查找，将对依赖对象的控制权由类内部交到容器这里，这样就实现了类与类的解耦，保证所有的类都是可以灵活修改。
                                                                        </p>
                                                                        <h3><b>2.1 耦合</b></h3>
                                                                        <p>直接看维基百科对 IoC
                                                                            的解释可能会觉得云里雾里，到底什么是耦合呢？在这里我们举一个简单的例子，假设我们有
                                                                            <code>A</code>、<code>B</code>
                                                                            两个类，它们之间存在的依赖关系是 <code>A</code> 依赖
                                                                            <code>B</code>，这种依赖关系在日常开发中很容易遇到，如果用传统的编码方式，我们一般会这么实现：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// b.ts
class B {
    constructor() {
    }
}

// a.ts
class A {
    b:B;
    constructor() {
        this.b = new B();
    }
}

// main.ts
const a = new A();
</code></pre>
                                                                        </div>
                                                                        <p>上述代码看上去似乎没有什么问题，然而，这时我们突然接到了新需求，处于最底层的
                                                                            <code>B</code> 在初始化对象的时候需要传递一个参数
                                                                            <code>p</code>：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// b.ts
class B {
    p: number;
    constructor(p: number) {
        this.p = p;
    }
}
</code></pre>
                                                                        </div>
                                                                        <p>修改完后，问题来了，由于 <code>B</code> 是在 <code>A</code>
                                                                            的构造函数中进行实例化的，我们不得不在 <code>A</code>
                                                                            的构造函数里传入这个 <code>p</code>，然而 <code>A</code>
                                                                            里面的 <code>p</code>
                                                                            怎么来呢？我们当然不能写死它，否则设定这个参数就没有意义了，因此我们只能将
                                                                            <code>p</code> 也设定为 <code>A</code>
                                                                            构造函数中的一个参数，如下：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// a.ts
class A {
    b:B;
    constructor(p: number) {
        this.b = new B(p);
    }
}

// main.ts
const a = new A(10);
console.log(a); // =&gt; A { b: B { p: 10 } }
</code></pre>
                                                                        </div>
                                                                        <p>更麻烦的是，当我们改完了 <code>A</code> 后，发现
                                                                            <code>B</code> 所需要的 <code>p</code> 不能是一个
                                                                            <code>number</code>，需要变更为
                                                                            <code>string</code>，于是我们又不得不重新修改
                                                                            <code>A</code> 中对参数 <code>p</code>
                                                                            的类型修饰。这时我们想想，假设还有上层类依赖
                                                                            <code>A</code>，用的也是同样的方式，那是否上层类也要经历同样的修改。这就是耦合所带来的问题，明明是修改底层类的一项参数，却需要修改其依赖链路上的所有文件，当应用程序的依赖关系复杂到一定程度时，很容易形成牵一发而动全身的现象，为应用程序的维护带来极大的困难。
                                                                        </p>
                                                                        <h3><b>2.2 解耦</b></h3>
                                                                        <p>事实上，我们可以发现，在上述例子中，真正需要参数 <code>p</code> 的仅仅只有
                                                                            <code>B</code>，而 <code>A</code>
                                                                            完全只是因为内部依赖的对象在实例化时需要
                                                                            <code>p</code>，才不得不定义这个参数，实际上它对
                                                                            <code>p</code>
                                                                            是什么根本不关心。于是，我们可以考虑将类所依赖对象的实例化从类本身剥离出来，比如上面的例子我们可以这样改写：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// b.ts
class B {
    p: number;
    constructor(p: number) {
        this.p = p;
    }
}

// a.ts
class A {
    private b:B;
    constructor(b: B) {
        this.b = b;
    }
}

// main.ts
const b = new B(10);
const a = new A(b);
console.log(a); // A =&gt; { b: B { p: 10 } }
</code></pre>
                                                                        </div>
                                                                        <p>在上述例子中，<code>A</code> 不再接收参数 <code>p</code>
                                                                            ，而是选择直接接收其内部所依赖的对象，至于这个对象在哪里进行实例化则并不关心，这样有效解决了我们在上面遇到的问题，当我们需要修改参数
                                                                            <code>p</code> 时，我们仅仅只要修改 <code>B</code>
                                                                            即可，而不需要修改 <code>A</code>
                                                                            ，这个过程中我们就实现了类与类之间的解耦。
                                                                        </p>
                                                                        <h3><b>2.3 容器</b></h3>
                                                                        <p>虽然我们实现了解耦，但我们仍需要自己初始化所有的类，并以构造函数参数的形式进行传递。如果存在一个全局的容器，里面<b>预先注册</b>好了我们所需对象的类定义以及初始化参数，每个对象有一个唯一的
                                                                            key。那么当我们需要用到某个对象时，我们只需要告诉容器它对应的
                                                                            key，就可以直接从容器中<b>取出</b>实例化好的对象，开发者就不用再关心对象的实例化过程，也不需要将依赖对象作为构造函数的参数在依赖链路上传递。
                                                                        </p>
                                                                        <p>也就是说，我们的容器必须具体两个功能，<b>实例的注册</b>和<b>获取</b>，这很容易让人联想到
                                                                            Map，基于这个思路，我们首先简单实现一个容器：</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// container.ts
export class Container {
    bindMap = new Map();

    // 实例的注册
    bind(identifier: string, clazz: any, constructorArgs: Array&lt;any&gt;) {
        this.bindMap.set(identifier, {
            clazz,
            constructorArgs
        });
    }

    // 实例的获取
    get&lt;T&gt;(identifier: string): T {
        const target = this.bindMap.get(identifier);
        const { clazz, constructorArgs } = target;
        const inst = Reflect.construct(clazz, constructorArgs);
    }
}
</code></pre>
                                                                        </div>
                                                                        <p>这里我们用到了 <a
                                                                                href="https://link.zhihu.com/?target=https%3A//developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/construct"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">Reflect.construct</a>，它的行为有点像
                                                                            new
                                                                            操作符，帮助我们进行对象的实例化。有了容器之后，我们就可以彻底抛弃传参实现解耦，如下所示：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// b.ts
class B {
    constructor(p: number) {
        this.p = p;
    }
}

// a.ts
class A {
    b:B;
    constructor() {
        this.b = container.get('b');
    }
}

// main.ts
const container = new Container();
container.bind('a', A);
container.bind('b', B, [10]);

// 从容器中取出a
const a = container.get('a');
console.log(a); // A =&gt; { b: B { p: 10 } }
</code></pre>
                                                                        </div>
                                                                        <p>到这里为止，我们其实已经基本实现了
                                                                            IoC，基于容器完成了类与类的解耦。但从代码量上看似乎并没有简洁多少，关键问题在于容器的初始化以及类的注册仍然让我们觉得繁琐，如果这部分代码能被封装到框架里面，所有类的注册都能够自动进行，同时，所有类在实例化的时候可以直接拿到依赖对象的实例，而不用在构造函数中手动指定，这样就可以彻底解放开发者的双手，专注编写类内部的逻辑，而这也就是所谓的
                                                                            <a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E4%25BE%259D%25E8%25B5%2596%25E6%25B3%25A8%25E5%2585%25A5"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">DI（Dependency
                                                                                Injection）依赖注入</a>。
                                                                        </p>
                                                                        <h2><b>三. DI</b></h2>
                                                                        <p>很多人会混淆 DI 和 IoC，IoC 只是一种设计原则，而 DI 则是实现 IoC
                                                                            的一种实现技术，简单来说就是我们可以将依赖注入给调用方，而不需要调用方来主动获取依赖。为了实现
                                                                            DI，主要要解决以下两个问题：</p>
                                                                        <ul>
                                                                            <li>需要注册到 IoC 容器中的类能够在程序启动时自动进行注册</li>
                                                                            <li>在 IoC
                                                                                容器中的类实例化时可以直接拿到依赖对象的实例，而不用在构造函数中手动指定
                                                                            </li>
                                                                        </ul>
                                                                        <p>针对这两个问题其实也有不同的解决思路，比如大名鼎鼎的 <a
                                                                                href="https://link.zhihu.com/?target=https%3A//spring.io/why-spring"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">Java
                                                                                Spring</a> 需要开发者针对容器中的依赖关系定义一份 XML
                                                                            文件，框架基于这份 XML 文件实例的注册和依赖的注入。但对于前端开发来说，基于 XML
                                                                            的依赖管理显得太过繁琐，Midway 的 Injection 提供的思路是利用
                                                                            TypeScript
                                                                            具备的装饰器特性，通过对元数据的修饰来识别出需要进行注册以及注入的依赖，从而完成依赖的注入。
                                                                        </p>
                                                                        <h3><b>3.1 Reflect Metadata</b></h3>
                                                                        <p>要使用装饰器解决上述提到的两个问题，我们需要先简单了解下 <a
                                                                                href="https://link.zhihu.com/?target=https%3A//jkchao.github.io/typescript-book-chinese/tips/metadata.html%23%25E5%259F%25BA%25E7%25A1%2580"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">Reflect
                                                                                Metadata</a>。Reflect Metadata 是 ES7
                                                                            的一个提案，它主要用来在声明的时候添加和读取元数据，TypeScript 在 1.5+
                                                                            的版本已经支持它。</p>
                                                                        <p>元数据可以理解为针对类或类里面某个属性的描述信息，它本身不影响类的行为，但你可以在随时拿到某个类上定义的元数据，并根据这些元数据进行对类进行特定的操作。
                                                                        </p>
                                                                        <p>Reflect Metadata 的使用非常简单，首先，你需要安装
                                                                            reflect-metadata 库：</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">npm i reflect-metadata --save
</code></pre>
                                                                        </div>
                                                                        <p>在 tsconfig.json 里，emitDecoratorMetadata 需要配置为
                                                                            <code>true</code>。
                                                                        </p>
                                                                        <p>然后，我们就可以根据 Reflect.defineMetadata 和
                                                                            Reflect.getMetadata 进行元数据的定义和获取，比如：</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">import 'reflect-metadata';

const CLASS_KEY = 'ioc:key';

function ClassDecorator() {
  return function (target: any) {
      Reflect.defineMetadata(CLASS_KEY, {
        metaData: 'metaData',
      }, target);
      return target;
  };
}

@ClassDecorator()
class D {
  constructor(){}
}

console.log(Reflect.getMetadata(CLASS_KEY, D)); // =&gt; { metaData: 'metaData' }
</code></pre>
                                                                        </div>
                                                                        <p>有了
                                                                            Reflect，我们就可以对任意类进行标记，并对标记的类进行特殊的处理。更多有关元数据的内容可以参考
                                                                            <a href="https://link.zhihu.com/?target=https%3A//jkchao.github.io/typescript-book-chinese/tips/metadata.html%23%25E5%259F%25BA%25E7%25A1%2580"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">Reflect
                                                                                Metadata</a>。
                                                                        </p>
                                                                        <h3><b>3.2 Provider</b></h3>
                                                                        <p>回到我们刚刚提到的问题，我们需要在应用启动的时候自动对所有类进行定义和参数的注册，问题是并不是所有的类都需要注册到容器中，我们并不清楚哪些类需要注册的，同时也不清楚需要注册的类，它的初始化参数是什么样的。
                                                                        </p>
                                                                        <p>这里就可以引入元数据来解决这个问题，只要在定义的时候为这个类的元数据添加特殊的标记，就可以在扫描的时候识别出来。按照这个思路，我们先来实现一个装饰器标记需要注册的类，这个装饰器可以命名
                                                                            Provider，代表它将会作为提供者给其他类进行消费。</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// provider.ts
import 'reflect-metadata'

export const CLASS_KEY = 'ioc:tagged_class';

export function Provider(identifier: string, args?: Array&lt;any&gt;) {
    return function (target: any) {
        Reflect.defineMetadata(CLASS_KEY, {
            id: identifier,
            args: args || []
        }, target);
        return target;
    };
}
</code></pre>
                                                                        </div>
                                                                        <p>可以看到，这里的标记包含了 <code>id</code> 和
                                                                            <code>args</code>，其中 <code>id</code>
                                                                            是我们准备用来注册 IoC 容器的 <code>key</code>，而
                                                                            <code>args</code> 则是实例初始化时需要的参数。Provider
                                                                            可以以装饰器的形式直接进行使用，使用方式如下：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// b.ts
import { Provider } from 'provider';

@Provider('b', [10])
export class B {
    constructor(p: number) {
        this.p = p;
    }
}
</code></pre>
                                                                        </div>
                                                                        <p>标记完成后，问题又来了，如果在应用启动的时候拿到这些类的定义呢？</p>
                                                                        <p>比较容易想到的思路是在启动的时候对所有文件进行扫描，获取每个文件导出的类，然后根据元数据进行绑定。简单起见，我们假设项目目录只有一级文件，实现如下：
                                                                        </p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// load.ts
import * as fs from 'fs';
import { CLASS_KEY } from './provider';

export function load(container) { // container 为全局的 IoC 容器
  const list = fs.readdirSync('./');

  for (const file of list) {
    if (/\.ts$/.test(file)) { // 扫描 ts 文件
      const exports = require(`./${file}`);
      for (const m in exports) {
        const module = exports[m];
        if (typeof module === 'function') {
          const metadata = Reflect.getMetadata(CLASS_KEY, module);
          // 注册实例
          if (metadata) {
            container.bind(metadata.id, module, metadata.args)
          }
        }
      }
    }
  }
}
</code></pre>
                                                                        </div>
                                                                        <p>那么现在，我们只要在 main 中运行 load
                                                                            即可完成项目目录下所有被修饰的类的绑定工作，值得注意的是，load 和
                                                                            Container 的逻辑是完全通用的，它们完全可以被封装成包，一个简化的 IoC
                                                                            框架就成型了。</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">import { Container } from './container';
import { load } from './load';

// 初始化 IOC 容器，扫描文件
const container = new Container();
load(container);

console.log(container.get('a')); // A =&gt; { b: B { p: 10 } }
</code></pre>
                                                                        </div>
                                                                        <h3><b>3.2 Inject</b></h3>
                                                                        <p>解决注册的问题后，我们来看上文中提到的第二个问题：如何在类初始化的时候能直接拿到它所依赖的对象的实例，而不需要手动通过构造函数进行传参。其实思路也很简单，我们已经将所有需要注册的类都放入了
                                                                            IoC
                                                                            容器，那么，当我们需要用到某个类时，在获取这个类的实例时可以递归遍历类上的属性，并从
                                                                            IoC 容器中取出相应的对象并进行赋值，即可完成依赖的注入。</p>
                                                                        <p>那么，又是类似的问题，如何区分哪些属性需要注入？同样，我们可以使用元数据来解决。只要定义一个装饰器，以此来标记哪些属性需要注入即可，这个装饰器命名为
                                                                            Inject，代表该属性需要注入依赖。</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// inject.ts
import 'reflect-metadata';

export const PROPS_KEY = 'ioc:inject_props';

export function Inject() {
    return function (target: any, targetKey: string) {
        const annotationTarget = target.constructor;
        let props = {};
        if (Reflect.hasOwnMetadata(PROPS_KEY, annotationTarget)) {
            props = Reflect.getMetadata(PROPS_KEY, annotationTarget);
        }

        props[targetKey] = {
            value: targetKey
        };

        Reflect.defineMetadata(PROPS_KEY, props, annotationTarget);
    };
}
</code></pre>
                                                                        </div>
                                                                        <p>需要注意的是，这里我们虽然是对属性进行修饰，但实际元数据是要定义在类上，以维护该类需要注入的属性列表，因此我们必须取
                                                                            target.constructor 作为要操作的
                                                                            target。另外，为了方便起见，这里直接用了属性名（targetKey）作为从 IoC
                                                                            容器中实例对应的 key。</p>
                                                                        <p>然后，我们需要修改 IoC 容器的 get 方法，递归注入所有属性：</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// container.ts
import { PROPS_KEY } from './inject';

export class Container {
    bindMap = new Map();

    bind(identifier: string, clazz: any, constructorArgs?: Array&lt;any&gt;) {
        this.bindMap.set(identifier, {
            clazz,
            constructorArgs: constructorArgs || []
        });
    }

    get&lt;T&gt;(identifier: string): T {
        const target = this.bindMap.get(identifier);

        const { clazz, constructorArgs } = target;

        const props = Reflect.getMetadata(PROPS_KEY, clazz);
        const inst = Reflect.construct(clazz, constructorArgs);

        for (let prop in props) {
            const identifier = props[prop].value;
            // 递归获取注入的对象
            inst[ prop ] = this.get(identifier);
        }
        return inst;
    }
}
</code></pre>
                                                                        </div>
                                                                        <p>使用的时候，用 Inject 对需要的属性进行修饰即可：</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// a.ts
import { Provider } from 'provider';

@Provider('a')
export class A {
    @Inject()
    b: B;
}
</code></pre>
                                                                        </div>
                                                                        <h3><b>3.3 最终代码</b></h3>
                                                                        <p>经过上述调整后，最终我们的业务代码成了这样：</p>
                                                                        <div class="highlight">
                                                                            <pre><code class="language-text">// b.ts
@Proivder('b', [10])
class B {
    constructor(p: number) {
        this.p = p;
    }
}

// a.ts
@Proivder('a')
class A {
    @Inject()
    private b:B;
}

// main.ts
const container = new Container();
load(container);

console.log(container.get('a'));  // =&gt; A { b: B { p: 10 } }
</code></pre>
                                                                        </div>
                                                                        <p>可以看到，代码中不会再有手动进行实例化的情况，无论要注册多少个类，框架层都可以自动处理好一切，并在这些类实例化的时候注入需要的属性。所有类可提供的实例都由类自身来维护，即使存在修改也不需要改动其他文件。
                                                                        </p>
                                                                        <h2><b>小结</b></h2>
                                                                        <p>本文从类的解耦开始描述了 IoC 的必要性，基于 TypeScript 实现了一个精简的
                                                                            IoC 框架。事实上，除了解耦外，IoC
                                                                            还可以给我们带来很多好处，比如基于容器快速进行单元测试，分析类与类之间的依赖关系等等。
                                                                        </p>
                                                                        <p>虽然 IoC 最初是服务端提出的概念，但目前在前端领域也已经有了各种各样的应用，比如
                                                                            AngularJS 就实现了自己的 IoC
                                                                            框架来提升开发效率和模块化程度，有兴趣的读者可以通过官方的<a
                                                                                href="https://link.zhihu.com/?target=https%3A//angular.cn/guide/dependency-injection"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">案例</a>感受一下 IoC
                                                                            给前端编码带来的好处。相信随着前端职能的扩张，应用复杂度的提升，这些经典的设计原则正在逐渐成为每个前端开发的必修课程。
                                                                        </p>
                                                                        <h2><b>参考资料</b></h2>
                                                                        <ul>
                                                                            <li><a href="https://link.zhihu.com/?target=https%3A//jkchao.github.io/typescript-book-chinese/tips/metadata.html%23%25E5%259F%25BA%25E7%25A1%2580"
                                                                                    class=" wrap external"
                                                                                    target="_blank"
                                                                                    rel="nofollow noreferrer">深入理解TypeScript</a>
                                                                            </li>
                                                                            <li><a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E6%258E%25A7%25E5%2588%25B6%25E5%258F%258D%25E8%25BD%25AC"
                                                                                    class=" wrap external"
                                                                                    target="_blank"
                                                                                    rel="nofollow noreferrer">控制反转-维基百科</a>
                                                                            </li>
                                                                            <li><a href="https://link.zhihu.com/?target=https%3A//developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/construct"
                                                                                    class=" wrap external"
                                                                                    target="_blank"
                                                                                    rel="nofollow noreferrer">MDN</a>
                                                                            </li>
                                                                            <li><a href="https://link.zhihu.com/?target=https%3A//midwayjs.org/midway/ioc.html"
                                                                                    class=" wrap external"
                                                                                    target="_blank"
                                                                                    rel="nofollow noreferrer">Midway</a>
                                                                            </li>
                                                                            <li><a href="https://link.zhihu.com/?target=https%3A//angular.cn/guide/dependency-injection"
                                                                                    class=" wrap external"
                                                                                    target="_blank"
                                                                                    rel="nofollow noreferrer">AngularJS
                                                                                    DI</a></li>
                                                                        </ul>
                                                                        <blockquote>本文发布自 <a
                                                                                href="https://link.zhihu.com/?target=https%3A//github.com/x-orpheus"
                                                                                class=" wrap external" target="_blank"
                                                                                rel="nofollow noreferrer">网易云音乐大前端团队</a>，文章未经授权禁止任何形式的转载。我们常年招收前端、iOS、Android，如果你准备换工作，又恰好喜欢云音乐，那就加入我们
                                                                            grp.music-fe(at)corp.netease.com！
                                                                        </blockquote>
                                                                    </span></div>
                                                                <div class="ContentItem-time"><a target="_blank"
                                                                        href="https://zhuanlan.zhihu.com/p/311184005"><span
                                                                            data-tooltip="发布于 2020-11-25 10:30">发布于
                                                                            2020-11-25</span></a></div>
                                                                <div>
                                                                    <div class="ContentItem-actions Sticky RichContent-actions is-fixed is-bottom"
                                                                        style="width: 694px; bottom: 0px; left: 451.5px;">
                                                                        <span><button aria-label="赞同 434 " type="button"
                                                                                class="Button VoteButton VoteButton--up"><span
                                                                                    style="display: inline-flex; align-items: center;">​<svg
                                                                                        class="Zi Zi--TriangleUp VoteButton-TriangleUp"
                                                                                        fill="currentColor"
                                                                                        viewBox="0 0 24 24" width="10"
                                                                                        height="10">
                                                                                        <path
                                                                                            d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z"
                                                                                            fill-rule="evenodd"></path>
                                                                                    </svg></span>赞同 434</button><button
                                                                                aria-label="反对" type="button"
                                                                                class="Button VoteButton VoteButton--down"><span
                                                                                    style="display: inline-flex; align-items: center;">​<svg
                                                                                        class="Zi Zi--TriangleDown"
                                                                                        fill="currentColor"
                                                                                        viewBox="0 0 24 24" width="10"
                                                                                        height="10">
                                                                                        <path
                                                                                            d="M20.044 3H3.956C2.876 3 2 3.517 2 4.9c0 .326.087.533.236.896L10.216 19c.355.571.87 1.143 1.784 1.143s1.429-.572 1.784-1.143l7.98-13.204c.149-.363.236-.57.236-.896 0-1.386-.876-1.9-1.956-1.9z"
                                                                                            fill-rule="evenodd"></path>
                                                                                    </svg></span></button></span>
                                                                        <div class="ContentItem-action css-0"><button
                                                                                type="button"
                                                                                class="Button Button--plain Button--withIcon Button--withLabel"><span
                                                                                    style="display: inline-flex; align-items: center;">​<svg
                                                                                        class="Zi Zi--Comment Button-zi"
                                                                                        fill="currentColor"
                                                                                        viewBox="0 0 24 24"
                                                                                        width="1.2em" height="1.2em">
                                                                                        <path
                                                                                            d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z"
                                                                                            fill-rule="evenodd"></path>
                                                                                    </svg></span>24 条评论</button></div>
                                                                        <div
                                                                            class="Popover ShareMenu ContentItem-action">
                                                                            <div class="ShareMenu-toggler"
                                                                                id="Popover32-toggle"
                                                                                aria-haspopup="true"
                                                                                aria-expanded="false"
                                                                                aria-owns="Popover32-content"><button
                                                                                    type="button"
                                                                                    class="Button Button--plain Button--withIcon Button--withLabel"><span
                                                                                        style="display: inline-flex; align-items: center;">​<svg
                                                                                            class="Zi Zi--Share Button-zi"
                                                                                            fill="currentColor"
                                                                                            viewBox="0 0 24 24"
                                                                                            width="1.2em"
                                                                                            height="1.2em">
                                                                                            <path
                                                                                                d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z"
                                                                                                fill-rule="evenodd">
                                                                                            </path>
                                                                                        </svg></span>分享</button></div>
                                                                        </div><button type="button"
                                                                            class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span
                                                                                style="display: inline-flex; align-items: center;">​<svg
                                                                                    class="Zi Zi--Star Button-zi"
                                                                                    fill="currentColor"
                                                                                    viewBox="0 0 24 24" width="1.2em"
                                                                                    height="1.2em">
                                                                                    <path
                                                                                        d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z"
                                                                                        fill-rule="evenodd"></path>
                                                                                </svg></span>收藏</button><button
                                                                            type="button"
                                                                            class="Button ContentItem-action Button--plain"><span
                                                                                style="display: inline-flex; align-items: center;">​<svg
                                                                                    class="Zi Zi--Report"
                                                                                    fill="currentColor"
                                                                                    viewBox="0 0 24 24" width="14"
                                                                                    height="14">
                                                                                    <path
                                                                                        d="M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z"
                                                                                        fill-rule="evenodd"></path>
                                                                                </svg></span> 举报</button>
                                                                        <div class="Popover ContentItem-action"><button
                                                                                aria-label="更多" id="Popover33-toggle"
                                                                                aria-haspopup="true"
                                                                                aria-expanded="false"
                                                                                aria-owns="Popover33-content"
                                                                                type="button"
                                                                                class="Button OptionsButton Button--plain Button--withIcon Button--iconOnly"><span
                                                                                    style="display: inline-flex; align-items: center;">​<svg
                                                                                        class="Zi Zi--Dots Button-zi"
                                                                                        fill="currentColor"
                                                                                        viewBox="0 0 24 24"
                                                                                        width="1.2em" height="1.2em">
                                                                                        <path
                                                                                            d="M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"
                                                                                            fill-rule="evenodd"></path>
                                                                                    </svg></span></button></div><button
                                                                            data-zop-retract-question="true"
                                                                            type="button"
                                                                            class="Button ContentItem-action ContentItem-rightButton Button--plain"><span
                                                                                class="RichContent-collapsedText">收起</span><span
                                                                                style="display: inline-flex; align-items: center;">​<svg
                                                                                    class="Zi Zi--ArrowDown ContentItem-arrowIcon is-active"
                                                                                    fill="currentColor"
                                                                                    viewBox="0 0 24 24" width="24"
                                                                                    height="24">
                                                                                    <path
                                                                                        d="M12 13L8.285 9.218a.758.758 0 0 0-1.064 0 .738.738 0 0 0 0 1.052l4.249 4.512a.758.758 0 0 0 1.064 0l4.246-4.512a.738.738 0 0 0 0-1.052.757.757 0 0 0-1.063 0L12.002 13z"
                                                                                        fill-rule="evenodd"></path>
                                                                                </svg></span></button>
                                                                    </div>
                                                                    <div class="Sticky--holder"
                                                                        style="position: static; inset: auto; display: flex; float: none; margin: 0px -20px -10px; height: 52px; width: 694px;">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="Card TopstoryItem TopstoryItem--old TopstoryItem-isRecommend"
                                                    tabindex="0">
                                                    <div class="Feed" data-za-detail-view-path-module="FeedItem"
                                                        data-za-detail-view-path-index="0"
                                                        data-za-extra-module="{&quot;card&quot;:{&quot;card_type&quot;:&quot;Feed&quot;,&quot;feed_id&quot;:&quot;11_1610348812.311&quot;,&quot;has_image&quot;:false,&quot;has_video&quot;:false,&quot;content&quot;:{&quot;type&quot;:&quot;Answer&quot;,&quot;token&quot;:&quot;945494958&quot;}},&quot;attached_info_bytes&quot;:&quot;Cp8CCPuLnf7J2OfkrQEQBBoJMjAxOTczODM4ILWk++8FKK+iATDLGEALSg0KBEhDWlYSATEYACAAUg5ob3RfYWRkX2Fuc3dlcloIMjc5MjY3NzdyCTk0NTQ5NDk1OHg6igEJMjk1NDI0NTY5qgEJcmVjb21tZW5k8gE5CAASNXJ3Oi0zMS4wO2lzbzo0My4wO2JpOjAuMDtjcjotMS4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATLyAQoIDBIGTm9ybWFs8gEoCAoSJDRmNTZiOTY2LWM0YWYtNDc0My1iY2ZmLTY3MTMyZDViNTJlNYgCl66Tgu8ukgIgMTM1NTRkNzE0YjQ4ODIxOTIwMjkzMzY3NjFkYmMyYmOaAgA=&quot;}">
                                                        <div class="ContentItem AnswerItem"
                                                            data-zop="{&quot;authorName&quot;:&quot;生生不息&quot;,&quot;itemId&quot;:945494958,&quot;title&quot;:&quot;异性合租会不会日久生情？&quot;,&quot;type&quot;:&quot;answer&quot;}"
                                                            name="945494958" itemprop="answer"
                                                            itemtype="http://schema.org/Answer" itemscope=""
                                                            data-za-detail-view-path-module="AnswerItem"
                                                            data-za-extra-module="{&quot;card&quot;:{&quot;has_image&quot;:false,&quot;has_video&quot;:false,&quot;content&quot;:{&quot;type&quot;:&quot;Answer&quot;,&quot;token&quot;:&quot;945494958&quot;,&quot;upvote_num&quot;:20783,&quot;comment_num&quot;:3147,&quot;publish_timestamp&quot;:null,&quot;parent_token&quot;:&quot;295424569&quot;,&quot;author_member_hash_id&quot;:&quot;13554d714b4882192029336761dbc2bc&quot;}}}">
                                                            <h2 class="ContentItem-title">
                                                                <div itemprop="zhihu:question"
                                                                    itemtype="http://schema.org/Question" itemscope="">
                                                                    <meta itemprop="url"
                                                                        content="https://www.zhihu.com/question/295424569">
                                                                    <meta itemprop="name" content="异性合租会不会日久生情？"><a
                                                                        target="_blank"
                                                                        data-za-detail-view-element_name="Title"
                                                                        data-za-detail-view-id="2812"
                                                                        href="https://www.zhihu.com/question/295424569/answer/945494958">异性合租会不会日久生情？</a>
                                                                </div>
                                                            </h2>
                                                            <meta itemprop="image" content="">
                                                            <meta itemprop="upvoteCount" content="20783">
                                                            <meta itemprop="url"
                                                                content="https://www.zhihu.com/question/295424569/answer/945494958">
                                                            <meta itemprop="dateCreated"
                                                                content="2019-12-22T02:17:25.000Z">
                                                            <meta itemprop="dateModified"
                                                                content="2020-01-08T12:23:52.000Z">
                                                            <meta itemprop="commentCount" content="3147">
                                                            <div class="RichContent is-collapsed">
                                                                <div class="RichContent-inner"><span
                                                                        class="RichText ztext CopyrightRichText-richText"
                                                                        itemprop="text">生生不息：
                                                                        生情个毛线，我一男的和两个女的合租，一开始我告诉你们，我真觉得有朝一日可能会啪啪啪，但是！！！随着时间的推移你会发现，你特么连这个心思都没…</span><button
                                                                        type="button"
                                                                        class="Button ContentItem-more Button--plain">阅读全文<span
                                                                            style="display: inline-flex; align-items: center;">​<svg
                                                                                class="Zi Zi--ArrowDown ContentItem-arrowIcon"
                                                                                fill="currentColor" viewBox="0 0 24 24"
                                                                                width="24" height="24">
                                                                                <path
                                                                                    d="M12 13L8.285 9.218a.758.758 0 0 0-1.064 0 .738.738 0 0 0 0 1.052l4.249 4.512a.758.758 0 0 0 1.064 0l4.246-4.512a.738.738 0 0 0 0-1.052.757.757 0 0 0-1.063 0L12.002 13z"
                                                                                    fill-rule="evenodd"></path>
                                                                            </svg></span></button></div>
                                                                <div class="ContentItem-actions"><span><button
                                                                            aria-label="赞同 2 万" type="button"
                                                                            class="Button VoteButton VoteButton--up"><span
                                                                                style="display: inline-flex; align-items: center;">​<svg
                                                                                    class="Zi Zi--TriangleUp VoteButton-TriangleUp"
                                                                                    fill="currentColor"
                                                                                    viewBox="0 0 24 24" width="10"
                                                                                    height="10">
                                                                                    <path
                                                                                        d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z"
                                                                                        fill-rule="evenodd"></path>
                                                                                </svg></span>赞同 2 万</button><button
                                                                            aria-label="反对" type="button"
                                                                            class="Button VoteButton VoteButton--down"><span
                                                                                style="display: inline-flex; align-items: center;">​<svg
                                                                                    class="Zi Zi--TriangleDown"
                                                                                    fill="currentColor"
                                                                                    viewBox="0 0 24 24" width="10"
                                                                                    height="10">
                                                                                    <path
                                                                                        d="M20.044 3H3.956C2.876 3 2 3.517 2 4.9c0 .326.087.533.236.896L10.216 19c.355.571.87 1.143 1.784 1.143s1.429-.572 1.784-1.143l7.98-13.204c.149-.363.236-.57.236-.896 0-1.386-.876-1.9-1.956-1.9z"
                                                                                        fill-rule="evenodd"></path>
                                                                                </svg></span></button></span><button
                                                                        type="button"
                                                                        class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span
                                                                            style="display: inline-flex; align-items: center;">​<svg
                                                                                class="Zi Zi--Comment Button-zi"
                                                                                fill="currentColor" viewBox="0 0 24 24"
                                                                                width="1.2em" height="1.2em">
                                                                                <path
                                                                                    d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z"
                                                                                    fill-rule="evenodd"></path>
                                                                            </svg></span>3,147 条评论</button>
                                                                    <div class="Popover ShareMenu ContentItem-action">
                                                                        <div class="ShareMenu-toggler"
                                                                            id="Popover28-toggle" aria-haspopup="true"
                                                                            aria-expanded="false"
                                                                            aria-owns="Popover28-content"><button
                                                                                type="button"
                                                                                class="Button Button--plain Button--withIcon Button--withLabel"><span
                                                                                    style="display: inline-flex; align-items: center;">​<svg
                                                                                        class="Zi Zi--Share Button-zi"
                                                                                        fill="currentColor"
                                                                                        viewBox="0 0 24 24"
                                                                                        width="1.2em" height="1.2em">
                                                                                        <path
                                                                                            d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z"
                                                                                            fill-rule="evenodd"></path>
                                                                                    </svg></span>分享</button></div>
                                                                    </div><button type="button"
                                                                        class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span
                                                                            style="display: inline-flex; align-items: center;">​<svg
                                                                                class="Zi Zi--Star Button-zi"
                                                                                fill="currentColor" viewBox="0 0 24 24"
                                                                                width="1.2em" height="1.2em">
                                                                                <path
                                                                                    d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z"
                                                                                    fill-rule="evenodd"></path>
                                                                            </svg></span>收藏</button><button
                                                                        type="button"
                                                                        class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span
                                                                            style="display: inline-flex; align-items: center;">​<svg
                                                                                class="Zi Zi--Heart Button-zi"
                                                                                fill="currentColor" viewBox="0 0 24 24"
                                                                                width="1.2em" height="1.2em">
                                                                                <path
                                                                                    d="M2 8.437C2 5.505 4.294 3.094 7.207 3 9.243 3 11.092 4.19 12 6c.823-1.758 2.649-3 4.651-3C19.545 3 22 5.507 22 8.432 22 16.24 13.842 21 12 21 10.158 21 2 16.24 2 8.437z"
                                                                                    fill-rule="evenodd"></path>
                                                                            </svg></span>喜欢</button>
                                                                    <div class="Popover ContentItem-action"><button
                                                                            aria-label="更多" id="Popover29-toggle"
                                                                            aria-haspopup="true" aria-expanded="false"
                                                                            aria-owns="Popover29-content" type="button"
                                                                            class="Button OptionsButton Button--plain Button--withIcon Button--iconOnly"><span
                                                                                style="display: inline-flex; align-items: center;">​<svg
                                                                                    class="Zi Zi--Dots Button-zi"
                                                                                    fill="currentColor"
                                                                                    viewBox="0 0 24 24" width="1.2em"
                                                                                    height="1.2em">
                                                                                    <path
                                                                                        d="M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"
                                                                                        fill-rule="evenodd"></path>
                                                                                </svg></span></button></div>
                                                                </div>
                                                            </div>
                                                            <div class="ModalWrap">
                                                                <div>
                                                                    <div class=""></div>
                                                                    <div class="ModalExp-content">
                                                                        <div class="ModalWrap-content">
                                                                            <div class="ModalWrap-title">继续浏览内容</div>
                                                                            <div class="ModalWrap-item">
                                                                                <div class="ModalWrap-itemImg"><img
                                                                                        src="./(4 条消息) 首页 - 知乎_files/v2-10e18ff65a640175ad058b4b5dfd2867_1440w.png">
                                                                                </div>
                                                                                <div class="ModalWrap-itemContent">
                                                                                    <div class="ModalWrap-itemTitle">知乎
                                                                                    </div>
                                                                                    <div class="ModalWrap-itemDesc">
                                                                                        发现更大的世界</div>
                                                                                </div>
                                                                                <div class="ModalWrap-itemBtn">打开</div>
                                                                            </div>
                                                                            <div class="ModalWrap-item">
                                                                                <div class="ModalWrap-itemImg"><img
                                                                                        src="./(4 条消息) 首页 - 知乎_files/v2-a448b133c0201b59631ccfa93cb650f3_1440w.png">
                                                                                </div>
                                                                                <div class="ModalWrap-itemContent">
                                                                                    <div class="ModalWrap-itemTitle">
                                                                                        Chrome</div>
                                                                                </div>
                                                                                <div class="ModalWrap-itemBtn">继续</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div>
                                                                    <div class=""></div>
                                                                    <div class="ModalLoading-content"><svg width="30"
                                                                            height="30" viewBox="0 0 66 66"
                                                                            xmlns="http://www.w3.org/2000/svg"
                                                                            class="CircleLoadingBar" aria-hidden="true">
                                                                            <g>
                                                                                <circle class="path" fill="none"
                                                                                    stroke-width="6"
                                                                                    stroke-linecap="round" cx="33"
                                                                                    cy="33" r="30"></circle>
                                                                            </g>
                                                                        </svg></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="GlobalSideBar GlobalSideBar--old" data-za-detail-view-path-module="RightSideBar"
                            data-za-extra-module="{}">
                            <div>
                                <div class="Sticky is-fixed" style="width: 296px; top: -401px; left: 1155.5px;">
                                    <div class="Card GlobalWrite GlobalWrite--old">
                                        <div class="GlobalWrite-navTop"><a class="GlobalWrite-topItem" target="_blank"
                                                rel="noopener noreferrer" title="回答"><svg width="40" height="40"
                                                    viewBox="0 0 40 40" class="GlobalWrite-navIcon" fill="currentColor">
                                                    <g fill="#0084FF" fill-rule="evenodd">
                                                        <circle cx="20" cy="20" r="20" opacity=".12"></circle>
                                                        <path
                                                            d="M23.487 10.463c1.896 0 2.583.193 3.277.555a3.824 3.824 0 0 1 1.607 1.573c.371.678.569 1.35.569 3.206v8.472c0 1.855-.198 2.527-.569 3.205a3.824 3.824 0 0 1-1.607 1.573c-.694.363-1.381.556-3.277.556h-6.96c-1.895 0-2.583-.193-3.276-.556a3.824 3.824 0 0 1-1.608-1.573c-.37-.678-.568-1.35-.568-3.205v-8.472c0-1.855.197-2.528.568-3.206.37-.678.915-1.21 1.608-1.573.693-.362 1.38-.556 3.277-.556h6.959zm0 2.08h-6.96c-1.407 0-1.836.081-2.273.31a1.72 1.72 0 0 0-.735.72c-.234.427-.317.847-.317 2.224v8.472c0 1.377.083 1.796.317 2.224.172.316.412.551.735.72.437.229.866.31 2.274.31h6.959c1.407 0 1.836-.081 2.274-.31a1.72 1.72 0 0 0 .735-.72c.234-.428.317-.847.317-2.224v-8.472c0-1.377-.083-1.797-.317-2.225a1.72 1.72 0 0 0-.735-.72c-.438-.228-.867-.309-2.274-.309zm-1.991 9.778v1.873h-5.955V22.32h5.955zm2.977-3.328v1.872h-8.932v-1.872h8.932zm0-3.33v1.873h-8.932v-1.872h8.932z"
                                                            fill-rule="nonzero"></path>
                                                    </g>
                                                </svg>
                                                <div class="GlobalWrite-topTitle">回答问题</div>
                                            </a>
                                            <div class="GlobalWrite-topItem"><svg width="40" height="40"
                                                    viewBox="0 0 40 40" class="GlobalWrite-navIcon" fill="currentColor">
                                                    <g fill="#FF9607" fill-rule="evenodd">
                                                        <circle cx="20" cy="20" r="20" opacity=".12"></circle>
                                                        <path
                                                            d="M24.233 24.777v-9.555c0-.942-.748-1.706-1.67-1.706H13.61c-.922 0-1.67.764-1.67 1.707v9.554c0 .943.748 1.707 1.67 1.707h8.954c.921 0 1.669-.764 1.669-1.707zm3.478-10.349a2.302 2.302 0 0 1 3.297.243c.367.434.57.989.57 1.563v7.532c0 1.32-1.047 2.389-2.337 2.389a2.308 2.308 0 0 1-1.53-.583l-1.475-1.306v.512c0 2.073-1.644 3.753-3.672 3.753H13.61c-2.028 0-3.672-1.68-3.672-3.753v-9.555c0-2.074 1.644-3.754 3.672-3.754h8.954c2.028 0 3.672 1.68 3.672 3.754v.51l1.475-1.305zm-1.475 7.13l2.786 2.466a.33.33 0 0 0 .219.083.338.338 0 0 0 .334-.341v-7.532a.346.346 0 0 0-.082-.223.329.329 0 0 0-.47-.035l-2.787 2.466v3.116z"
                                                            fill-rule="nonzero"></path>
                                                    </g>
                                                </svg>
                                                <div class="GlobalWrite-topTitle">发视频</div>
                                            </div><a class="GlobalWrite-topItem" target="_blank"
                                                rel="noopener noreferrer" title="写文章"><svg width="40" height="40"
                                                    viewBox="0 0 40 40" class="GlobalWrite-navIcon" fill="currentColor">
                                                    <g fill="none" fill-rule="evenodd">
                                                        <circle cx="20" cy="20" r="20" fill="#F4C807" opacity=".12">
                                                        </circle>
                                                        <path d="M6 6h28v28H6z"></path>
                                                        <path fill="#F4C807"
                                                            d="M20.406 11.772l-2.172 2.176h-2.29c-1.438 0-1.875.085-2.322.324-.33.176-.575.422-.751.752-.24.448-.324.886-.324 2.326v7.12c0 1.44.085 1.878.324 2.326.176.33.421.576.75.752.421.225.834.314 2.08.323l7.35.001c1.438 0 1.876-.084 2.323-.324.33-.176.575-.422.751-.752.24-.448.324-.886.324-2.326v-4.905l2.172-2.175v7.08c0 1.94-.202 2.643-.58 3.352a3.95 3.95 0 0 1-1.643 1.645c-.708.379-1.41.58-3.346.58h-7.108c-1.936 0-2.639-.201-3.347-.58a3.95 3.95 0 0 1-1.642-1.645c-.378-.71-.58-1.413-.58-3.352v-7.12c0-1.94.202-2.643.58-3.352a3.95 3.95 0 0 1 1.642-1.645c.708-.379 1.41-.58 3.347-.58h4.462zm6.908-2.053c.384.116.747.338 1.168.759l.188.189c.42.421.642.785.758 1.17a1.98 1.98 0 0 1 0 1.163c-.116.385-.337.749-.758 1.17l-6.9 6.911c-.62.622-.827.81-1.078 1.004-.251.193-.496.34-.784.47-.288.131-.553.226-1.392.48l-1.088.332a1.303 1.303 0 0 1-1.625-1.629l.33-1.09c.255-.84.35-1.104.48-1.393.13-.29.277-.534.47-.785.193-.252.381-.46 1.001-1.081l6.9-6.911c.42-.421.784-.643 1.168-.76a1.97 1.97 0 0 1 1.162 0zm-3.204 4.096l-4.797 4.805c-.547.548-.709.723-.852.91-.112.146-.19.276-.265.443-.097.214-.175.44-.4 1.182l-.094.31.31-.095c.74-.225.965-.303 1.179-.4.167-.076.297-.154.442-.266.187-.143.361-.305.909-.853l4.797-4.805-1.23-1.23zm2.546-2.43c-.109.033-.23.11-.443.324l-.874.875 1.228 1.231.875-.876c.213-.213.29-.334.323-.444a.24.24 0 0 0 0-.153c-.033-.11-.11-.23-.323-.445l-.189-.188c-.213-.214-.334-.291-.443-.325a.238.238 0 0 0-.154 0z"
                                                            fill-rule="nonzero"></path>
                                                    </g>
                                                </svg>
                                                <div class="GlobalWrite-topTitle">写文章</div>
                                            </a>
                                            <div class="GlobalWrite-topItem"><svg width="40" height="40"
                                                    viewBox="0 0 40 40" class="GlobalWrite-navIcon" fill="currentColor">
                                                    <g fill="#26BFBF" fill-rule="evenodd">
                                                        <circle cx="20" cy="20" r="20" opacity=".12"></circle>
                                                        <path
                                                            d="M21.987 11.686v2.169h-6.125c-1.43 0-1.863.064-2.297.306-.332.128-.574.383-.74.702-.255.447-.332.893-.332 2.297v7.018c0 1.442.09 1.876.332 2.297.166.345.408.587.74.766.434.23.868.319 2.297.319h7.018c1.43 0 1.863-.077 2.297-.32.345-.165.587-.408.766-.74.216-.408.296-.816.305-2.054l.001-6.316.025.025h2.17v6.074c0 1.914-.217 2.616-.587 3.318a3.92 3.92 0 0 1-1.634 1.62c-.689.383-1.403.575-3.317.575h-7.018c-1.915 0-2.616-.204-3.318-.575a3.891 3.891 0 0 1-1.62-1.62c-.384-.702-.575-1.404-.575-3.318v-7.018c0-1.914.204-2.629.574-3.318a3.996 3.996 0 0 1 1.62-1.633c.703-.383 1.404-.574 3.318-.574h6.1zm1.889 6.954c1.059 1.06 1.059 2.807 0 3.88l-.039.038a2.719 2.719 0 0 1-3.879 0l-2.45-2.553a.801.801 0 0 0-1.123 0l-.05.052c-.32.357-.32.893 0 1.212a.75.75 0 0 0 .726.217c.51-.128 1.047.23 1.149.74a.946.946 0 0 1-.727 1.148 2.649 2.649 0 0 1-2.527-.74 2.796 2.796 0 0 1 0-3.905l.038-.025c1.098-1.085 2.808-1.085 3.892 0l2.463 2.488a.764.764 0 0 0 1.11 0l.038-.025a.855.855 0 0 0 0-1.187.876.876 0 0 0-.74-.217c-.51.128-1.02-.204-1.148-.727-.128-.51.204-1.021.727-1.149l.013-.013a2.703 2.703 0 0 1 2.527.766zm4.338-9.315v2.578h2.578v1.722h-2.578v2.59h-1.723v-2.602h-2.59v-1.71h2.59V9.325h1.723z"
                                                            fill-rule="nonzero"></path>
                                                    </g>
                                                </svg>
                                                <div class="GlobalWrite-topTitle">写想法</div>
                                            </div>
                                        </div>
                                        <div class="GlobalWrite-navBottom"><a
                                                class="GlobalWriteAnswerLater GlobalWrite-answerLater"
                                                href="https://www.zhihu.com/question/later" target="_blank" title="稍后答"
                                                data-za-detail-view-id="5370" style="transform: scale(1);">
                                                <div class="GlobalWrite-navWrapper">
                                                    <div class="GlobalWrite-navTitle">稍后答</div>
                                                </div>
                                            </a><a class="GlobalWrite-navDraft" href="https://www.zhihu.com/draft"
                                                target="_blank" rel="noopener noreferrer" title="草稿"
                                                data-za-not-track-link="true">
                                                <div class="GlobalWrite-navWrapper">
                                                    <div class="GlobalWrite-navTitle">草稿箱</div>
                                                </div>
                                            </a></div>
                                    </div>
                                    <div class="Card CreatorEntrance GlobalSideBar-creator"><a
                                            class="CreatorEntrance-link CreatorEntrance-Link--smallIcon"
                                            href="https://www.zhihu.com/creator" target="_blank"
                                            data-za-detail-view-id="6848">
                                            <div
                                                class="CreatorEntrance-hint ProfileSideCreator-creatorEntranceHint CreatorEntrancePage-hint--smallIcon">
                                                <svg class="Zi Zi--Creator CreatorEntrance-creatorIcon"
                                                    fill="currentColor" viewBox="0 0 24 24" width="24" height="24">
                                                    <path
                                                        d="M15.075 15.388l-3.024 3.024a4.041 4.041 0 0 0-1.014 1.697l-.26.868C7.844 20.986 4.91 21 2 21c.026-3.325 0-3.304.59-3.956 1.237-1.368 6.251-.68 6.44-2.976.043-.518-.36-1.06-.725-1.69C6.285 8.87 5.512 2 11.5 2c5.988 0 5.15 7.072 3.246 10.378-.357.62-.795 1.217-.724 1.77.073.571.477.958 1.053 1.24zm5.402 1.672c.523.55.523.646.523 3.94a535.11 535.11 0 0 0-4.434-.028l3.911-3.912zm-7.88 2.699c.111-.37.312-.705.584-.978l4.76-4.76a.291.291 0 0 1 .412 0l1.626 1.626a.291.291 0 0 1 0 .411l-4.76 4.76c-.272.273-.608.474-.978.585l-1.96.588a.219.219 0 0 1-.272-.272l.589-1.96zm9.157-6.742a.839.839 0 0 1 0 1.187l-.94.94a.28.28 0 0 1-.395 0l-1.563-1.563a.28.28 0 0 1 0-.395l.94-.94a.839.839 0 0 1 1.187 0l.771.771z"
                                                        fill-rule="evenodd"></path>
                                                </svg>
                                                <div class="CreatorEntrance-text">
                                                    <div class="CreatorEntrance-indexPageTitle">
                                                        <div class="css-3j2kqe">创作中心<span class="css-1ntg9ig">去开通</span>
                                                        </div>
                                                    </div>
                                                </div><svg
                                                    class="Zi Zi--ArrowRight CreatorEntrance-arrow CreatorEntrance-arrow--smallIcon"
                                                    fill="currentColor" viewBox="0 0 24 24" width="24" height="24">
                                                    <path
                                                        d="M9.218 16.78a.737.737 0 0 0 1.052 0l4.512-4.249a.758.758 0 0 0 0-1.063L10.27 7.22a.737.737 0 0 0-1.052 0 .759.759 0 0 0-.001 1.063L13 12l-3.782 3.716a.758.758 0 0 0 0 1.063z"
                                                        fill-rule="evenodd"></path>
                                                </svg>
                                            </div>
                                        </a></div>
                                    <div class="Card GlobalSideBar-category"><a
                                            href="https://www.zhihu.com/xen/market/ecom-page/1322510829447708672?utm_source=pccao"
                                            target="_blank" rel="noopener noreferrer" data-za-detail-view-id="8228"
                                            class="css-520aav"><img
                                                src="./(4 条消息) 首页 - 知乎_files/v2-743af2a453d5623d56a3e10f2cc8fb36_r.jpeg"
                                                width="100%" height="100%" alt=""></a>
                                        <ul class="GlobalSideBar-categoryList">
                                            <li class="GlobalSideBar-categoryItem"><a href="https://www.zhihu.com/lives"
                                                    target="_blank" title="Live" data-za-not-track-link="true"
                                                    type="button" class="Button Button--plain"
                                                    style="color: rgb(255, 207, 0);"><span
                                                        class="GlobalSideBar-categoryIcon"><svg class="Zi Zi--Live"
                                                            fill="currentColor" viewBox="0 0 24 24" width="24"
                                                            height="24">
                                                            <path
                                                                d="M13.693 10.354l1.634-7.542c.195-.901-.16-1.083-.798-.39l-9.18 9.97c-.638.693-.377 1.254.582 1.254h5.376l-1.634 7.542c-.195.901.16 1.083.798.39l9.18-9.97c.638-.693.377-1.254-.582-1.254h-5.376z">
                                                            </path>
                                                        </svg></span><span
                                                        class="GlobalSideBar-categoryLabel">Live</span></a></li>
                                            <li class="GlobalSideBar-categoryItem"><a href="https://www.zhihu.com/pub/"
                                                    target="_blank" title="书店" data-za-not-track-link="true"
                                                    type="button" class="Button Button--plain"
                                                    style="color: rgb(67, 212, 128);"><span
                                                        class="GlobalSideBar-categoryIcon"><svg class="Zi Zi--Ebook"
                                                            fill="currentColor" viewBox="0 0 24 24" width="24"
                                                            height="24">
                                                            <path
                                                                d="M16 17.649V2.931a.921.921 0 0 0-.045-.283.943.943 0 0 0-1.182-.604L4.655 5.235A.932.932 0 0 0 4 6.122v14.947c0 .514.421.931.941.931H19.06c.52 0 .941-.417.941-.93V7.292a.936.936 0 0 0-.941-.931h-.773v12.834a.934.934 0 0 1-.83.924L6.464 21.416c-.02.002 2.94-.958 8.883-2.881a.932.932 0 0 0 .653-.886z"
                                                                fill-rule="evenodd"></path>
                                                        </svg></span><span
                                                        class="GlobalSideBar-categoryLabel">书店</span></a></li>
                                            <li class="GlobalSideBar-categoryItem"><a
                                                    href="https://www.zhihu.com/roundtable" target="_blank" title="圆桌"
                                                    data-za-not-track-link="true" type="button"
                                                    class="Button Button--plain" style="color: rgb(0, 132, 255);"><span
                                                        class="GlobalSideBar-categoryIcon"><svg class="Zi Zi--Org"
                                                            fill="currentColor" viewBox="0 0 24 24" width="24"
                                                            height="24">
                                                            <path
                                                                d="M10.786 8.41a8.938 8.938 0 0 0-3.968-2.528c-.305-1.719.814-3.337 2.442-3.741 1.221-.405 2.646.101 3.46 1.011 1.045 1.38.915 3.64.814 4.348-.102 1.315-1.221 3.034-1.323 3.135-.305-.809-.814-1.517-1.425-2.225zm-2.442 2.832c-1.526.202-3.052 1.01-4.171 2.123-1.12-.404-1.934-1.314-2.137-2.427-.316-2.427 1.526-3.64 2.849-3.842 1.628-.371 2.849.505 4.07 1.415 1.146 1.012 2.035 2.63 2.035 2.73-.916-.202-1.832-.1-2.646 0zm4.986.303c.509-.607.931-1.586 1.12-2.225.318-1.039.61-3.134.203-4.651 1.323-1.011 3.154-1.011 4.477.303 1.235 1.146 1.017 2.933.814 3.438-.663 1.581-1.933 2.326-3.256 2.832-1.221.404-3.256.303-3.358.303zm-2.645 1.011c-.51.607-.916 1.416-1.221 2.326-.407 1.314-.643 3.06-.102 4.55-1.323 1.011-3.256 1.011-4.477-.202-1.198-1.124-1.018-2.932-.814-3.438.599-1.605 1.933-2.326 3.256-2.831.916-.304 3.256-.405 3.358-.405zm9.259-1.82c1.017.404 1.933 1.315 2.035 2.427.233 2.57-1.526 3.64-2.849 3.842-1.526 0-2.85-.505-4.07-1.415-1.018-.81-2.035-2.528-2.035-2.63.916.203 1.831.102 2.645 0 1.628-.404 3.053-1.112 4.274-2.224zm-6.716 4.854c1.065 1.08 2.442 2.022 4.07 2.528.306 1.719-.814 3.235-2.442 3.741-1.22.405-2.645-.101-3.46-1.011-1.1-1.481-1.017-3.54-.915-4.247.102-1.315 1.221-3.034 1.323-3.135.305.708.721 1.44 1.424 2.124z">
                                                            </path>
                                                        </svg></span><span
                                                        class="GlobalSideBar-categoryLabel">圆桌</span></a></li>
                                            <li class="GlobalSideBar-categoryItem"><a href="https://zhuanlan.zhihu.com/"
                                                    target="_blank" title="专栏" data-za-not-track-link="true"
                                                    type="button" class="Button Button--plain"
                                                    style="color: rgb(15, 136, 235);"><span
                                                        class="GlobalSideBar-categoryIcon"><svg class="Zi Zi--Edit"
                                                            fill="currentColor" viewBox="0 0 24 24" width="24"
                                                            height="24">
                                                            <path
                                                                d="M4.076 16.966a4.19 4.19 0 0 1 1.05-1.76l8.568-8.569a.524.524 0 0 1 .741 0l2.928 2.927a.524.524 0 0 1 0 .74l-8.568 8.57c-.49.49-1.096.852-1.761 1.051l-3.528 1.058a.394.394 0 0 1-.49-.488l1.06-3.53zM20.558 4.83c.59.59.59 1.546 0 2.136l-1.693 1.692a.503.503 0 0 1-.712 0l-2.812-2.812a.504.504 0 0 1 0-.712l1.693-1.693a1.51 1.51 0 0 1 2.135 0l1.389 1.389z">
                                                            </path>
                                                        </svg></span><span
                                                        class="GlobalSideBar-categoryLabel">专栏</span></a></li>
                                            <li class="GlobalSideBar-categoryItem"><a
                                                    href="https://www.zhihu.com/consult" target="_blank" title="付费咨询"
                                                    data-za-not-track-link="true" type="button"
                                                    class="Button Button--plain" style="color: rgb(84, 120, 240);"><span
                                                        class="GlobalSideBar-categoryIcon"><svg class="Zi Zi--Infinity"
                                                            fill="currentColor" viewBox="0 0 24 24" width="24"
                                                            height="24">
                                                            <path
                                                                d="M11.267 10.188h-2.69a.26.26 0 0 0-.261.26v.508c0 .149.117.26.262.26h2.896v1.54H8.578a.26.26 0 0 0-.262.259v.508c0 .15.117.26.262.26h2.896v2.31c0 .139.119.257.265.257h.522a.258.258 0 0 0 .265-.257v-2.31h2.896a.26.26 0 0 0 .262-.26v-.508a.257.257 0 0 0-.262-.26h-2.896v-1.54h2.896a.26.26 0 0 0 .262-.26v-.507a.257.257 0 0 0-.262-.26h-2.69l2.51-2.636a.26.26 0 0 0-.004-.366l-.423-.413a.253.253 0 0 0-.36.01L12 9.418 9.545 6.784a.248.248 0 0 0-.36-.011l-.423.413a.264.264 0 0 0-.004.366l2.509 2.636zM12 19.973c-1.101 0-2.16-.15-3.152-.43-.532.18-5.27 2.177-4.743 1.179.527-.998 1.58-2.746.806-3.25C3.11 15.936 2 13.822 2 11.486 2 6.8 6.477 3 12 3s10 3.8 10 8.487-4.477 8.486-10 8.486z">
                                                            </path>
                                                        </svg></span><span
                                                        class="GlobalSideBar-categoryLabel">付费咨询</span></a></li>
                                            <li class="GlobalSideBar-categoryItem"><a href="https://www.zhihu.com/wiki"
                                                    target="_blank" title="百科" data-za-not-track-link="true"
                                                    type="button" class="Button Button--plain"
                                                    style="color: rgb(88, 104, 209);"><span
                                                        class="GlobalSideBar-categoryIcon"><svg
                                                            class="Zi Zi--KnowledgeBase" fill="currentColor"
                                                            viewBox="0 0 24 24" width="24" height="24">
                                                            <path
                                                                d="M21 9.749v9.91c0 .74-.604 1.341-1.35 1.341H4.35C3.604 21 3 20.4 3 19.659V9.319c0-.503.283-.963.733-1.193l4.892-2.5V3.341c0-.74.604-1.341 1.35-1.341.267 0 .527.078.749.225l9.675 6.408c.375.249.601.668.601 1.116zM8.297 8.307L5.372 9.802A.223.223 0 0 0 5.25 10v8.54c0 .124.1.224.225.224h8.586a.223.223 0 1 0 .124-.41l-4.959-3.259a1.339 1.339 0 0 1-.601-1.116V8.506a.224.224 0 0 0-.328-.199z">
                                                            </path>
                                                        </svg></span><span
                                                        class="GlobalSideBar-categoryLabel">百科</span></a></li>
                                        </ul>
                                    </div>
                                    <div class="Card">
                                        <ul class="GlobalSideBar-navList">
                                            <li class="GlobalSideBar-navItem GlobalSideBar-starItem"><a target="_blank"
                                                    data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/collections/mine"><svg
                                                        class="Zi Zi--Star GlobalSideBar-navIcon" fill="currentColor"
                                                        viewBox="0 0 24 24" width="18" height="18">
                                                        <path
                                                            d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">我的收藏</span><span
                                                        class="GlobalSideBar-navNumber">0</span></a></li>
                                            <li class="GlobalSideBar-navItem GlobalSideBar-questionListItem"><a
                                                    target="_blank" data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/people/li-xiao-wei-93-74/following/questions"><svg
                                                        class="Zi Zi--HelpBubble GlobalSideBar-navIcon"
                                                        fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                                        <path
                                                            d="M5.74 4h12.52c.961 0 1.74.775 1.74 1.73V16.27c0 .955-.779 1.73-1.74 1.73h-3.825l-1.658 2.044a1 1 0 0 1-1.554 0l-1.658-2.044H5.74C4.78 18 4 17.224 4 16.27V5.73C4 4.775 4.778 4 5.74 4zM12 16a.976.976 0 0 0 .705-.287.951.951 0 0 0 .295-.712.954.954 0 0 0-.295-.714A.976.976 0 0 0 12 14a.962.962 0 0 0-.705.295A.961.961 0 0 0 11 15c0 .284.098.522.295.713A.975.975 0 0 0 12 16zm1.278-4.924a36.81 36.81 0 0 0 1.023-.975c.19-.193.354-.422.492-.688.138-.266.207-.575.207-.928 0-.448-.12-.864-.363-1.246a2.517 2.517 0 0 0-1.029-.906C13.164 6.111 12.652 6 12.072 6c-.624 0-1.17.133-1.638.399-.468.265-.824.6-1.068 1.005-.244.405-.366.804-.366 1.2 0 .19.077.368.231.531a.747.747 0 0 0 .567.246c.38 0 .638-.234.774-.703.144-.449.32-.788.528-1.019.208-.23.532-.345.972-.345.376 0 .683.114.921.342.238.229.357.51.357.841 0 .17-.039.328-.117.473a1.782 1.782 0 0 1-.288.396c-.114.118-.3.294-.555.526a9.71 9.71 0 0 0-.696.688c-.172.194-.31.418-.414.673a2.391 2.391 0 0 0-.156.906c0 .278.071.488.213.63a.716.716 0 0 0 .525.211c.4 0 .638-.216.714-.648.044-.203.077-.345.099-.426.022-.081.053-.162.093-.243.04-.081.101-.17.183-.268.082-.098.191-.21.327-.34z"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">我关注的问题</span><span
                                                        class="GlobalSideBar-navNumber">0</span></a></li>
                                            <li class="GlobalSideBar-navItem GlobalSideBar-inviteItem"><a
                                                    target="_blank" data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/question/waiting?type=invite"><svg
                                                        class="Zi Zi--Invite GlobalSideBar-navIcon" fill="currentColor"
                                                        viewBox="0 0 24 24" width="18" height="18">
                                                        <path
                                                            d="M4 10V8a1 1 0 1 1 2 0v2h2a1 1 0 0 1 0 2H6v2a1 1 0 0 1-2 0v-2H2a1 1 0 0 1 0-2h2zm10.455 2c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm-7 6c0-2.66 4.845-4 7.272-4C17.155 14 22 15.34 22 18v1.375c0 .345-.28.625-.625.625H8.08a.625.625 0 0 1-.625-.625V18z"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">我的邀请</span><span
                                                        class="GlobalSideBar-navNumber">103</span></a></li>
                                            <li class="GlobalSideBar-navItem GlobalSideBar-balanceItem"><a
                                                    target="_blank" data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/balance"><svg
                                                        class="Zi Zi--Balance GlobalSideBar-navIcon" fill="currentColor"
                                                        viewBox="0 0 24 24" width="18" height="18">
                                                        <path
                                                            d="M19 19.5H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10.5a2 2 0 0 1-2 2zm0-12a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 .5.5h3.75c1 0 1 2 2.75 2s1.75-2 2.75-2h3.75a.5.5 0 0 0 .5-.5v-2z"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">我的余额</span></a></li>
                                            <li class="GlobalSideBar-navItem GlobalSideBar-serviceItem"><a
                                                    target="_blank" data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/community"><svg
                                                        class="Zi Zi--Community GlobalSideBar-navIcon"
                                                        fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                                        <path
                                                            d="M5.74 4h12.52c.961 0 1.74.775 1.74 1.73V16.27c0 .955-.779 1.73-1.74 1.73h-3.825l-1.658 2.044a1 1 0 0 1-1.554 0l-1.658-2.044H5.74C4.78 18 4 17.224 4 16.27V5.73C4 4.775 4.778 4 5.74 4zM7 8.98c0 .554.449.996 1.003.996h4.994A.992.992 0 0 0 14 8.981a.997.997 0 0 0-1.003-.995H8.003A.992.992 0 0 0 7 8.98zm0 4c0 .554.446.996.995.996h8.01a.993.993 0 0 0 .995-.995.993.993 0 0 0-.995-.995h-8.01A.993.993 0 0 0 7 12.98z"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">站务中心</span></a></li>
                                            <li class="GlobalSideBar-navItem GlobalSideBar-help-centerItem"><a
                                                    target="_blank" data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/help-center"><svg width="18" height="18"
                                                        viewBox="0 0 18 18" class="GlobalSideBar-navIcon"
                                                        fill="currentColor">
                                                        <path
                                                            d="M9 1.5c2.835 0 5.152 2.195 5.247 4.949l.003.176v.253A2.25 2.25 0 0 1 15.75 9v2.25a2.25 2.25 0 0 1-1.5 2.122v.257c0 .547-.2 1.073-.557 1.482l-.102.109-1.06 1.06a.75.75 0 0 1-1.124-.99l.063-.07 1.06-1.061a.75.75 0 0 0 .213-.432l.007-.098V13.5H12a.75.75 0 0 1-.75-.75V7.5a.75.75 0 0 1 .75-.75h.75v-.125C12.75 4.628 11.076 3 9 3 6.98 3 5.34 4.541 5.254 6.464l-.004.286H6a.75.75 0 0 1 .743.648l.007.102v5.25a.75.75 0 0 1-.648.743L6 13.5H4.5a2.25 2.25 0 0 1-2.245-2.096l-.005-.154V9c0-.98.626-1.814 1.5-2.122v-.253C3.75 3.79 6.105 1.5 9 1.5z"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">帮助中心</span></a></li>
                                            <li class="GlobalSideBar-navItem GlobalSideBar-copyrightItem"><a
                                                    target="_blank" data-za-not-track-link="true" type="button"
                                                    class="Button GlobalSideBar-navLink Button--plain"
                                                    href="https://www.zhihu.com/copyright"><svg
                                                        class="Zi Zi--Copyright GlobalSideBar-navIcon"
                                                        fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                                        <path
                                                            d="M16.517 15.815a5.871 5.871 0 0 1-4.481 2.078 5.865 5.865 0 0 1-5.859-5.857 5.865 5.865 0 0 1 5.859-5.859c1.63 0 3.204.7 4.319 1.919.085.093.24.432.209.797a1.086 1.086 0 0 1-.436.779c-.248.193-.516.29-.797.29-.402 0-.7-.198-.814-.314A3.473 3.473 0 0 0 12 8.575a3.464 3.464 0 0 0-3.46 3.461 3.464 3.464 0 0 0 3.46 3.46 3.63 3.63 0 0 0 2.654-1.181c.136-.152.458-.306.806-.306.274 0 .542.095.773.274.35.269.45.588.473.809.032.308-.072.585-.188.723m4.686-7.699C20.67 6.883 19.96 5.82 19.07 4.929c-.891-.89-1.954-1.601-3.188-2.133A9.728 9.728 0 0 0 12 2a9.733 9.733 0 0 0-3.883.796c-1.234.532-2.297 1.243-3.186 2.133-.891.891-1.602 1.954-2.134 3.187A9.713 9.713 0 0 0 2 12a9.752 9.752 0 0 0 .797 3.883c.531 1.233 1.242 2.296 2.134 3.186.89.891 1.953 1.602 3.186 2.134A9.725 9.725 0 0 0 12 22a9.72 9.72 0 0 0 3.883-.797c1.233-.532 2.296-1.243 3.188-2.134.89-.89 1.601-1.953 2.132-3.186A9.73 9.73 0 0 0 22 12a9.69 9.69 0 0 0-.797-3.884"
                                                            fill-rule="evenodd"></path>
                                                    </svg><span class="GlobalSideBar-navText">版权服务中心</span></a></li>
                                        </ul>
                                    </div>
                                    <footer class="Footer"><a class="Footer-item" target="_blank"
                                            rel="noopener noreferrer" href="https://liukanshan.zhihu.com/">刘看山</a><span
                                            class="Footer-dot"></span><a class="Footer-item" target="_blank"
                                            rel="noopener noreferrer"
                                            href="https://www.zhihu.com/question/19581624">知乎指南</a><span
                                            class="Footer-dot"></span><a class="Footer-item" target="_blank"
                                            rel="noopener noreferrer"
                                            href="https://www.zhihu.com/term/zhihu-terms">知乎协议</a><span
                                            class="Footer-dot"></span><a class="Footer-item" target="_blank"
                                            rel="noopener noreferrer"
                                            href="https://www.zhihu.com/term/privacy">知乎隐私保护指引</a><br><a
                                            class="Footer-item" target="_blank"
                                            href="https://www.zhihu.com/app">应用</a><span class="Footer-dot"></span><a
                                            class="Footer-item" target="_blank" rel="noopener noreferrer"
                                            href="https://app.mokahr.com/apply/zhihu">工作</a><span
                                            class="Footer-dot"></span><button type="button"
                                            class="Button OrgCreateButton">申请开通知乎机构号</button><br><a class="Footer-item"
                                            target="_blank" rel="noopener noreferrer"
                                            href="https://zhuanlan.zhihu.com/p/28852607">侵权举报</a><span
                                            class="Footer-dot"></span><a class="Footer-item" target="_blank"
                                            rel="noopener noreferrer" href="http://www.12377.cn/">网上有害信息举报专区</a><br><a
                                            class="Footer-item" target="_blank" rel="noopener noreferrer"
                                            href="https://tsm.miit.gov.cn/dxxzsp/">京 ICP 证 110745 号</a><br><a
                                            class="Footer-item" target="_blank" rel="noopener noreferrer"
                                            href="https://beian.miit.gov.cn/">京 ICP 备 13052560 号 - 1</a><br><a
                                            class="Footer-item" target="_blank" rel="noopener noreferrer"
                                            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020088"><img
                                                src="./(4 条消息) 首页 - 知乎_files/v2-d0289dc0a46fc5b15b3363ffa78cf6c7.png">京公网安备
                                            11010802010035 号</a><br><span class="Footer-item">互联网药品信息服务资格证书<br>（京）- 非经营性
                                            - 2017 - 0067</span><span
                                            class="Footer-item">违法和不良信息举报：010-82716601</span><br><a class="Footer-item"
                                            target="_blank"
                                            href="https://www.zhihu.com/term/child-jubao">儿童色情信息举报专区</a><br><a
                                            class="Footer-item" target="_blank"
                                            href="https://www.zhihu.com/certificates">证照中心</a><br><a class="Footer-item"
                                            target="_blank" href="https://www.zhihu.com/contact">联系我们</a><span> © 2021
                                            知乎</span></footer>
                                </div>
                                <div class="Sticky--holder"
                                    style="position: static; inset: auto; display: block; float: none; margin: 0px; height: 1092px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <div data-zop-usertoken="{&quot;urlToken&quot;:&quot;li-xiao-wei-93-74&quot;}"></div>
            <div class="CornerButtons">
                <div class="CornerAnimayedFlex CornerAnimayedFlex--hidden"><button data-tooltip="回到顶部"
                        data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部"
                        type="button" class="Button CornerButton Button--plain"><svg class="Zi Zi--BackToTop"
                            aria-label="回到顶部" fill="currentColor" viewBox="0 0 24 24" width="24" height="24">
                            <path
                                d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z">
                            </path>
                        </svg></button></div>
            </div>
        </div>
    </div>
    <script id="js-initialData"
        type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"topstory\u002FgetRecommend\u002F":false}},"club":{"tags":{},"admins":{"data":[]},"members":{"data":[]},"explore":{"candidateSyncClubs":{}},"profile":{},"checkin":{},"comments":{"paging":{},"loading":{},"meta":{},"ids":{}},"postList":{"paging":{},"loading":{},"ids":{}},"recommend":{"data":[]},"silences":{"data":[]},"application":{"profile":null}},"entities":{"users":{"10738d93c0d999cafd6c5d35fa485882":{"uid":970470875484659700,"userType":"people","id":"10738d93c0d999cafd6c5d35fa485882"},"chen-shu-yong-72":{"id":"553405688a11bbe454c2b9da5cd09bc5","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F553405688a11bbe454c2b9da5cd09bc5","userType":"people","urlToken":"chen-shu-yong-72","name":"爱睡觉的Koala","headline":"今年目标2w粉～喜欢影视，动物，高颜值可爱的东西～","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-091a09e8f3ae35508a9933ddb0e981b4_m.jpg","isOrg":false,"gender":1,"badge":[],"followersCount":18512,"isFollowing":false,"isFollowed":false}},"questions":{},"answers":{"1662244682":{"id":1662244682,"type":"answer","url":"https:\u002F\u002Fapi.zhihu.com\u002Fanswers\u002F1662244682","author":{"id":"3ced69919d74a47c8dc35e9140412ff3","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F3ced69919d74a47c8dc35e9140412ff3","userType":"people","urlToken":"xiao-sheng-lin-9","name":"佳琪小仙女","headline":"大姐姐萌萌哒","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-6a04e4d480560bf1cc6d49f87e6666d1_m.jpg","isOrg":false,"gender":0,"badge":[],"followersCount":3196,"isFollowing":false,"isFollowed":false},"createdTime":1609832022,"updatedTime":1610265343,"voteupCount":783,"thanksCount":190,"commentCount":536,"isCopyable":true,"question":{"id":377957881,"type":"question","url":"https:\u002F\u002Fapi.zhihu.com\u002Fquestions\u002F377957881","author":{"id":"c268efa6b2c6c05419fc4780be959aff","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002Fc268efa6b2c6c05419fc4780be959aff","userType":"people","urlToken":"ni-hao-18-5-71","name":"给我自信叫靓女","headline":"怼人精","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-e8022f7b690bbcefa6f4d3d2ac1edbb1_m.jpg","isOrg":false,"gender":0,"badge":[],"followersCount":37,"isFollowing":false,"isFollowed":false},"title":"168cm，125斤妹纸，我是不是太胖了？","created":1583726719,"answerCount":5942,"followerCount":8950,"commentCount":80,"boundTopicIds":[670,14801,28596],"isFollowing":false,"excerpt":"","relationship":{"isAuthor":false},"detail":"","questionType":"normal"},"thumbnail":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-5d7754f93afe4ff4c9d7b6ec542d1f85_200x112.jpg","excerpt":"我比你矮一点点，最重的时候也有差不多114斤，现在瘦下来一点了，之前也没有人说我胖啊。所以还好吧，应该不算胖，只要整体匀称就可以了，姐妹自信一点最美丽。以前我也觉得自己微胖了，不瘦，没有骨感，而且现在时代变了，流行微胖了，哈哈是吧。 偶们的春天来了，记住，保持身材匀称就欧啦！ 放张图，看看我的小粗腿吧，不说的话你也看不出我有100+斤吧 看了很多评论，我想补充几句。 1，我开头就说了我没有125斤，我最重的时&hellip;","excerptNew":"我比你矮一点点，最重的时候也有差不多114斤，现在瘦下来一点了，之前也没有人说我胖啊。所以还好吧，应该不算胖，只要整体匀称就可以了，姐妹自信一点最美丽。以前我也觉得自己微胖了，不瘦，没有骨感，而且现在时代变了，流行微胖了，哈哈是吧。 偶们的春天来了，记住，保持身材匀称就欧啦！ 放张图，看看我的小粗腿吧，不说的话你也看不出我有100+斤吧 看了很多评论，我想补充几句。 1，我开头就说了我没有125斤，我最重的时&hellip;","previewType":"default","previewText":"","reshipmentSettings":"allowed","content":"\u003Cp\u003E我比你矮一点点，最重的时候也有差不多114斤，现在瘦下来一点了，之前也没有人说我胖啊。所以还好吧，应该不算胖，只要整体匀称就可以了，姐妹自信一点最美丽。以前我也觉得自己微胖了，不瘦，没有骨感，而且现在时代变了，流行微胖了，哈哈是吧。 偶们的春天来了，记住，保持身材匀称就欧啦！   \u003C\u002Fp\u003E\u003Cp\u003E放张图，看看我的小粗腿吧，不说的话你也看不出我有100+斤吧\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-1164cb8690c4ed41a09b766b04ada760_hd.jpg?source=1940ef5c\" data-rawwidth=\"1080\" data-rawheight=\"1176\" data-size=\"normal\" data-default-watermark-src=\"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-5130e842c4dc06bba1c5beb74339ec17_hd.jpg?source=1940ef5c\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-1164cb8690c4ed41a09b766b04ada760_r.jpg?source=1940ef5c\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E看了很多评论，我想补充几句。\u003C\u002Fp\u003E\u003Cp\u003E1，我开头就说了我没有125斤，我最重的时候才114，请看仔细。一般体重维持在110左右。还有你们都不看文字只看图的吗？我有说自己身材不好？我是以答题者的身份告诉提问者，只要匀称体重重一点也是可以好看的，好吗？！\u003C\u002Fp\u003E\u003Cp\u003E2，不少评论说我凡尔赛，大概了解了意思。我不是来炫身材的，这确实是真实的我，可能照片美颜过后会比本人好看很多，实际上我的大腿真的不细。\u003C\u002Fp\u003E\u003Cp\u003E3，不少人说我胸大，炫耀。我想说的是，真的只是中等偏上而已，再平常不过了。可能是衣服很修身加上拍照角度比较近的错觉而已。换件不聚拢的内衣和宽松一点的毛衣，也能穿出很平的效果，所以。。。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-9c19e0ffab37e42f2f7a77877d55ece4_hd.jpg?source=1940ef5c\" data-rawwidth=\"1080\" data-rawheight=\"737\" data-size=\"normal\" data-default-watermark-src=\"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-4c0067bd4a6e26cddacfcf663c3e2380_hd.jpg?source=1940ef5c\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-9c19e0ffab37e42f2f7a77877d55ece4_r.jpg?source=1940ef5c\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E最后，不会加好友的，答题只是娱乐一下，分享一下心得罢了，没有其他目的。最多最多有一点小心思是想听大家评论一下自己，打扰了，抱歉\u003C\u002Fp\u003E","markInfos":[],"relationship":{"isThanked":false,"isNothelp":false,"voting":0,"upvotedFolloweeIds":[]},"isLabeled":false,"visitedCount":168981}},"articles":{"285248052":{"id":285248052,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F285248052","author":{"id":"36f69162230003d316d0b8a6d8da20ba","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F36f69162230003d316d0b8a6d8da20ba","userType":"organization","urlToken":"liang-zi-wei-48","name":"量子位","headline":"有趣的AI&amp;前沿科技→_→ 公众号：QbitAI","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-ca6e7ffc10a0d10edbae635cee82d007_m.jpg","isOrg":true,"gender":0,"badge":[{"type":"identity","description":"已认证的官方帐号"},{"type":"best_answerer","description":"优秀回答者","topics":[],"topicNames":["人工智能","科技","科研","数学","自动驾驶"]}],"followersCount":327533,"isFollowing":false,"isFollowed":false},"title":"Ubuntu被曝严重漏洞：切换系统语言+输入几行命令，就能获取root权限","excerptTitle":"","imageUrl":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-445fac421aa55b8304429cd8e587b0ad_hd.jpg","commentPermission":"all","created":1605064523,"updated":1605083002,"voteupCount":618,"voting":0,"upvotedFollowees":[],"commentCount":62,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"晓查 发自 凹非寺 量子位 报道 | 公众号 QbitAI无需系统密码，就能添加新的sudo用户、获取root权限，事后还能删除不留痕迹。 这是GitHub安全研究员Kevin Backhouse发现的一个Ubuntu系统大漏洞。 这种攻击方法非常简单，Backhouse在官方博客中写道：&ldquo;使用&hellip;","excerptNew":"晓查 发自 凹非寺 量子位 报道 | 公众号 QbitAI无需系统密码，就能添加新的sudo用户、获取root权限，事后还能删除不留痕迹。 这是GitHub安全研究员Kevin Backhouse发现的一个Ubuntu系统大漏洞。 这种攻击方法非常简单，Backhouse在官方博客中写道：&ldquo;使用&hellip;","previewType":"default","previewText":"","column":{"id":"qbitai","type":"column","url":"https:\u002F\u002Fapi.zhihu.com\u002Fcolumns\u002Fqbitai","author":{"id":"0","type":"people","url":"","userType":"people","urlToken":"","name":"匿名用户","headline":"","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Faadd7b895_m.jpg"},"title":"量子位","imageUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7e0d98f2a88465d438867a387543a5ca_b.jpg","commentPermission":"public","intro":"","updated":1599141904,"isFollowing":false},"content":"\u003Cblockquote\u003E晓查 发自 凹非寺 \u003Cbr\u002F\u003E量子位 报道 | 公众号 QbitAI\u003C\u002Fblockquote\u003E\u003Cp\u003E无需系统密码，就能添加新的sudo用户、获取root权限，事后还能删除不留痕迹。\u003C\u002Fp\u003E\u003Cp\u003E这是GitHub安全研究员Kevin Backhouse发现的一个Ubuntu系统大漏洞。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f221aa68f4eea5b58a2a0fba0fc754be_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f221aa68f4eea5b58a2a0fba0fc754be_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E这种攻击方法非常简单，Backhouse在官方博客中写道：“使用终端中的一些简单命令，并单击几次鼠标，标准用户就可以为自己创建一个管理员帐户。”\u003C\u002Fp\u003E\u003Cp\u003E目前还在维护的Ubuntu操作系统均受到影响，包括\u003Cb\u003E20.10\u003C\u002Fb\u003E以及\u003Cb\u003E20.04\u003C\u002Fb\u003E、\u003Cb\u003E18.04\u003C\u002Fb\u003E、\u003Cb\u003E16.04\u003C\u002Fb\u003E三个LTS版。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7b8ab98277dc2da7a2025dc5e48829ce_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"462\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7b8ab98277dc2da7a2025dc5e48829ce_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003EBackhouse是如何操作的？我们接着往下看。\u003C\u002Fp\u003E\u003Ch2\u003E攻击方法\u003C\u002Fh2\u003E\u003Cp\u003E首先打开终端，在你的主目录下创建一个软链接：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Eln -s \u002Fdev\u002Fzero .pam_environment\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E（注：如果以上命令无法运行，说明已经存在名为.pam_environment的文件，请把这个文件重命名做好备份！）\u003C\u002Fp\u003E\u003Cp\u003E接下来，在系统设置中打开\u003Cb\u003E“区域和语言”\u003C\u002Fb\u003E，然后尝试更改语言。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44b06f6aa194bb2e4db6120fd54898e9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"784\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44b06f6aa194bb2e4db6120fd54898e9_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E该对话框会冻结，只需忽略它，然后返回到终端即可。\u003C\u002Fp\u003E\u003Cp\u003E此时，一个名为\u003Cb\u003Eaccounts-daemon\u003C\u002Fb\u003E的程序正在消耗100％的CPU内核，因此你的计算机可能会变慢并开始变热。\u003C\u002Fp\u003E\u003Cp\u003E在终端中，删除软链接。否则，你可能无法使用自己的帐户！\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Erm .pam_environment\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E下一步是将\u003Cb\u003ESIGSTOP\u003C\u002Fb\u003E信号发送到accounts-daemon，阻止它破坏该CPU内核。但是要做到这一点，首先需要知道accounts-daemon的PID。\u003C\u002Fp\u003E\u003Cp\u003E你可以通过运行\u003Cb\u003Etop\u003C\u002Fb\u003E来找到PID。由于accounts-daemon被卡在一个无限循环中，因此它很快进入top列表的顶部。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-afdf817ece3465b52da8161b04e1192b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-afdf817ece3465b52da8161b04e1192b_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E或者使用pidof命令来查找PID：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E$ pidof accounts-daemon\n597\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E接着用kill命令杀死SIGSTOP信号：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ekill -SIGSTOP 597\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E然后注销帐户，但首先需要设置一个计时器，保证在注销后重置accounts-daemon。否则，前面的努力都将白费。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Enohup bash -c “sleep 30s; kill -SIGSEGV 597; kill -SIGCONT 597”\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E注销后等待几秒钟，让SIGSEGV起效。如果漏洞利用成功，则会显示一系列对话框，让你创建一个新的用户帐户。这个新帐户具有\u003Cb\u003E管理员权限\u003C\u002Fb\u003E，可以运行sudo命令。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c7eb85617d162bd3bd82bfd3e3f84832_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c7eb85617d162bd3bd82bfd3e3f84832_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003EBackhouse将整个过程录成了2分多钟的视频，不明白操作方法的可以前去观看：\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Fwww.zhihu.com\u002Fzvideo\u002F1309815869246488576\" data-draft-node=\"block\" data-draft-type=\"link-card\"\u003E\u003C\u002Fa\u003E\u003Ch2\u003E攻击原理\u003C\u002Fh2\u003E\u003Cp\u003E该漏洞利用了Ubuntu系统中的两个错误：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E第一个是\u003Cb\u003Eaccountservice\u003C\u002Fb\u003E，它是管理计算机上用户帐户的服务。\u003C\u002Fli\u003E\u003Cli\u003E第二个是\u003Cb\u003EGNOME显示管理器\u003C\u002Fb\u003E（gdm3），它可以处理登录屏幕。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003Eaccounts-daemon漏洞\u003C\u002Fh2\u003E\u003Cp\u003Eaccountsservice守护程序（accounts-daemon）是一项系统服务，可以执行诸如创建新用户帐户或更改用户密码的操作，但也可以执行对安全性较不敏感的操作，例如更改用户的图标或首选语言。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-37e6bd52df4d607ea987135e304b60b4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-37e6bd52df4d607ea987135e304b60b4_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003EUbuntu使用了经过修改的accountservice服务版本，添加了一个名为is_in_pam_environment的函数，该函数会在用户的主目录中查找一个名为.pam_environment的文件并进行读取。\u003C\u002Fp\u003E\u003Cp\u003E将.pam_environment链接到\u002Fdev\u002Fzero可以让accountservice服务被拒绝。\u003C\u002Fp\u003E\u003Cp\u003E因为\u002Fdev\u002Fzero实际上是磁盘上不存在的特殊文件。它由操作系统提供，其行为就像一个无限长的文件，其中每个字节均为0。\u003C\u002Fp\u003E\u003Cp\u003E当is_in_pam_environment尝试读取.pam_environment时，它会通过软链接重定向到\u002Fdev\u002Fzero，然后由于\u002Fdev\u002Fzero无限长而陷入无限循环。\u003C\u002Fp\u003E\u003Cp\u003E如此操作会让accounts-daemon丧失其root权限，转而采用用户的较低特权。然后将SIGSEGV发送给帐户守护程序使其崩溃。\u003C\u002Fp\u003E\u003Ch2\u003EGNOME漏洞\u003C\u002Fh2\u003E\u003Cp\u003EGNOME显示管理器（gdm3）是Ubuntu用户界面的基本组件。它可以处理用户登录和注销时启动和停止用户会话之类的事情，还管理登录屏幕。\u003C\u002Fp\u003E\u003Cp\u003E当用户进行新系统的初始设置时，会启动一个对话框，它其实是一个单独的应用程序，称为gnome-initial-setup。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d2bb6472926dfb82519864d4cf21f490_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d2bb6472926dfb82519864d4cf21f490_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E当gdm3查询到用户数量为0时，会启动这个程序。那么gdm3如何检查系统上有多少用户？通过询问accounts-daemon！\u003C\u002Fp\u003E\u003Cp\u003E不幸的是，accounts-daemon已经被我们前面的操作整崩溃了，所以gdm3在检查超时后认为帐户数量为0，并启动gnome-initial-setup。\u003C\u002Fp\u003E\u003Cp\u003E而初始化设置的用户必须有管理员权限。\u003C\u002Fp\u003E\u003Ch2\u003E官方紧急修复\u003C\u002Fh2\u003E\u003Cp\u003EBackhouse于10月17日向Ubuntu和GNOME维护人员报告了这些错误，官方已经最新代码中提供了修复程序。建议所有Ubuntu用户都尽快安装更新。\u003C\u002Fp\u003E\u003Cp\u003E不过，该漏洞仅对桌面版Ubuntu有效。如果使用的是命令行界面，或者是GNOME之外的其他桌面环境，则暂时不受影响。\u003C\u002Fp\u003E\u003Cp\u003E博客地址：\u003Cbr\u002F\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fsecuritylab.github.com\u002Fresearch\u002FUbuntu-gdm3-accountsservice-LPE\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Esecuritylab.github.com\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eresearch\u002FUbuntu-gdm3-accountsservice-LPE\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E网友讨论：\u003Cbr\u002F\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fnews.ycombinator.com\u002Fitem%3Fid%3D25053238\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Enews.ycombinator.com\u002Fit\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eem?id=25053238\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E—完—\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.zhihu.com\u002Forg\u002Fliang-zi-wei-48\u002Fcolumns\" class=\"internal\"\u003E@量子位\u003C\u002Fa\u003E · 追踪AI技术和产品新动态\u003C\u002Fp\u003E\u003Cp\u003E深有感触的朋友，欢迎赞同、关注、分享三连վ&#39;ᴗ&#39; ի ❤\u003C\u002Fp\u003E","isLabeled":false,"visitedCount":49180},"311184005":{"id":311184005,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F311184005","author":{"id":"4fead0241377d378785f44ac68a27065","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F4fead0241377d378785f44ac68a27065","userType":"organization","urlToken":"yun-yin-le-qian-duan-ji-zhu-tuan-dui","name":"云音乐前端技术团队","headline":"","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-d100bfe808a6f97e061c34788691a3e2_m.jpg","isOrg":true,"gender":0,"badge":[{"type":"identity","description":"已认证的官方帐号"}],"followersCount":4617,"isFollowing":false,"isFollowed":false},"title":"如何基于 TypeScript 实现控制反转","excerptTitle":"","imageUrl":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-eb6b0f5b74d2bff541ca620192214b74_hd.jpg","commentPermission":"all","created":1606271456,"updated":1606271456,"voteupCount":434,"voting":0,"upvotedFollowees":[],"commentCount":24,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"图片来源：https:\u002F\u002Fbz.zzzmh.cn\u002F 本文作者：陈光通一. 前言最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS 框架，在这个过程中参考了 NestJS 、Midway 等开源项目，发现它们都引入了一项重要特性 &mdash;&mdash; IoC ，于是笔者借这个机会对 IoC 进行了一&hellip;","excerptNew":"图片来源：https:\u002F\u002Fbz.zzzmh.cn\u002F 本文作者：陈光通一. 前言最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS 框架，在这个过程中参考了 NestJS 、Midway 等开源项目，发现它们都引入了一项重要特性 &mdash;&mdash; IoC ，于是笔者借这个机会对 IoC 进行了一&hellip;","previewType":"default","previewText":"","column":{"id":"musicfe","type":"column","url":"https:\u002F\u002Fapi.zhihu.com\u002Fcolumns\u002Fmusicfe","author":{"id":"0","type":"people","url":"","userType":"people","urlToken":"","name":"匿名用户","headline":"","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Faadd7b895_m.jpg"},"title":"网易云音乐大前端团队","imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1e8e1df38bdab7cc86d308de9064ee3e_b.jpg","commentPermission":"public","intro":"","updated":1599168996,"isFollowing":false},"content":"\u003Cblockquote\u003E图片来源：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fbz.zzzmh.cn\u002F\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebz.zzzmh.cn\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E本文作者：陈光通\u003C\u002Fblockquote\u003E\u003Ch2\u003E\u003Cb\u003E一. 前言\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS 框架，在这个过程中参考了 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdocs.nestjs.com\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ENestJS\u003C\u002Fa\u003E 、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmidwayjs.org\u002Fmidway\u002Fioc.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMidway\u003C\u002Fa\u003E 等开源项目，发现它们都引入了一项重要特性 —— IoC ，于是笔者借这个机会对 IoC 进行了一些学习和梳理。本文主要参考了 Midway 的源码，按自己的理解基于 TypeScript 实现了 IoC，希望能给大家提供一些参考。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E二. IoC\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E按照\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.wikipedia.org\u002Fwiki\u002F%25E6%258E%25A7%25E5%2588%25B6%25E5%258F%258D%25E8%25BD%25AC\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E维基百科\u003C\u002Fa\u003E，IoC（Inversion of Control）控制反转，是面向对象编程中的一种设计原则，用来降低计算机代码之间的耦合度。\u003C\u002Fp\u003E\u003Cp\u003E在传统面向对象的编码过程中，当类与类之间存在依赖关系时，通常会直接在类的内部创建依赖对象，这样就导致类与类之间形成了耦合，依赖关系越复杂，耦合程度就会越高，而耦合度高的代码会非常难以进行修改和单元测试。而 IoC 则是专门提供一个容器进行依赖对象的创建和查找，将对依赖对象的控制权由类内部交到容器这里，这样就实现了类与类的解耦，保证所有的类都是可以灵活修改。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E2.1 耦合\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E直接看维基百科对 IoC 的解释可能会觉得云里雾里，到底什么是耦合呢？在这里我们举一个简单的例子，假设我们有 \u003Ccode\u003EA\u003C\u002Fcode\u003E、\u003Ccode\u003EB\u003C\u002Fcode\u003E 两个类，它们之间存在的依赖关系是 \u003Ccode\u003EA\u003C\u002Fcode\u003E 依赖 \u003Ccode\u003EB\u003C\u002Fcode\u003E，这种依赖关系在日常开发中很容易遇到，如果用传统的编码方式，我们一般会这么实现：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    constructor() {\n    }\n}\n\n\u002F\u002F a.ts\nclass A {\n    b:B;\n    constructor() {\n        this.b = new B();\n    }\n}\n\n\u002F\u002F main.ts\nconst a = new A();\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上述代码看上去似乎没有什么问题，然而，这时我们突然接到了新需求，处于最底层的 \u003Ccode\u003EB\u003C\u002Fcode\u003E 在初始化对象的时候需要传递一个参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    p: number;\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E修改完后，问题来了，由于 \u003Ccode\u003EB\u003C\u002Fcode\u003E 是在 \u003Ccode\u003EA\u003C\u002Fcode\u003E 的构造函数中进行实例化的，我们不得不在 \u003Ccode\u003EA\u003C\u002Fcode\u003E 的构造函数里传入这个 \u003Ccode\u003Ep\u003C\u002Fcode\u003E，然而 \u003Ccode\u003EA\u003C\u002Fcode\u003E 里面的 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 怎么来呢？我们当然不能写死它，否则设定这个参数就没有意义了，因此我们只能将 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 也设定为 \u003Ccode\u003EA\u003C\u002Fcode\u003E 构造函数中的一个参数，如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F a.ts\nclass A {\n    b:B;\n    constructor(p: number) {\n        this.b = new B(p);\n    }\n}\n\n\u002F\u002F main.ts\nconst a = new A(10);\nconsole.log(a); \u002F\u002F =&gt; A { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E更麻烦的是，当我们改完了 \u003Ccode\u003EA\u003C\u002Fcode\u003E 后，发现 \u003Ccode\u003EB\u003C\u002Fcode\u003E 所需要的 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 不能是一个 \u003Ccode\u003Enumber\u003C\u002Fcode\u003E，需要变更为 \u003Ccode\u003Estring\u003C\u002Fcode\u003E，于是我们又不得不重新修改 \u003Ccode\u003EA\u003C\u002Fcode\u003E 中对参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 的类型修饰。这时我们想想，假设还有上层类依赖 \u003Ccode\u003EA\u003C\u002Fcode\u003E，用的也是同样的方式，那是否上层类也要经历同样的修改。这就是耦合所带来的问题，明明是修改底层类的一项参数，却需要修改其依赖链路上的所有文件，当应用程序的依赖关系复杂到一定程度时，很容易形成牵一发而动全身的现象，为应用程序的维护带来极大的困难。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E2.2 解耦\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E事实上，我们可以发现，在上述例子中，真正需要参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 的仅仅只有 \u003Ccode\u003EB\u003C\u002Fcode\u003E，而 \u003Ccode\u003EA\u003C\u002Fcode\u003E 完全只是因为内部依赖的对象在实例化时需要 \u003Ccode\u003Ep\u003C\u002Fcode\u003E，才不得不定义这个参数，实际上它对 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 是什么根本不关心。于是，我们可以考虑将类所依赖对象的实例化从类本身剥离出来，比如上面的例子我们可以这样改写：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    p: number;\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\n\u002F\u002F a.ts\nclass A {\n    private b:B;\n    constructor(b: B) {\n        this.b = b;\n    }\n}\n\n\u002F\u002F main.ts\nconst b = new B(10);\nconst a = new A(b);\nconsole.log(a); \u002F\u002F A =&gt; { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在上述例子中，\u003Ccode\u003EA\u003C\u002Fcode\u003E 不再接收参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E ，而是选择直接接收其内部所依赖的对象，至于这个对象在哪里进行实例化则并不关心，这样有效解决了我们在上面遇到的问题，当我们需要修改参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 时，我们仅仅只要修改 \u003Ccode\u003EB\u003C\u002Fcode\u003E 即可，而不需要修改 \u003Ccode\u003EA\u003C\u002Fcode\u003E ，这个过程中我们就实现了类与类之间的解耦。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E2.3 容器\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E虽然我们实现了解耦，但我们仍需要自己初始化所有的类，并以构造函数参数的形式进行传递。如果存在一个全局的容器，里面\u003Cb\u003E预先注册\u003C\u002Fb\u003E好了我们所需对象的类定义以及初始化参数，每个对象有一个唯一的 key。那么当我们需要用到某个对象时，我们只需要告诉容器它对应的 key，就可以直接从容器中\u003Cb\u003E取出\u003C\u002Fb\u003E实例化好的对象，开发者就不用再关心对象的实例化过程，也不需要将依赖对象作为构造函数的参数在依赖链路上传递。\u003C\u002Fp\u003E\u003Cp\u003E也就是说，我们的容器必须具体两个功能，\u003Cb\u003E实例的注册\u003C\u002Fb\u003E和\u003Cb\u003E获取\u003C\u002Fb\u003E，这很容易让人联想到 Map，基于这个思路，我们首先简单实现一个容器：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F container.ts\nexport class Container {\n    bindMap = new Map();\n\n    \u002F\u002F 实例的注册\n    bind(identifier: string, clazz: any, constructorArgs: Array&lt;any&gt;) {\n        this.bindMap.set(identifier, {\n            clazz,\n            constructorArgs\n        });\n    }\n\n    \u002F\u002F 实例的获取\n    get&lt;T&gt;(identifier: string): T {\n        const target = this.bindMap.get(identifier);\n        const { clazz, constructorArgs } = target;\n        const inst = Reflect.construct(clazz, constructorArgs);\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这里我们用到了 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdeveloper.mozilla.org\u002Fzh-CN\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FReflect\u002Fconstruct\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EReflect.construct\u003C\u002Fa\u003E，它的行为有点像 new 操作符，帮助我们进行对象的实例化。有了容器之后，我们就可以彻底抛弃传参实现解耦，如下所示：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\n\u002F\u002F a.ts\nclass A {\n    b:B;\n    constructor() {\n        this.b = container.get(&#39;b&#39;);\n    }\n}\n\n\u002F\u002F main.ts\nconst container = new Container();\ncontainer.bind(&#39;a&#39;, A);\ncontainer.bind(&#39;b&#39;, B, [10]);\n\n\u002F\u002F 从容器中取出a\nconst a = container.get(&#39;a&#39;);\nconsole.log(a); \u002F\u002F A =&gt; { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E到这里为止，我们其实已经基本实现了 IoC，基于容器完成了类与类的解耦。但从代码量上看似乎并没有简洁多少，关键问题在于容器的初始化以及类的注册仍然让我们觉得繁琐，如果这部分代码能被封装到框架里面，所有类的注册都能够自动进行，同时，所有类在实例化的时候可以直接拿到依赖对象的实例，而不用在构造函数中手动指定，这样就可以彻底解放开发者的双手，专注编写类内部的逻辑，而这也就是所谓的 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.wikipedia.org\u002Fwiki\u002F%25E4%25BE%259D%25E8%25B5%2596%25E6%25B3%25A8%25E5%2585%25A5\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EDI（Dependency Injection）依赖注入\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E三. DI\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E很多人会混淆 DI 和 IoC，IoC 只是一种设计原则，而 DI 则是实现 IoC 的一种实现技术，简单来说就是我们可以将依赖注入给调用方，而不需要调用方来主动获取依赖。为了实现 DI，主要要解决以下两个问题：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E需要注册到 IoC 容器中的类能够在程序启动时自动进行注册\u003C\u002Fli\u003E\u003Cli\u003E在 IoC 容器中的类实例化时可以直接拿到依赖对象的实例，而不用在构造函数中手动指定\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E针对这两个问题其实也有不同的解决思路，比如大名鼎鼎的 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fspring.io\u002Fwhy-spring\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EJava Spring\u003C\u002Fa\u003E 需要开发者针对容器中的依赖关系定义一份 XML 文件，框架基于这份 XML 文件实例的注册和依赖的注入。但对于前端开发来说，基于 XML 的依赖管理显得太过繁琐，Midway 的 Injection 提供的思路是利用 TypeScript 具备的装饰器特性，通过对元数据的修饰来识别出需要进行注册以及注入的依赖，从而完成依赖的注入。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E3.1 Reflect Metadata\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E要使用装饰器解决上述提到的两个问题，我们需要先简单了解下 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjkchao.github.io\u002Ftypescript-book-chinese\u002Ftips\u002Fmetadata.html%23%25E5%259F%25BA%25E7%25A1%2580\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EReflect Metadata\u003C\u002Fa\u003E。Reflect Metadata 是 ES7 的一个提案，它主要用来在声明的时候添加和读取元数据，TypeScript 在 1.5+ 的版本已经支持它。\u003C\u002Fp\u003E\u003Cp\u003E元数据可以理解为针对类或类里面某个属性的描述信息，它本身不影响类的行为，但你可以在随时拿到某个类上定义的元数据，并根据这些元数据进行对类进行特定的操作。\u003C\u002Fp\u003E\u003Cp\u003EReflect Metadata 的使用非常简单，首先，你需要安装 reflect-metadata 库：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Enpm i reflect-metadata --save\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在 tsconfig.json 里，emitDecoratorMetadata 需要配置为 \u003Ccode\u003Etrue\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp\u003E然后，我们就可以根据 Reflect.defineMetadata 和 Reflect.getMetadata 进行元数据的定义和获取，比如：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eimport &#39;reflect-metadata&#39;;\n\nconst CLASS_KEY = &#39;ioc:key&#39;;\n\nfunction ClassDecorator() {\n  return function (target: any) {\n      Reflect.defineMetadata(CLASS_KEY, {\n        metaData: &#39;metaData&#39;,\n      }, target);\n      return target;\n  };\n}\n\n@ClassDecorator()\nclass D {\n  constructor(){}\n}\n\nconsole.log(Reflect.getMetadata(CLASS_KEY, D)); \u002F\u002F =&gt; { metaData: &#39;metaData&#39; }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E有了 Reflect，我们就可以对任意类进行标记，并对标记的类进行特殊的处理。更多有关元数据的内容可以参考 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjkchao.github.io\u002Ftypescript-book-chinese\u002Ftips\u002Fmetadata.html%23%25E5%259F%25BA%25E7%25A1%2580\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EReflect Metadata\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E3.2 Provider\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E回到我们刚刚提到的问题，我们需要在应用启动的时候自动对所有类进行定义和参数的注册，问题是并不是所有的类都需要注册到容器中，我们并不清楚哪些类需要注册的，同时也不清楚需要注册的类，它的初始化参数是什么样的。\u003C\u002Fp\u003E\u003Cp\u003E这里就可以引入元数据来解决这个问题，只要在定义的时候为这个类的元数据添加特殊的标记，就可以在扫描的时候识别出来。按照这个思路，我们先来实现一个装饰器标记需要注册的类，这个装饰器可以命名 Provider，代表它将会作为提供者给其他类进行消费。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F provider.ts\nimport &#39;reflect-metadata&#39;\n\nexport const CLASS_KEY = &#39;ioc:tagged_class&#39;;\n\nexport function Provider(identifier: string, args?: Array&lt;any&gt;) {\n    return function (target: any) {\n        Reflect.defineMetadata(CLASS_KEY, {\n            id: identifier,\n            args: args || []\n        }, target);\n        return target;\n    };\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E可以看到，这里的标记包含了 \u003Ccode\u003Eid\u003C\u002Fcode\u003E 和 \u003Ccode\u003Eargs\u003C\u002Fcode\u003E，其中 \u003Ccode\u003Eid\u003C\u002Fcode\u003E 是我们准备用来注册 IoC 容器的 \u003Ccode\u003Ekey\u003C\u002Fcode\u003E，而 \u003Ccode\u003Eargs\u003C\u002Fcode\u003E 则是实例初始化时需要的参数。Provider 可以以装饰器的形式直接进行使用，使用方式如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nimport { Provider } from &#39;provider&#39;;\n\n@Provider(&#39;b&#39;, [10])\nexport class B {\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E标记完成后，问题又来了，如果在应用启动的时候拿到这些类的定义呢？\u003C\u002Fp\u003E\u003Cp\u003E比较容易想到的思路是在启动的时候对所有文件进行扫描，获取每个文件导出的类，然后根据元数据进行绑定。简单起见，我们假设项目目录只有一级文件，实现如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F load.ts\nimport * as fs from &#39;fs&#39;;\nimport { CLASS_KEY } from &#39;.\u002Fprovider&#39;;\n\nexport function load(container) { \u002F\u002F container 为全局的 IoC 容器\n  const list = fs.readdirSync(&#39;.\u002F&#39;);\n\n  for (const file of list) {\n    if (\u002F\\.ts$\u002F.test(file)) { \u002F\u002F 扫描 ts 文件\n      const exports = require(`.\u002F${file}`);\n      for (const m in exports) {\n        const module = exports[m];\n        if (typeof module === &#39;function&#39;) {\n          const metadata = Reflect.getMetadata(CLASS_KEY, module);\n          \u002F\u002F 注册实例\n          if (metadata) {\n            container.bind(metadata.id, module, metadata.args)\n          }\n        }\n      }\n    }\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E那么现在，我们只要在 main 中运行 load 即可完成项目目录下所有被修饰的类的绑定工作，值得注意的是，load 和 Container 的逻辑是完全通用的，它们完全可以被封装成包，一个简化的 IoC 框架就成型了。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eimport { Container } from &#39;.\u002Fcontainer&#39;;\nimport { load } from &#39;.\u002Fload&#39;;\n\n\u002F\u002F 初始化 IOC 容器，扫描文件\nconst container = new Container();\nload(container);\n\nconsole.log(container.get(&#39;a&#39;)); \u002F\u002F A =&gt; { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E\u003Cb\u003E3.2 Inject\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E解决注册的问题后，我们来看上文中提到的第二个问题：如何在类初始化的时候能直接拿到它所依赖的对象的实例，而不需要手动通过构造函数进行传参。其实思路也很简单，我们已经将所有需要注册的类都放入了 IoC 容器，那么，当我们需要用到某个类时，在获取这个类的实例时可以递归遍历类上的属性，并从 IoC 容器中取出相应的对象并进行赋值，即可完成依赖的注入。\u003C\u002Fp\u003E\u003Cp\u003E那么，又是类似的问题，如何区分哪些属性需要注入？同样，我们可以使用元数据来解决。只要定义一个装饰器，以此来标记哪些属性需要注入即可，这个装饰器命名为 Inject，代表该属性需要注入依赖。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F inject.ts\nimport &#39;reflect-metadata&#39;;\n\nexport const PROPS_KEY = &#39;ioc:inject_props&#39;;\n\nexport function Inject() {\n    return function (target: any, targetKey: string) {\n        const annotationTarget = target.constructor;\n        let props = {};\n        if (Reflect.hasOwnMetadata(PROPS_KEY, annotationTarget)) {\n            props = Reflect.getMetadata(PROPS_KEY, annotationTarget);\n        }\n\n        props[targetKey] = {\n            value: targetKey\n        };\n\n        Reflect.defineMetadata(PROPS_KEY, props, annotationTarget);\n    };\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E需要注意的是，这里我们虽然是对属性进行修饰，但实际元数据是要定义在类上，以维护该类需要注入的属性列表，因此我们必须取 target.constructor 作为要操作的 target。另外，为了方便起见，这里直接用了属性名（targetKey）作为从 IoC 容器中实例对应的 key。\u003C\u002Fp\u003E\u003Cp\u003E然后，我们需要修改 IoC 容器的 get 方法，递归注入所有属性：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F container.ts\nimport { PROPS_KEY } from &#39;.\u002Finject&#39;;\n\nexport class Container {\n    bindMap = new Map();\n\n    bind(identifier: string, clazz: any, constructorArgs?: Array&lt;any&gt;) {\n        this.bindMap.set(identifier, {\n            clazz,\n            constructorArgs: constructorArgs || []\n        });\n    }\n\n    get&lt;T&gt;(identifier: string): T {\n        const target = this.bindMap.get(identifier);\n\n        const { clazz, constructorArgs } = target;\n\n        const props = Reflect.getMetadata(PROPS_KEY, clazz);\n        const inst = Reflect.construct(clazz, constructorArgs);\n\n        for (let prop in props) {\n            const identifier = props[prop].value;\n            \u002F\u002F 递归获取注入的对象\n            inst[ prop ] = this.get(identifier);\n        }\n        return inst;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E使用的时候，用 Inject 对需要的属性进行修饰即可：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F a.ts\nimport { Provider } from &#39;provider&#39;;\n\n@Provider(&#39;a&#39;)\nexport class A {\n    @Inject()\n    b: B;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E\u003Cb\u003E3.3 最终代码\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E经过上述调整后，最终我们的业务代码成了这样：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\n@Proivder(&#39;b&#39;, [10])\nclass B {\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\n\u002F\u002F a.ts\n@Proivder(&#39;a&#39;)\nclass A {\n    @Inject()\n    private b:B;\n}\n\n\u002F\u002F main.ts\nconst container = new Container();\nload(container);\n\nconsole.log(container.get(&#39;a&#39;));  \u002F\u002F =&gt; A { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E可以看到，代码中不会再有手动进行实例化的情况，无论要注册多少个类，框架层都可以自动处理好一切，并在这些类实例化的时候注入需要的属性。所有类可提供的实例都由类自身来维护，即使存在修改也不需要改动其他文件。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E小结\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E本文从类的解耦开始描述了 IoC 的必要性，基于 TypeScript 实现了一个精简的 IoC 框架。事实上，除了解耦外，IoC 还可以给我们带来很多好处，比如基于容器快速进行单元测试，分析类与类之间的依赖关系等等。\u003C\u002Fp\u003E\u003Cp\u003E虽然 IoC 最初是服务端提出的概念，但目前在前端领域也已经有了各种各样的应用，比如 AngularJS 就实现了自己的 IoC 框架来提升开发效率和模块化程度，有兴趣的读者可以通过官方的\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fangular.cn\u002Fguide\u002Fdependency-injection\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E案例\u003C\u002Fa\u003E感受一下 IoC 给前端编码带来的好处。相信随着前端职能的扩张，应用复杂度的提升，这些经典的设计原则正在逐渐成为每个前端开发的必修课程。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E参考资料\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cul\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjkchao.github.io\u002Ftypescript-book-chinese\u002Ftips\u002Fmetadata.html%23%25E5%259F%25BA%25E7%25A1%2580\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E深入理解TypeScript\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.wikipedia.org\u002Fwiki\u002F%25E6%258E%25A7%25E5%2588%25B6%25E5%258F%258D%25E8%25BD%25AC\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E控制反转-维基百科\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdeveloper.mozilla.org\u002Fzh-CN\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FReflect\u002Fconstruct\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMDN\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmidwayjs.org\u002Fmidway\u002Fioc.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMidway\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fangular.cn\u002Fguide\u002Fdependency-injection\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EAngularJS DI\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cblockquote\u003E本文发布自 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fx-orpheus\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E网易云音乐大前端团队\u003C\u002Fa\u003E，文章未经授权禁止任何形式的转载。我们常年招收前端、iOS、Android，如果你准备换工作，又恰好喜欢云音乐，那就加入我们 grp.music-fe(at)corp.netease.com！\u003C\u002Fblockquote\u003E","isLabeled":false,"visitedCount":14810},"338763096":{"id":338763096,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F338763096","author":{"id":"7df657f88c64f3aa3c9da3bd96ddf032","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F7df657f88c64f3aa3c9da3bd96ddf032","userType":"people","urlToken":"otakustay","name":"张立理","headline":"Web前端工程师","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-2f08aea15aaa195616c3c39c53e2be4e_m.jpg","isOrg":false,"gender":1,"badge":[{"type":"best_answerer","description":"优秀回答者","topics":[],"topicNames":["JavaScript","前端开发"]}],"followersCount":24245,"isFollowing":false,"isFollowed":false},"title":"从业务讲React Hook系列 - 异步与带延迟的加载指示器","excerptTitle":"","imageUrl":"","commentPermission":"all","created":1608631057,"updated":1608631057,"voteupCount":112,"voting":0,"upvotedFollowees":[],"commentCount":17,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"背景很多时候，在一个异步过程中，我们需要给用户一个指示，无论是一个遮罩层这样的阻塞式的，还是一个旋转的小圈这种非阻塞式的。 但从另一个角度看，不管异步的实际情况，二话不说地用上指示器，有时候反而会带来用户体验上的倒退。有不少100-200ms就能完&hellip;","excerptNew":"背景很多时候，在一个异步过程中，我们需要给用户一个指示，无论是一个遮罩层这样的阻塞式的，还是一个旋转的小圈这种非阻塞式的。 但从另一个角度看，不管异步的实际情况，二话不说地用上指示器，有时候反而会带来用户体验上的倒退。有不少100-200ms就能完&hellip;","previewType":"default","previewText":"","content":"\u003Ch2\u003E背景\u003C\u002Fh2\u003E\u003Cp\u003E很多时候，在一个异步过程中，我们需要给用户一个指示，无论是一个遮罩层这样的阻塞式的，还是一个旋转的小圈这种非阻塞式的。\u003C\u002Fp\u003E\u003Cp\u003E但从另一个角度看，不管异步的实际情况，二话不说地用上指示器，有时候反而会带来用户体验上的倒退。有不少100-200ms就能完成的请求，突兀地调起指示器，又很快消失，对用户会造成一种不适感。因此，我们需要根据异步的时长来做判断，短时间内不出现指示器，而超过一定时长后则出现。\u003C\u002Fp\u003E\u003Cp\u003E再从第三个角度看，无论指示器是不是调起，我们都要防止用户频繁地进行相同操作导致的请求多发、乱序等问题，所以一但当异步过程开始，要对用户的行为进行屏蔽，即相同的操作不再发起请求。\u003C\u002Fp\u003E\u003Cp\u003E所以总结一下，在异步+指示器的场合下，希望做到比较合理的用户体验，我们要达成以下3个要求：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E可以随异步的开始和结束，按一定的逻辑展示一个指示器。\u003C\u002Fli\u003E\u003Cli\u003E在很短时间内就结束的异步过程中，指示器不易出现。\u003C\u002Fli\u003E\u003Cli\u003E无论指示器出现与否，要让用户的相同操作不再触发异步过程。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E所以这不是一个简单的loading &amp;&amp; &lt;Loading \u002F&gt;的逻辑，需要做更多。\u003C\u002Fp\u003E\u003Ch2\u003E终版\u003C\u002Fh2\u003E\u003Cp\u003E我们最终的代码是这样的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EReact\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EFC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;react&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EButton\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ESpin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;antd&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EuseActionPending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;@huse\u002Faction-pending&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EuseDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;@huse\u002Fdebounce&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EUser\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;.\u002Fapi&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EUserList\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;.\u002FUserList&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EApp\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003EFC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EUser\u003C\u002Fspan\u003E\u003Cspan class=\"err\"\u003E[]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;([]);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseActionPending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Elist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EloadUsers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kr\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003EsetUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Estyle\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Emargin\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003E40\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}}&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Estyle\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EmarginBottom\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}}&gt;\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EButton\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"na\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;primary&#34;\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"na\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"na\"\u003EonClick\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EloadUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"err\"\u003E寻找更多基友\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EButton\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003ESpin\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Espinning\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}&gt;\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EUserList\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003ESpin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kr\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EApp\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E以下是实际的沙盒：\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fcodesandbox.io\u002Fs\u002Fdebounced-loading-n25jj\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-3b75a75afa2771967d1a0ef5a84b7a35_180x120.jpg\" data-image-width=\"1200\" data-image-height=\"630\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ecodesandbox.io\u002Fs\u002Fdeboun\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eced-loading-n25jj\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fcodesandbox.io\u002Fs\u002Fdebounced-loading-n25jj\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Edebounced-loading - CodeSandbox\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fcodesandbox.io\u002Fs\u002Fdebounced-loading-n25jj\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-3b75a75afa2771967d1a0ef5a84b7a35_180x120.jpg\" data-image-width=\"1200\" data-image-height=\"630\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ECodeSandbox - 延迟加载指示器\u003C\u002Fa\u003E\u003Cp\u003E我们给假的API提供了50%的概率150ms返回，50%概率1500ms返回。同时加载指示器会在异步超过200ms后出现。因此通过点击按钮，你会发现有一半的情况下界面会迅速刷新并且不会有Spin组件的干扰，而另一半情况则可以看到一个Spin效果。但无论点击多块，都不会重复地去请求用户列表。\u003C\u002Fp\u003E\u003Ch2\u003E分解\u003C\u002Fh2\u003E\u003Cp\u003E第一个问题，我们需要在异步开始的时候知道有异步了，结束的时候知道没异步了。在此我还是强调我们尽量用一个数字去管理这个状态，而不是boolean，万一真的异步并发了呢。所以，代码大概就是这样的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetPendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003EsetPendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Elist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Efinally\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetPendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E当然你会发现这样的代码随处都是，基本碰上一个异步就要写一遍，因此我们把它封装到了\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fecomfe.github.io\u002Freact-hooks\u002F%23\u002Fhook\u002Faction-pending\u002Fuse-action-pending\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@huse\u002Faction-pending\u003C\u002Fa\u003E里，调用useActionPending，给定任意一个异步的函数，就会返回给你一个签名相同的函数，外加一个pendingCount的数字。\u003C\u002Fp\u003E\u003Cp\u003E第二个问题，我们的pendingCount并不是直接对到Spin组件上去的，因为希望200ms以内不要出现。所以这本质上是一个debounce过程，当值变化后200ms内不要去响应。\u003C\u002Fp\u003E\u003Cp\u003E在这个环节，很多开发者都会进入一个误区，试图在异步的控制过程中去管理这个debounce，因为在多数人的直觉里，debounce是和“操作”、“行为”挂钩的，比如用户快速输入的时候要晚一些去发请求，这时就有“输入”这个操作存在。如果用这个思路，往往会写出类似这样的代码来：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetLoading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kc\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseRef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003EclearTimeout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ecurrent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ecurrent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetTimeout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetLoading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kc\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n            \u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Elist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Efinally\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EclearTimeout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ecurrent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E也别问我这代码对不对，我非常不喜欢管理定时器，特别是在混乱的异步流里去管理它。\u003C\u002Fp\u003E\u003Cp\u003E实际上解决这个问题有另一个思路，就是“值也是能被debounce的”。我们把“值发生变化”看作一个动作就行，只不过这个动作并非直接由用户触发。因此，我们可以通过effect去管理这个延迟，这也正是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fecomfe.github.io\u002Freact-hooks\u002F%23\u002Fhook\u002Fdebounce\u002Fuse-debounced-value\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@huse\u002Fdebounce\u003C\u002Fa\u003E中的useDebouncedValue提供的能力。\u003C\u002Fp\u003E\u003Cp\u003E在我们的实现中，首先把debounce做成了useDebouncedEffect，再去它非常简单地去管理useDebouncedValue：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kd\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ewait\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003Enumber\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EdebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nx\"\u003EuseDebouncedEffect\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ewait\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ewait\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EdebouncedValue\u003C\u002Fspan\u003E : \u003Cspan class=\"kt\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E当然useDebouncedEffect还是一个比较复杂的东西，有兴趣的同学可以\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fecomfe\u002Freact-hooks\u002Fblob\u002F1575164b0e68aab7e39361564b3b1fd8907f8416\u002Fpackages\u002Fdebounce\u002Fsrc\u002Findex.ts%23L7-L46\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E直接看源码\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Cp\u003E最后，我们有了一个完全与异步过程对应的pendingCount，以及一个基于pendingCount经过debounce衍生出来的loading属性。现在尝试把我们现有的几个状态组件起来，其实也是有一定复杂度的：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E只要有异步，按钮的点击就要无效化，所以直接使用!!pendingCount。\u003C\u002Fli\u003E\u003Cli\u003E在异步过程中，Spin要晚200ms出现，所以用loading。\u003C\u002Fli\u003E\u003Cli\u003E但异步结束的时候，Spin不应该再晚200ms消失（useDebouncedValue并不会管理你是true还是false），所以还要配合!!pendingCount配合使用。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E所以对应的逻辑就是：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F 只要有异步，不发请求\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EonClick\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EloadUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002F 对于Spin的情况，要同时判断有没有异步，以及是否应该出现\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Espinning\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003E总结\u003C\u002Fh2\u003E\u003Col\u003E\u003Cli\u003E把异步与状态关联起来使用，可以是一个很方便通用的hook实现。\u003C\u002Fli\u003E\u003Cli\u003E对值使用debounce，而不是对用户的具体动作，可以更方便地实现一些能力。\u003C\u002Fli\u003E\u003Cli\u003E组合使用异步状态及期debounce后的衍生状态，可以提供更友好地用户体验。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E当然用起来还不是特别简单，有需要的也可以再自行封装一个useAsyncLoading之类的业务向的hook来用。\u003C\u002Fp\u003E","isLabeled":false,"visitedCount":3524},"338773444":{"id":338773444,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F338773444","author":{"id":"8c6431b765b4867257de0376c4ee1593","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F8c6431b765b4867257de0376c4ee1593","userType":"people","urlToken":"github-stars","name":"Github掘金计划","headline":"用心发掘优质的开源项目。公号同名。","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-7486cb749e90ac231362fed3648360d0_m.jpg","isOrg":false,"gender":0,"badge":[],"followersCount":8681,"isFollowing":false,"isFollowed":false},"title":"Github标星26k+!一个神奇的软件！1分钟即可打造了一个科幻风格的终端","excerptTitle":"","imageUrl":"https:\u002F\u002Fpic2.zhimg.com\u002F50\u002Fv2-339fcc43b9261db696e50863c913cd59_hd.jpg","commentPermission":"all","created":1608628866,"updated":1608628867,"voteupCount":247,"voting":0,"upvotedFollowees":[],"commentCount":19,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"「Github掘金计划项目分类汇总（原创不易，若有帮助，欢迎分享\u002F点赞）：」 编程基础 ：精选编程基础如学习路线、编程语言相关的开源项目。计算机基础 ：精选计算机基础（操作系统、计算机网络、算法、数据结构）相关的开源项目。技术面试 ：精选技术面试相关&hellip;","excerptNew":"「Github掘金计划项目分类汇总（原创不易，若有帮助，欢迎分享\u002F点赞）：」 编程基础 ：精选编程基础如学习路线、编程语言相关的开源项目。计算机基础 ：精选计算机基础（操作系统、计算机网络、算法、数据结构）相关的开源项目。技术面试 ：精选技术面试相关&hellip;","previewType":"default","previewText":"","content":"\u003Cp\u003E\u003Cb\u003E「Github掘金计划项目分类汇总（原创不易，若有帮助，欢迎分享\u002F点赞）：」\u003C\u002Fb\u003E\u003Cbr\u002F\u003E \u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1632585323454971905%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E编程基础\u003C\u002Fa\u003E ：精选编程基础如学习路线、编程语言相关的开源项目。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1635325633234780161%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E计算机基础\u003C\u002Fa\u003E：精选计算机基础（操作系统、计算机网络、算法、数据结构）相关的开源项目。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1632589980491366403%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E技术面试\u003C\u002Fa\u003E ：精选技术面试相关的开源项目。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1632590550748938241%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E项目实战\u003C\u002Fa\u003E ：精选实战类型的开源项目。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E如果你也是科幻电影迷，想要让自己的终端变得更加极客。就像下面   这样。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1cafd2f64a324a5377a6528e23d084cc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1934\" data-rawheight=\"1094\" class=\"origin_image zh-lightbox-thumb\" width=\"1934\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1cafd2f64a324a5377a6528e23d084cc_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E你可以试试今天的推荐的开源项目。\u003C\u002Fp\u003E\u003Cp\u003EGithub 上有一个名字叫做 \u003Cb\u003E「 \u003C\u002Fb\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002FGitSquared\u002Fedex-ui\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Eedex-ui\u003C\u002Fa\u003E\u003Cb\u003E」\u003C\u002Fb\u003E 的项目，开源之后便受到了广大开发者的喜爱，多次登上了 Github Trending 榜单！\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44d94fe47aaef86e386d659bc05032f1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3124\" data-rawheight=\"2164\" class=\"origin_image zh-lightbox-thumb\" width=\"3124\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44d94fe47aaef86e386d659bc05032f1_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E简单来说，通过这个开源项目你可以非常简单地搭建一个科幻风格的终端仿真器，这个模拟器的外观和感觉都像科幻计算机界面一样。\u003C\u002Fp\u003E\u003Cp\u003E\u003Ci\u003E非常适合用来装逼~\u003C\u002Fi\u003E\u003C\u002Fp\u003E\u003Cp\u003E有点科幻电影既视感的感觉！\u003C\u002Fp\u003E\u003Cp\u003E并且，界面样式是可以自定义的，可以满足大部分小伙伴的需求。\u003C\u002Fp\u003E\u003Cp\u003E常见的主流操作系统比如 Linux、Windows、MacOS 都可以安装这个项目。\u003C\u002Fp\u003E\u003Cp\u003E你可以在 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002FGitSquared\u002Fedex-ui\u002Freleases\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Egithub.com\u002FGitSquared\u002Fe\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Edex-ui\u002Freleases\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E 这里进行下载安装。\u003C\u002Fp\u003E\u003Cp\u003E我们只需要选择一个适合自己操作系统的版本即可！\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d296f21ae292d984e5ba8bb4815ea5b8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2178\" data-rawheight=\"2128\" class=\"origin_image zh-lightbox-thumb\" width=\"2178\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d296f21ae292d984e5ba8bb4815ea5b8_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E如果你访问 Github 的速度比较慢的话，可以下方链接进行下载：\u003C\u002Fp\u003E\u003Cp\u003E链接: \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fpan.baidu.com\u002Fs\u002F1P2AC8kI0wv8DmzqyhVUxvw\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Epan.baidu.com\u002Fs\u002F1P2AC8k\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003EI0wv8DmzqyhVUxvw\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E 密码: 3p7f\u003C\u002Fp\u003E\u003Cp\u003E下载完成之后，我们直接双击安装即可，整个过程非常简单！\u003C\u002Fp\u003E\u003Cp\u003E安装完成之后，我们直接点击运行即可！你可以把它当做一个普通的软件来运行，非常方便。\u003C\u002Fp\u003E\u003Cp\u003E下图是在我的电脑运行的效果图。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-b0090290b8c7908daadc8eb1d5521f67_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3656\" data-rawheight=\"2312\" class=\"origin_image zh-lightbox-thumb\" width=\"3656\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-b0090290b8c7908daadc8eb1d5521f67_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E你可以通过双击\u003Ccode\u003Esettings.json\u003C\u002Fcode\u003E 这个文件的方式来修改一些默认配置比如主题。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f04d52c8a1bf4468a5bc198ef8b22c32_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3656\" data-rawheight=\"2312\" class=\"origin_image zh-lightbox-thumb\" width=\"3656\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f04d52c8a1bf4468a5bc198ef8b22c32_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E如下图所示，我这里把主题的修改为了 \u003Cb\u003E「apollo」\u003C\u002Fb\u003E 的样式。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-99070c08e3316529ecfdff0d72380e51_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3656\" data-rawheight=\"2312\" class=\"origin_image zh-lightbox-thumb\" width=\"3656\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-99070c08e3316529ecfdff0d72380e51_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Ca href=\"https:\u002F\u002Fwww.zhihu.com\u002Fquestion\u002F31092580\u002Fanswer\u002F1534887374\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-82fe7fbe24b1195472311b420da13697_120x160.jpg\" data-image-width=\"1352\" data-image-height=\"4804\" class=\"internal\"\u003E刷 LeetCode 吃力正常吗？\u003C\u002Fa\u003E\u003Cp\u003E\u003C\u002Fp\u003E","isLabeled":false,"visitedCount":28587}},"columns":{},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{"0_1610348810.215":{"id":"0_1610348810.215","type":"feed","offset":0,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","createdTime":1610348810,"updatedTime":1610348810,"target":{"id":311184005,"schema":"article"},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 311184005}","uninterestReasons":[{"reasonId":3,"reasonType":"topic","objectToken":"19628542","objectType":"topic","reasonText":"IOC"},{"reasonId":3,"reasonType":"topic","objectToken":"19766226","objectType":"topic","reasonText":"TypeScript"},{"reasonId":2,"reasonType":"creator","objectToken":"4fead0241377d378785f44ac68a27065","objectType":"people","reasonText":"云音乐前端技术团队创作的内容"}],"attachedInfo":"CvwCCMicxf7ilp\u002Fk\u002FQEQBxoJMTU3MjgxNjkyIOCD9\u002F0FKLIDMBhAAEoNCgRGUkZSEgEwGAAgAEoNCgRJQ0NPEgEwGAAgAFISZmVlZHJlX2FkZF9hcnRpY2xlWgcxMTIyNDI0cgkzMTExODQwMDV4AYIBUGh0dHBzOi8vcGljNC56aGltZy5jb20vdjItZWI2YjBmNWI3NGQyYmZmNTQxY2E2MjAxOTIyMTRiNzRfci5qcGc\u002Fc291cmNlPTE3MmFlMThiigEHbXVzaWNmZaoBCXJlY29tbWVuZPIBNQgAEjFydzowLjA7aXNvOjAuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJGVhY2Y4M2Q4LWIxYzgtNGU4OC1hOGNiLWUzMTIyYzZjZTUxN4gC9J+Tgu8ukgIgNGZlYWQwMjQxMzc3ZDM3ODc4NWY0NGFjNjhhMjcwNjWaAgA=","actors":[{"id":"19628542","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19628542","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fe82bab09c_s.jpg","name":"IOC","excerpt":"","introduction":""}],"showActorTime":false,"actionText":"IOC","actionTextTpl":"热门内容, 来自: {}","actionCard":false},"1_1610348810.832":{"id":"1_1610348810.832","type":"feed","offset":1,"verb":"COMMON_CARD","createdTime":1610348810,"updatedTime":1610348810,"target":{"id":"1331231587552743424","schema":"zvideo"},"brief":"{\"source\": \"TS\", \"type\": \"zvideo\", \"id\": 1331231587552743424}","uninterestReasons":[{"reasonId":3,"reasonType":"topic","objectToken":"19684455","objectType":"topic","reasonText":"女神"},{"reasonId":3,"reasonType":"topic","objectToken":"19550917","objectType":"topic","reasonText":"日本"},{"reasonId":3,"reasonType":"topic","objectToken":"20223317","objectType":"topic","reasonText":"工藤静香"},{"reasonId":3,"reasonType":"topic","objectToken":"19552207","objectType":"topic","reasonText":"美女"},{"reasonId":2,"reasonType":"creator","objectToken":"553405688a11bbe454c2b9da5cd09bc5","objectType":"people","reasonText":"爱睡觉的Koala 创作的内容"}],"attachedInfo":"CrgDCMicxf7ilp\u002Fk\u002FQEQYxoTMTMzMTIzMTU4NzU1Mjc0MzQyNCCCguX\u002FBSgaMA5AAUoNCgRUU1pDEgEwGAAgAFIZenZpZGVvX2NyZWF0b3JfYWRkX3p2aWRlb2iAwM+et4HfvBJyEzEzMzEyMzE1ODc1NTI3NDM0MjR4bIIBTmh0dHBzOi8vcGljMS56aGltZy5jb20vdjItNDkzMWZmZWE4OWVhOWNlOTdlMTg5ZGEyYWZiZDE0MjcuanBnP3NvdXJjZT0zODJlZTg5YaoBCXJlY29tbWVuZPIBcQgAEm1ydzo0ODMuMDtpc286MTUuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOlp2aWRlb0NyZWF0b3JMZXZlbFdlaWdodFJ1bGUsWlZpZGVvU0FXaGl0ZUxpc3RXZWlnaHRSdWxlLEN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJDg5ZmM1YjhhLWM2ODctNDdiZi04OTQ4LTA0N2NkN2U2ODNjZIgC9J+Tgu8ukgIgNTUzNDA1Njg4YTExYmJlNDU0YzJiOWRhNWNkMDliYzWaAgA=","actors":[{"id":"20223317","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F20223317","avatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002F50\u002Fv2-e495298ae7f12610a10e329b54db7829_s.jpg","name":"工藤静香","excerpt":"","introduction":""}],"showActorTime":false,"actionText":"工藤静香","actionTextTpl":"热门内容, 来自: {}","actionCard":false},"2_1610348810.175":{"id":"2_1610348810.175","type":"feed","offset":2,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","createdTime":1610348810,"updatedTime":1610348810,"target":{"id":338763096,"schema":"article"},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 338763096}","uninterestReasons":[{"reasonId":3,"reasonType":"topic","objectToken":"20013159","objectType":"topic","reasonText":"React"},{"reasonId":3,"reasonType":"topic","objectToken":"21285100","objectType":"topic","reasonText":"React Hooks"},{"reasonId":2,"reasonType":"creator","objectToken":"7df657f88c64f3aa3c9da3bd96ddf032","objectType":"people","reasonText":"张立理创作的内容"}],"attachedInfo":"CpACCMicxf7ilp\u002Fk\u002FQEQBxoJMTYzNDEwODA0IJGGh\u002F8FKHAwEUACSg0KBElDQ08SATAYACAAUhppdGVtY2ZfY29sbGVjdF9hZGRfYXJ0aWNsZXIJMzM4NzYzMDk2eDmqAQlyZWNvbW1lbmTyATcIABIzcnc6NDcuMDtpc286MTkuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJGViMmUxZDczLWMxNmUtNGVlOC1hYmMwLTM2ZGM2Y2M4OTk5N4gC9J+Tgu8ukgIgN2RmNjU3Zjg4YzY0ZjNhYTNjOWRhM2JkOTZkZGYwMzKaAgA=","actors":[{"id":"20013159","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F20013159","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002F6b12d4cbef521b02c5ab2e43e324081b_s.jpg","name":"React","excerpt":"","introduction":""}],"showActorTime":false,"actionText":"React","actionTextTpl":"热门内容, 来自: {}","actionCard":false},"3_1610348810.285":{"id":"3_1610348810.285","type":"feed","offset":3,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","createdTime":1610348810,"updatedTime":1610348810,"target":{"id":338773444,"schema":"article"},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 338773444}","uninterestReasons":[{"reasonId":3,"reasonType":"topic","objectToken":"19566035","objectType":"topic","reasonText":"GitHub"},{"reasonId":3,"reasonType":"topic","objectToken":"19585070","objectType":"topic","reasonText":"终端"},{"reasonId":3,"reasonType":"topic","objectToken":"19554298","objectType":"topic","reasonText":"编程"},{"reasonId":2,"reasonType":"creator","objectToken":"8c6431b765b4867257de0376c4ee1593","objectType":"people","reasonText":"Github掘金计划创作的内容"}],"attachedInfo":"CuICCMicxf7ilp\u002Fk\u002FQEQBxoJMTYzNDEzMTM5IIL1hv8FKPcBMBNAA0oNCgRGT0xVEgEwGAAgAFIXZm9sbG93X3VzZXJfYWRkX2FydGljbGVyCTMzODc3MzQ0NHgbggFQaHR0cHM6Ly9waWMxLnpoaW1nLmNvbS92Mi0zMzlmY2M0M2I5MjYxZGI2OTZlNTA4NjNjOTEzY2Q1OV9yLmpwZz9zb3VyY2U9MTcyYWUxOGKqAQlyZWNvbW1lbmTyATgIABI0cnc6LTEwLjA7aXNvOjIzLjA7Ymk6MC4wO2NyOjAuMDtydWxlczpDdXJyZW5jeVJhbmtlcvIBBQgLEgEx8gEKCAwSBk5vcm1hbPIBKAgKEiRjMWMwYThjYi1jMTYwLTRhYjMtYjA0MC03YmVlZWEyMTRjYzCIAvSfk4LvLpICIDhjNjQzMWI3NjViNDg2NzI1N2RlMDM3NmM0ZWUxNTkzmgIA","actors":[{"id":"19566035","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19566035","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-253cc14aaee49c2929ecda7376ebc661_s.png","name":"GitHub","excerpt":"","introduction":""}],"showActorTime":false,"actionText":"GitHub","actionTextTpl":"热门内容, 来自: {}","actionCard":false},"4_1610348810.205":{"id":"4_1610348810.205","type":"feed","offset":4,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","createdTime":1610348810,"updatedTime":1610348810,"target":{"id":285248052,"schema":"article"},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 285248052}","uninterestReasons":[{"reasonId":3,"reasonType":"topic","objectToken":"19557067","objectType":"topic","reasonText":"Ubuntu"},{"reasonId":3,"reasonType":"topic","objectToken":"19632761","objectType":"topic","reasonText":"Bash"},{"reasonId":3,"reasonType":"topic","objectToken":"19554300","objectType":"topic","reasonText":"Linux"},{"reasonId":2,"reasonType":"creator","objectToken":"36f69162230003d316d0b8a6d8da20ba","objectType":"people","reasonText":"量子位创作的内容"}],"attachedInfo":"Cu0CCMicxf7ilp\u002Fk\u002FQEQBxoJMTUxNTE3NjkyIMuurf0FKOoEMD5ABEoNCgRGUkZSEgEwGAAgAFISZmVlZHJlX2FkZF9hcnRpY2xlWgU0MDA2MnIJMjg1MjQ4MDUyeAGCAVBodHRwczovL3BpYzEuemhpbWcuY29tL3YyLTQ0NWZhYzQyMWFhNTViODMwNDQyOWNkOGU1ODdiMGFkX3IuanBnP3NvdXJjZT0xNzJhZTE4YooBBnFiaXRhaaoBCXJlY29tbWVuZPIBOAgAEjRydzotMjEuMDtpc286MzcuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJDg4NmQxMTkzLWEyMzAtNDI0My04NTUzLWY3MmYyMWZlZTFmMogC9J+Tgu8ukgIgMzZmNjkxNjIyMzAwMDNkMzE2ZDBiOGE2ZDhkYTIwYmGaAgA=","actors":[{"id":"19632761","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19632761","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-a7ec9d26971e38ffa710929331c96dd4_s.jpg","name":"Bash","excerpt":"","introduction":""}],"showActorTime":false,"actionText":"Bash","actionTextTpl":"热门内容, 来自: {}","actionCard":false},"5_1610348810.731":{"id":"5_1610348810.731","type":"feed","offset":5,"verb":"TOPIC_ACKNOWLEDGED_ANSWER","createdTime":1610348810,"updatedTime":1610348810,"target":{"id":1662244682,"schema":"answer"},"brief":"{\"source\": \"TS\", \"type\": \"answer\", \"id\": 1662244682}","uninterestReasons":[{"reasonId":3,"reasonType":"topic","objectToken":"19635727","objectType":"topic","reasonText":"瘦"},{"reasonId":3,"reasonType":"topic","objectToken":"19594665","objectType":"topic","reasonText":"胖"},{"reasonId":3,"reasonType":"topic","objectToken":"19552223","objectType":"topic","reasonText":"身材"},{"reasonId":2,"reasonType":"creator","objectToken":"3ced69919d74a47c8dc35e9140412ff3","objectType":"people","reasonText":"佳琪小仙女创作的内容"}],"attachedInfo":"CowDCMicxf7ilp\u002Fk\u002FQEQBBoJMzMyMzAxOTgwINas0P8FKI8GMJgEQAVKDAoDUkVUEgEwGAAgAFIXZmVlZHJlX3RvcGljX2FkZF9hbnN3ZXJaCDQ2MjY5MDUxcgoxNjYyMjQ0NjgyeA6CAUlodHRwczovL3BpYzMuemhpbWcuY29tLzUwL3YyLTVkNzc1NGY5M2FmZTRmZjRjOWQ3YjZlYzU0MmQxZjg1XzIwMHgxMTIuanBnigEJMzc3OTU3ODgxqgEJcmVjb21tZW5k8gFSCAASTnJ3Oi0yMC4wO2lzbzo0MC4wO2JpOjAuMDtjcjowLjA7cnVsZXM6SGlnaEludGVyYWN0aXZlV2VpZ2h0UnVsZSxDdXJyZW5jeVJhbmtlcvIBBQgLEgEx8gEKCAwSBk5vcm1hbPIBKAgKEiRjMTQ0NDE1ZS1mZDViLTRmMDktYjcyYi05YzcyMDM5ZGQxNmOIAvSfk4LvLpICIDNjZWQ2OTkxOWQ3NGE0N2M4ZGMzNWU5MTQwNDEyZmYzmgIA","actors":[{"id":"19552223","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19552223","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002F90dcfb4b2cec355b9126ff8fa1a51f34_s.jpeg","name":"身材","excerpt":"","introduction":""}],"showActorTime":false,"actionText":"身材","actionTextTpl":"热门内容, 来自: {}","actionCard":false}},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{},"zvideos":{"1331231587552743424":{"id":"1331231587552743424","type":"zvideo","title":"工藤静香年轻时有多美啊？！简直是从漫画里走出来的！！！","description":"BGM：柴 鱼 の c a l l i n g 粉丝想看工藤静香混剪那就出了一期～ 素材真难找......（电影画面和演唱画面）很多都是远古画质，我已经挑出最好的了，希望你们喜欢吧～ 前男友是林佳树，老公是木村拓哉！真的做梦都梦不到...... 审核大大辛苦了，给点推荐吧～喜欢可以点赞持下，谢谢啦！","memberId":60154120,"voteCount":26,"commentCount":14,"author":"chen-shu-yong-72","thumbnailExtraInfo":{"videoId":"1331231553494441984","type":"video","url":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-4931ffea89ea9ce97e189da2afbd1427.jpg?source=382ee89a","height":720,"width":1280,"duration":70,"playlist":{"ld":{"url":"https:\u002F\u002Fvdn1.vzuu.com\u002FSD\u002F083915f6-523c-11eb-b704-4a6d731ab1a6.mp4?disable_local_cache=1&bu=feedroot&expiration=1610352410&auth_key=1610352410-0-0-4571187c21ddb0db06f57acedccf1da4&f=mp4&v=hw","bitrate":480,"duration":70,"format":"mp4","fps":25,"height":478,"size":4257081,"width":848},"sd":{"url":"https:\u002F\u002Fvdn1.vzuu.com\u002FSD\u002F083915f6-523c-11eb-b704-4a6d731ab1a6.mp4?disable_local_cache=1&bu=feedroot&expiration=1610352410&auth_key=1610352410-0-0-4571187c21ddb0db06f57acedccf1da4&f=mp4&v=hw","bitrate":480,"duration":70,"format":"mp4","fps":25,"height":478,"size":4257081,"width":848},"hd":{"url":"https:\u002F\u002Fvdn1.vzuu.com\u002FHD\u002F083915f6-523c-11eb-b704-4a6d731ab1a6.mp4?disable_local_cache=1&bu=feedroot&expiration=1610352410&auth_key=1610352410-0-0-19ea61c64249b7b63ae4c4b47d36228d&f=mp4&v=hw","bitrate":773,"duration":70,"format":"mp4","fps":25,"height":720,"size":6848074,"width":1280}},"showMakerEntrance":false},"playCount":27479,"excerpt":"BGM：柴 鱼 の c a l l i n g 粉丝想看工藤静香混剪那就出了一期～ 素材真难找......（电影画面和演唱画面）很多都是远古画质，我已经挑出最好的了，希望你们喜欢吧～ 前男友是林佳树，老公是木村拓哉！真的做梦都梦不到...... 审核大大辛苦了，给点推荐吧～喜欢可以点赞持下，谢谢啦！"}},"feedAdverts":{"AD_1119497_16103488102280":{"id":"AD_1119497_16103488102280","type":"feed_advert","brief":"{\"source\":\"PR\",\"type\":\"feed_advert\",\"id\":1119497}","actionText":"","attachedInfo":"Cj4IyJzF\u002FuKWn+T9AZABAdoBJGJkMzdkODRkLTgxZDQtNDhkYi1hYzQ3LTk2YTllNTc5Nzc3OfIBBggMEgJBZDITLTE1OTc0MDY2NDg0MzUxNDI5Ng==","ad":{"count":0,"position":0,"adVerb":"PROMOTE_URL_CARD","closeTrack":"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ut=99dbd420cb1146aeb058bfdaa785c6bc&au=3662&nt=0&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&idi=8005&pf=4&ar=0.0000000000000029641190472714657&pdi=1533202984661615&ed=CjEEfR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5KBvYcEZaGDc%3D","revertCloseTrack":"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ed=CjEEch4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5w1fmEkh8gyg%3D&ar=0.0000000000000029641190472714657&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&idi=8005&ut=99dbd420cb1146aeb058bfdaa785c6bc&nt=0&pdi=1533202984661615&au=3662&pf=4","template":"web_image_feed","loadTracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ar=0.0000000000000029641190472714657&pf=4&nt=0&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&au=3662&idi=8005&pdi=1533202984661615&ed=CjEEeB4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5uJkne9k8Wuw%3D&ut=99dbd420cb1146aeb058bfdaa785c6bc"],"creatives":[{"landingUrl":"https:\u002F\u002Fgitee.com\u002Fgitee-go\u002Fhexo-oss-deploy?utm_source=zhgg&utm_medium=feed&utm_term=gotw3&utm_campaign=giteego","image":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-9226db1ba717a581cae921e33da94eed_400x224.png","image2x":"","title":"超详细 Hexo+Gitee go博客自动化部署小白教程","description":"你可以根据已有的文档和教程自己搭建 Hexo 站点，并结合 Gitee Go 发布部署 Hexo 到 对象存储，或通过 Fork 本仓库案例快速体验博客自动部署。","button":"查看详情","actionButton":false,"footer":{"value":""},"cta":{"value":"查看详情"},"brand":{"id":0,"name":"Gitee","logo":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a97867a4897ccdb22a4efe2bef53c934_250x250.png"},"appPromotionUrl":"","nativeUrl":"","deepUrl":"","videoWatchNum":0,"zaAdInfo":"CImqRBAHIgExXfL3v05glYtH","zaAdInfoJson":"{\"ad_id\":1119497,\"ad_zone_id\":7,\"category\":\"1\",\"timestamp\":1610348800,\"creative_id\":1164693}","externalClickUrl":"","impressionTracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?nt=0&pdi=1533202984661615&au=3662&pf=4&ut=99dbd420cb1146aeb058bfdaa785c6bc&idi=8005&ar=0.0000000000000029641190472714657&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&ed=CjEEeR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5cldzxyzz9t4%3D"],"clickTracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?idi=8005&ar=0.0000000000000029641190472714657&nt=0&ut=99dbd420cb1146aeb058bfdaa785c6bc&au=3662&pdi=1533202984661615&pf=4&ed=CjEEfh4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p59NKSInNZSL4%3D&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego"],"id":1119497,"name":"","conversionTracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ar=0.0000000000000029641190472714657&pf=4&idi=8005&ut=99dbd420cb1146aeb058bfdaa785c6bc&ed=CjEEfx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5GAAeCdoK920%3D&nt=0&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&pdi=1533202984661615&au=3662"],"contentType":"","targetToken":""}],"voteUpCount":0,"commentCount":0,"isFollowing":false,"category":1,"id":1119497,"canInteract":false,"userId":0,"ctr":0,"displayAdvertisingTag":true,"debugTracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ed=CjEEcx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5wCyQyfXjJ5s%3D&ut=99dbd420cb1146aeb058bfdaa785c6bc&ar=0.0000000000000029641190472714657&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&au=3662&pdi=1533202984661615&idi=8005&nt=0&pf=4"],"landPrefetch":false,"nativePrefetch":true,"isNewWebview":true,"experimentInfo":"{}","downloadSilent":false,"isSpeeding":false,"brand":{"name":"Gitee","logo":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a97867a4897ccdb22a4efe2bef53c934_250x250.png","type":"brand","actionText":""}},"adList":[],"adjson":"{\"ads\":[{\"id\":1119497,\"ad_zone_id\":7,\"template\":\"web_image_feed\",\"style\":\"psi_7\",\"impression_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026pdi=1533202984661615\\u0026ed=CjEEeB4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5uJkne9k8Wuw%3D\\u0026pf=4\\u0026au=3662\\u0026idi=8005\\u0026nt=0\\u0026ar=0.0000000000000029641190472714657\"],\"view_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?au=3662\\u0026idi=8005\\u0026ed=CjEEeR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5cldzxyzz9t4%3D\\u0026nt=0\\u0026ar=0.0000000000000029641190472714657\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026pdi=1533202984661615\\u0026pf=4\"],\"click_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?pf=4\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026pdi=1533202984661615\\u0026au=3662\\u0026nt=0\\u0026ed=CjEEfh4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p59NKSInNZSL4%3D\\u0026ar=0.0000000000000029641190472714657\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026idi=8005\"],\"close_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?nt=0\\u0026au=3662\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026pf=4\\u0026ar=0.0000000000000029641190472714657\\u0026ed=CjEEfR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5KBvYcEZaGDc%3D\\u0026pdi=1533202984661615\\u0026idi=8005\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\"],\"debug_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026au=3662\\u0026nt=0\\u0026idi=8005\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026ed=CjEEcx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5wCyQyfXjJ5s%3D\\u0026pdi=1533202984661615\\u0026pf=4\\u0026ar=0.0000000000000029641190472714657\"],\"conversion_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026ar=0.0000000000000029641190472714657\\u0026ed=CjEEfx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5GAAeCdoK920%3D\\u0026pf=4\\u0026pdi=1533202984661615\\u0026au=3662\\u0026nt=0\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026idi=8005\"],\"extra_conversion_tracks\":{\"call_back\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper_callback?si=5ba417e0-03e9-4b30-9146-07526eddb27a\\u0026os=3\\u0026zid=7\\u0026zaid=1119497\\u0026zcid=1164693\\u0026cid=1164693\\u0026event=__EVENTTYPE__\\u0026value=__EVENTVALUE__\\u0026ts=__TIMESTAMP__\\u0026cts=__TS__\\u0026mh=10738d93c0d999cafd6c5d35fa485882\"]},\"za_ad_info\":\"CImqRBAHIgExXfL3v05glYtH\",\"za_ad_info_json\":\"{\\\"ad_id\\\":1119497,\\\"ad_zone_id\\\":7,\\\"category\\\":\\\"1\\\",\\\"timestamp\\\":1610348800,\\\"creative_id\\\":1164693}\",\"creatives\":[{\"id\":1164693,\"asset\":{\"brand_name\":\"Gitee\",\"brand_logo\":\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a97867a4897ccdb22a4efe2bef53c934_250x250.png\",\"title\":\"超详细 Hexo+Gitee go博客自动化部署小白教程\",\"desc\":\"你可以根据已有的文档和教程自己搭建 Hexo 站点，并结合 Gitee Go 发布部署 Hexo 到 对象存储，或通过 Fork 本仓库案例快速体验博客自动部署。\",\"imgs\":[\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-9226db1ba717a581cae921e33da94eed_400x224.png\"],\"landing_url\":\"https:\u002F\u002Fgitee.com\u002Fgitee-go\u002Fhexo-oss-deploy?utm_source=zhgg\\u0026utm_medium=feed\\u0026utm_term=gotw3\\u0026utm_campaign=giteego\",\"img_size\":1,\"cta\":\"查看详情\",\"image_ratio_extra\":{\"width\":25,\"height\":14},\"native_asset\":{}}}],\"expand\":{\"display_advertising_tag\":true,\"is_new_webview\":true,\"is_cdn_speeding\":false,\"is_apk_market_direct\":false,\"interactive\":{\"deliver_time\":\"25 分钟前\",\"browse_string\":\"2.6 万\",\"participate_string\":\"36 \",\"slide_time_one\":3,\"slide_time_two\":-1,\"slide_end\":true}},\"experiment_info\":\"{}\",\"view_x_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?pdi=1533202984661615\\u0026ar=0.0000000000000029641190472714657\\u0026idi=8005\\u0026ed=CjEEewhlKSlzEDAGBWF7VVtoCXldend0LBZiSghheAZGdQ5_CnU_JCpHYFBQdi1KVnIfK1EnZ3F_FGtTCGdqQAJ4Cn0Nemp4aEY7WgBhegRdfApsWzdncGhGPVoGYGpSG3gOeh4vL31_EWpQBGV5B1pjTCMFcW5wdh9qU1QzdlFbdA9wXXNsdHQca1ELZilUXn8IK151YHJ6HTZBRSNxAV10CXkMe2Jwd8_W2rQc2DJV\\u0026au=3662\\u0026pf=4\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026nt=0\"],\"mobile_experiment\":{\"ad_comm_70\":\"0\",\"ad_ht\":\"1\",\"ad_new_rt\":\"0\",\"ad_pre_web\":\"1\",\"am_ad_logo\":\"0\",\"am_ad_video\":\"0\",\"am_adx_video\":\"2\",\"am_bid_ratio\":\"10000\",\"am_or_ad\":\"0\",\"am_test_ss\":\"0\",\"andr_pre_web\":\"2\",\"dd_send\":\"1\",\"dsp_replace\":\"1\",\"feed_adv_new\":\"1\",\"feed_advance\":\"0\",\"new_ad_logo\":\"0\",\"notify_page\":\"1\"}}]}","pcontent":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F338763096","ncontent":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F338773444","extInfo":{"contentType":null,"contentId":null,"priority":-1,"ecpm":-1}}}},"currentUser":"10738d93c0d999cafd6c5d35fa485882","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false}},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{}},"env":{"ab":{"config":{"experiments":[{"expId":"launch-qa_art2qa_new-3","expPrefix":"qa_art2qa_new","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-qa_cl_guest-2","expPrefix":"qa_cl_guest","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-qa_column_invite-2","expPrefix":"qa_column_invite","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-qa_repost-2","expPrefix":"qa_repost","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-re_unfriend_comm-2","expPrefix":"re_unfriend_comm","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-tp_zrec-8","expPrefix":"tp_zrec","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_adjust_new-11","expPrefix":"us_adjust_new","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_noti_count-8","expPrefix":"us_noti_count","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_andplay_d-2","expPrefix":"vd_andplay_d","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_hookupplay_an-2","expPrefix":"vd_hookupplay_an","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_ios_play-4","expPrefix":"vd_ios_play","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_timeguide-2","expPrefix":"vd_timeguide","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_video_replay-3","expPrefix":"vd_video_replay","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_zvideo_link-10","expPrefix":"vd_zvideo_link","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"zanswer-2","expPrefix":"zanswer","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"recnew_2th-3","expPrefix":"recnew_2th","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"li_video-3","expPrefix":"li_video","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_v_rank_v3-2","expPrefix":"se_v_rank_v3","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_meta_ss-4","expPrefix":"se_meta_ss","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"qa_cdzixun-1","expPrefix":"qa_cdzixun","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"qa_recmessa-1","expPrefix":"qa_recmessa","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"vd_video_tab-9","expPrefix":"vd_video_tab","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"li_tp_paidanswer-7","expPrefix":"li_tp_paidanswer","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"li_video_section-5","expPrefix":"li_video_section","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"tp_content-2","expPrefix":"tp_content","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"captcha_v2-1_v5","expPrefix":"captcha_v2","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"Test_Punk-2_v2","expPrefix":"Test_Punk","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"meta_ebook-2_v1","expPrefix":"meta_ebook","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"club_fn-1_v4","expPrefix":"club_fn","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"general_1-2_v1","expPrefix":"general_1","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"correct_gpu-6_v5","expPrefix":"correct_gpu","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_fix_ebook-2_v3","expPrefix":"se_fix_ebook","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_cvr_boost-4_v1","expPrefix":"se_cvr_boost","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_sug_topic-2_v2","expPrefix":"se_sug_topic","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false}],"params":[{"id":"captcha_v2","type":"Int","value":"0","layerId":"captcha_v2"},{"id":"webpImg","type":"Int","value":"1","layerId":"webpImg"},{"id":"se_no_rwrite","type":"Int","value":"0","chainId":"_gene_","layerId":"se_no_rwrite","key":164},{"id":"li_panswer_topic","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_602"},{"id":"web_unfriendly_comm","type":"String","value":"1","layerId":"webre_layer_1"},{"id":"ge_relation2","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_815","key":2796},{"id":"ge_emoji","type":"String","value":"0","chainId":"_gene_","layerId":"getp_layer_827","key":3209},{"id":"pf_noti_entry_num","type":"String","value":"2","chainId":"_all_","layerId":"pfus_layer_718"},{"id":"gue_bullet_second","type":"String","value":"1","layerId":"guevd_layer_1"},{"id":"ge_rec_2th","type":"String","value":"11","chainId":"_gene_","layerId":"geli_layer_965","key":3023},{"id":"gue_visit_n_artcard","type":"String","value":"1","layerId":"gueqa_layer_579"},{"id":"ge_search_ui","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_838","key":2898},{"id":"ge_prf_rec","type":"String","value":"0","chainId":"_gene_","layerId":"getop_layer_991","key":3040},{"id":"gue_zvideo_link","type":"String","value":"1","layerId":"guevd_layer_2"},{"id":"recnew_2th","type":"Int","value":"21","layerId":"recnew_2th"},{"id":"web_scl_rec","type":"String","value":"0","layerId":"webgw_layer_759"},{"id":"ge_upload","type":"String","value":"0","chainId":"_gene_","layerId":"geus_layer_839","key":2892},{"id":"gue_profile_video","type":"String","value":"1","layerId":"guevd_layer_5"},{"id":"gue_video_guide","type":"String","value":"1","layerId":"guevd_layer_625"},{"id":"gue_andplayd","type":"String","value":"1","layerId":"guevd_layer_686"},{"id":"correct_pos","type":"Int","value":"0","chainId":"_gene_","layerId":"correct_pos","key":104},{"id":"web_login","type":"String","value":"0","layerId":"webgw_layer_759"},{"id":"ge_video","type":"String","value":"1","chainId":"_gene_","layerId":"geli_layer_856","key":2831},{"id":"li_vip_verti_search","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_2"},{"id":"pfd_newbie","type":"Int","value":"0","chainId":"_gene_","layerId":"pfd_newbie","key":63},{"id":"se_esam","type":"Int","value":"0","chainId":"_gene_","layerId":"GB3o","key":280},{"id":"gue_card_test","type":"String","value":"1","layerId":"gueqa_layer_2"},{"id":"gue_cdzixun","type":"String","value":"0","layerId":"gueqa_layer_3"},{"id":"web_answer_list_ad","type":"String","value":"1","layerId":"webqa_layer_4"},{"id":"ge_v_rank_v3","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1047","key":2966},{"id":"tp_dingyue_video","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_4"},{"id":"web_creator_route","type":"String","value":"1","layerId":"webtop_layer_1"},{"id":"web_ad_banner","type":"String","value":"0","layerId":"webgw_layer_3"},{"id":"gue_art2qa","type":"String","value":"0","layerId":"gueqa_layer_579"},{"id":"gue_art_ui","type":"String","value":"2","layerId":"gueqa_layer_647"},{"id":"top_test_4_liguangyi","type":"String","value":"1","chainId":"_all_","layerId":"iosus_layer_1"},{"id":"general_1","type":"Int","value":"2","chainId":"_gene_","layerId":"general_1","key":8},{"id":"ge_sxzx","type":"String","value":"0","chainId":"_gene_","layerId":"gere_layer_990","key":3060},{"id":"ge_meta_ss","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_834","key":3079},{"id":"gue_sharp","type":"String","value":"1","layerId":"guevd_layer_686"},{"id":"meta_ebook","type":"Int","value":"1","layerId":"meta_ebook"},{"id":"se_fix_ebook","type":"Int","value":"0","chainId":"_gene_","layerId":"se_fix_ebook","key":103},{"id":"gue_self_censoring","type":"String","value":"1","layerId":"gueqa_layer_1"},{"id":"ge_sug_v2","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_1000","key":3189},{"id":"ge_entity","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_946","key":3036},{"id":"ge_newcard","type":"String","value":"3","chainId":"_gene_","layerId":"geus_layer_839","key":2997},{"id":"pf_adjust","type":"String","value":"1","chainId":"_all_","layerId":"pfus_layer_9"},{"id":"web_sem_ab","type":"String","value":"1","layerId":"webgw_layer_3"},{"id":"web_column_auto_invite","type":"String","value":"1","layerId":"webqa_layer_1"},{"id":"tp_zrec","type":"String","value":"1","chainId":"_all_","layerId":"tptp_layer_619"},{"id":"ge_newyanzhi","type":"String","value":"0","chainId":"_gene_","layerId":"geus_layer_1019","key":2788},{"id":"hot_card","type":"Int","value":"0","chainId":"_gene_","layerId":"hot_card","key":108},{"id":"se_cvr_boost","type":"Int","value":"1","chainId":"_gene_","layerId":"se_cvr_boost","key":183},{"id":"li_edu_page","type":"String","value":"old","chainId":"_all_","layerId":"lili_layer_580"},{"id":"gue_goods_card","type":"String","value":"0","layerId":"gueqa_layer_1"},{"id":"gue_q_share","type":"String","value":"0","layerId":"gueqa_layer_647"},{"id":"zr_expslotpaid","type":"String","value":"1","chainId":"_all_","layerId":"zrrec_layer_11"},{"id":"zr_slotpaidexp","type":"String","value":"1","chainId":"_all_","layerId":"zrrec_layer_5"},{"id":"gue_bulletmb","type":"String","value":"0","layerId":"guevd_layer_812"},{"id":"gue_iosplay","type":"String","value":"0","layerId":"guevd_layer_896"},{"id":"gue_vid_tab","type":"String","value":"7","layerId":"guevd_layer_900"},{"id":"show_ad","type":"Int","value":"0","chainId":"_gene_","layerId":"show_ad","key":27},{"id":"gue_repost","type":"String","value":"1","layerId":"gueqa_layer_671"},{"id":"gue_messrec","type":"String","value":"0","layerId":"gueqa_layer_769"},{"id":"ge_dipin_pre","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_1000","key":3124},{"id":"gue_v_serial","type":"String","value":"1","layerId":"guevd_layer_695"},{"id":"se_mix_video","type":"Int","value":"0","chainId":"_gene_","layerId":"gwrC","key":257},{"id":"web_heifetz_grow_ad","type":"String","value":"1","layerId":"webgw_layer_3"},{"id":"li_paid_answer_exp","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_3"},{"id":"li_sp_mqbk","type":"String","value":"0","chainId":"_all_","layerId":"lili_layer_748"},{"id":"ge_infinity6","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_815","key":2817},{"id":"ge_newbie3","type":"Int","value":"0","chainId":"_gene_","layerId":"ge_newbie3","key":180},{"id":"se_sug_topic","type":"Int","value":"0","chainId":"_gene_","layerId":"se_sug_topic","key":230},{"id":"qap_question_author","type":"String","value":"0","chainId":"_all_","layerId":"qapqa_layer_2"},{"id":"web_answerlist_ad","type":"String","value":"0","layerId":"webqa_layer_1"},{"id":"ge_item","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_945","key":2971},{"id":"gue_video_replay","type":"String","value":"2","layerId":"guevd_layer_3"},{"id":"zanswer","type":"Int","value":"1","layerId":"zanswer"},{"id":"club_fn","type":"Int","value":"1","layerId":"club_fn"},{"id":"pfd_newbie2","type":"Int","value":"0","chainId":"_gene_","layerId":"pfd_newbie2","key":71},{"id":"sug_fea","type":"Int","value":"0","chainId":"_gene_","layerId":"e0Sn","key":256},{"id":"li_video_section","type":"String","value":"1","chainId":"_all_","layerId":"lili_layer_7"},{"id":"gue_recmess","type":"String","value":"0","layerId":"gueqa_layer_795"},{"id":"ge_yuzhi_v1","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1029","key":3127},{"id":"ge_sug_rep","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1034","key":3158},{"id":"tp_topic_style","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_4"},{"id":"tp_contents","type":"String","value":"2","chainId":"_all_","layerId":"tptp_layer_627"},{"id":"Test_Punk","type":"Int","value":"0","layerId":"Test_Punk"},{"id":"correct_gpu","type":"Int","value":"5","chainId":"_gene_","layerId":"correct_gpu","key":66},{"id":"ge_rec_sup","type":"Int","value":"0","chainId":"_gene_","layerId":"ge_rec_sup","key":197},{"id":"ge_hard_s_ma","type":"String","value":"0","chainId":"_gene_","layerId":"geli_layer_856","key":3031},{"id":"web_audit_01","type":"String","value":"case1","layerId":"webre_layer_1"},{"id":"ge_guess","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_938","key":2912},{"id":"ge_kocbox","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_945","key":3087},{"id":"ge_corr","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_976","key":3041},{"id":"se_ffzx_jushen1","type":"String","value":"0","chainId":"_all_","layerId":"sese_layer_4"},{"id":"gue_bullet_guide","type":"String","value":"发个弹幕聊聊…","layerId":"guevd_layer_0"},{"id":"gue_fo_recom","type":"String","value":"0","layerId":"gueqa_layer_780"},{"id":"qap_question_visitor","type":"String","value":" 0","chainId":"_all_","layerId":"qapqa_layer_2"},{"id":"web_collection_guest","type":"String","value":"1","layerId":"webqa_layer_4"},{"id":"ge_usercard1","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_742","key":2740},{"id":"gue_playh_an","type":"String","value":"1","layerId":"guevd_layer_622"}],"chains":[{"chainId":"_all_"}],"encodedParams":"ClCkAOwKiQzPC1IL4AtMC2gADws\u002FABgBlgsIAPQLBwxnAHUM3Au1C+QKbAC3ABsANAwBAQELtADmAJsLRwAAATcMVgxCAMUA1wtgCw8M4Qu0ChIoAAEACwEAAAABAAABAgABAAAAAwAAAQAAAAAAAAAAAAEBBQAAAAABAA=="},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F87.0.4280.88 Safari\u002F537.36 Edg\u002F87.0.664.66"},"appViewConfig":{},"ctx":{"path":"\u002F","query":{},"href":"http:\u002F\u002Fwww.zhihu.com\u002F","host":"www.zhihu.com"},"trafficSource":"production","edition":{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"baiduSearch":false,"googleSearch":false,"miniProgram":false,"xiaomi":false},"theme":"light","enableShortcut":true,"referer":"","xUDID":"AHCb9jIW_xCPTjvxcc3tfJbrdGadTIBs6FE=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{},"logged":true,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"active":{"sendDigitsError":null,"activeConfirmSucceeded":null,"activeConfirmError":null},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false,"captchaBase64String":null,"captchaValidationMessage":null,"loginCaptchaExpires":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{"academy":{"tabs":[],"article":{}}},"rights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{},"videoSupport":{},"mcnManage":{},"tasks":{},"recentlyCreated":[]},"question":{"followers":{},"concernedFollowers":{},"answers":{},"hiddenAnswers":{},"updatedAnswers":{},"collapsedAnswers":{},"notificationAnswers":{},"invitedQuestions":{"total":{"count":null,"isEnd":false,"isLoading":false,"questions":[]},"followees":{"count":null,"isEnd":false,"isLoading":false,"questions":[]}},"laterQuestions":{"count":null,"globalWriteAnimate":false,"isEnd":false,"isLoading":false,"questions":[]},"waitingQuestions":{"recommend":{"isEnd":false,"isLoading":false,"questions":[]},"hot":{"isEnd":false,"isLoading":false,"questions":[]},"newest":{"isEnd":false,"isLoading":false,"questions":[]},"invite":{"isEnd":false,"isLoading":false,"questions":[]}},"invitationCandidates":{},"inviters":{},"invitees":{},"similarQuestions":{},"relatedCommodities":{},"bio":{},"brand":{},"permission":{},"adverts":{},"advancedStyle":{},"commonAnswerCount":0,"hiddenAnswerCount":0,"meta":{},"bluestarRanklist":{},"relatedSearch":{},"autoInvitation":{},"simpleConcernedFollowers":{},"draftStatus":{},"disclaimers":{}},"shareTexts":{},"answers":{"voters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"concernedUpvoters":{},"simpleConcernedUpvoters":{},"paidContent":{},"settings":{}},"banner":{},"topic":{"bios":{},"hot":{},"newest":{},"top":{},"unanswered":{},"questions":{},"followers":{},"contributors":{},"parent":{},"children":{},"bestAnswerers":{},"wikiMeta":{},"index":{},"intro":{},"meta":{},"schema":{},"creatorWall":{},"wikiEditInfo":{},"committedWiki":{},"landingBasicData":{},"landingExcellentItems":[],"landingExcellentEditors":[],"landingCatalog":[],"landingEntries":{}},"explore":{"recommendations":{},"specials":{"entities":{},"order":[]},"roundtables":{"entities":{},"order":[]},"collections":{},"columns":{}},"articles":{"voters":{}},"favlists":{"relations":{}},"pins":{"reviewing":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":"5_1610348810.731","items":[{"id":"0_1610348810.215","schema":"feed"},{"id":"1_1610348810.832","schema":"feed"},{"id":"2_1610348810.175","schema":"feed"},{"id":"AD_1119497_16103488102280","schema":"feedAdvert"},{"id":"3_1610348810.285","schema":"feed"},{"id":"4_1610348810.205","schema":"feed"},{"id":"5_1610348810.731","schema":"feed"}],"next":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv3\u002Ffeed\u002Ftopstory\u002Frecommend?session_token=b4d81f3dc95c9a9207fed6008163fc88&desktop=true&page_number=2&limit=6&action=down&after_id=5&ad_interval=-1","serverPayloadOrigin":{"data":[{"id":"0_1610348810.215","type":"feed","offset":0,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","created_time":1610348810,"updated_time":1610348810,"target":{"id":311184005,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F311184005","author":{"id":"4fead0241377d378785f44ac68a27065","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F4fead0241377d378785f44ac68a27065","user_type":"organization","url_token":"yun-yin-le-qian-duan-ji-zhu-tuan-dui","name":"云音乐前端技术团队","headline":"","avatar_url":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-d100bfe808a6f97e061c34788691a3e2_m.jpg","is_org":true,"gender":0,"badge":[{"type":"identity","description":"已认证的官方帐号"}],"followers_count":4617,"is_following":false,"is_followed":false},"title":"如何基于 TypeScript 实现控制反转","excerpt_title":"","image_url":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-eb6b0f5b74d2bff541ca620192214b74_hd.jpg","comment_permission":"all","created":1606271456,"updated":1606271456,"voteup_count":434,"voting":0,"upvoted_followees":[],"comment_count":24,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"图片来源：https:\u002F\u002Fbz.zzzmh.cn\u002F 本文作者：陈光通一. 前言最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS 框架，在这个过程中参考了 NestJS 、Midway 等开源项目，发现它们都引入了一项重要特性 &mdash;&mdash; IoC ，于是笔者借这个机会对 IoC 进行了一&hellip;","excerpt_new":"图片来源：https:\u002F\u002Fbz.zzzmh.cn\u002F 本文作者：陈光通一. 前言最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS 框架，在这个过程中参考了 NestJS 、Midway 等开源项目，发现它们都引入了一项重要特性 &mdash;&mdash; IoC ，于是笔者借这个机会对 IoC 进行了一&hellip;","preview_type":"default","preview_text":"","column":{"id":"musicfe","type":"column","url":"https:\u002F\u002Fapi.zhihu.com\u002Fcolumns\u002Fmusicfe","author":{"id":"0","type":"people","url":"","user_type":"people","url_token":"","name":"匿名用户","headline":"","avatar_url":"https:\u002F\u002Fpic4.zhimg.com\u002Faadd7b895_m.jpg"},"title":"网易云音乐大前端团队","image_url":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1e8e1df38bdab7cc86d308de9064ee3e_b.jpg","comment_permission":"public","intro":"","updated":1599168996,"is_following":false},"content":"\u003Cblockquote\u003E图片来源：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fbz.zzzmh.cn\u002F\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebz.zzzmh.cn\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E本文作者：陈光通\u003C\u002Fblockquote\u003E\u003Ch2\u003E\u003Cb\u003E一. 前言\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E最近接到任务，需要给团队封装一个基于 EggJS 的上层 NodeJS 框架，在这个过程中参考了 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdocs.nestjs.com\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ENestJS\u003C\u002Fa\u003E 、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmidwayjs.org\u002Fmidway\u002Fioc.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMidway\u003C\u002Fa\u003E 等开源项目，发现它们都引入了一项重要特性 —— IoC ，于是笔者借这个机会对 IoC 进行了一些学习和梳理。本文主要参考了 Midway 的源码，按自己的理解基于 TypeScript 实现了 IoC，希望能给大家提供一些参考。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E二. IoC\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E按照\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.wikipedia.org\u002Fwiki\u002F%25E6%258E%25A7%25E5%2588%25B6%25E5%258F%258D%25E8%25BD%25AC\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E维基百科\u003C\u002Fa\u003E，IoC（Inversion of Control）控制反转，是面向对象编程中的一种设计原则，用来降低计算机代码之间的耦合度。\u003C\u002Fp\u003E\u003Cp\u003E在传统面向对象的编码过程中，当类与类之间存在依赖关系时，通常会直接在类的内部创建依赖对象，这样就导致类与类之间形成了耦合，依赖关系越复杂，耦合程度就会越高，而耦合度高的代码会非常难以进行修改和单元测试。而 IoC 则是专门提供一个容器进行依赖对象的创建和查找，将对依赖对象的控制权由类内部交到容器这里，这样就实现了类与类的解耦，保证所有的类都是可以灵活修改。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E2.1 耦合\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E直接看维基百科对 IoC 的解释可能会觉得云里雾里，到底什么是耦合呢？在这里我们举一个简单的例子，假设我们有 \u003Ccode\u003EA\u003C\u002Fcode\u003E、\u003Ccode\u003EB\u003C\u002Fcode\u003E 两个类，它们之间存在的依赖关系是 \u003Ccode\u003EA\u003C\u002Fcode\u003E 依赖 \u003Ccode\u003EB\u003C\u002Fcode\u003E，这种依赖关系在日常开发中很容易遇到，如果用传统的编码方式，我们一般会这么实现：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    constructor() {\n    }\n}\n\n\u002F\u002F a.ts\nclass A {\n    b:B;\n    constructor() {\n        this.b = new B();\n    }\n}\n\n\u002F\u002F main.ts\nconst a = new A();\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上述代码看上去似乎没有什么问题，然而，这时我们突然接到了新需求，处于最底层的 \u003Ccode\u003EB\u003C\u002Fcode\u003E 在初始化对象的时候需要传递一个参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    p: number;\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E修改完后，问题来了，由于 \u003Ccode\u003EB\u003C\u002Fcode\u003E 是在 \u003Ccode\u003EA\u003C\u002Fcode\u003E 的构造函数中进行实例化的，我们不得不在 \u003Ccode\u003EA\u003C\u002Fcode\u003E 的构造函数里传入这个 \u003Ccode\u003Ep\u003C\u002Fcode\u003E，然而 \u003Ccode\u003EA\u003C\u002Fcode\u003E 里面的 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 怎么来呢？我们当然不能写死它，否则设定这个参数就没有意义了，因此我们只能将 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 也设定为 \u003Ccode\u003EA\u003C\u002Fcode\u003E 构造函数中的一个参数，如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F a.ts\nclass A {\n    b:B;\n    constructor(p: number) {\n        this.b = new B(p);\n    }\n}\n\n\u002F\u002F main.ts\nconst a = new A(10);\nconsole.log(a); \u002F\u002F =&gt; A { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E更麻烦的是，当我们改完了 \u003Ccode\u003EA\u003C\u002Fcode\u003E 后，发现 \u003Ccode\u003EB\u003C\u002Fcode\u003E 所需要的 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 不能是一个 \u003Ccode\u003Enumber\u003C\u002Fcode\u003E，需要变更为 \u003Ccode\u003Estring\u003C\u002Fcode\u003E，于是我们又不得不重新修改 \u003Ccode\u003EA\u003C\u002Fcode\u003E 中对参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 的类型修饰。这时我们想想，假设还有上层类依赖 \u003Ccode\u003EA\u003C\u002Fcode\u003E，用的也是同样的方式，那是否上层类也要经历同样的修改。这就是耦合所带来的问题，明明是修改底层类的一项参数，却需要修改其依赖链路上的所有文件，当应用程序的依赖关系复杂到一定程度时，很容易形成牵一发而动全身的现象，为应用程序的维护带来极大的困难。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E2.2 解耦\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E事实上，我们可以发现，在上述例子中，真正需要参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 的仅仅只有 \u003Ccode\u003EB\u003C\u002Fcode\u003E，而 \u003Ccode\u003EA\u003C\u002Fcode\u003E 完全只是因为内部依赖的对象在实例化时需要 \u003Ccode\u003Ep\u003C\u002Fcode\u003E，才不得不定义这个参数，实际上它对 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 是什么根本不关心。于是，我们可以考虑将类所依赖对象的实例化从类本身剥离出来，比如上面的例子我们可以这样改写：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    p: number;\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\n\u002F\u002F a.ts\nclass A {\n    private b:B;\n    constructor(b: B) {\n        this.b = b;\n    }\n}\n\n\u002F\u002F main.ts\nconst b = new B(10);\nconst a = new A(b);\nconsole.log(a); \u002F\u002F A =&gt; { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在上述例子中，\u003Ccode\u003EA\u003C\u002Fcode\u003E 不再接收参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E ，而是选择直接接收其内部所依赖的对象，至于这个对象在哪里进行实例化则并不关心，这样有效解决了我们在上面遇到的问题，当我们需要修改参数 \u003Ccode\u003Ep\u003C\u002Fcode\u003E 时，我们仅仅只要修改 \u003Ccode\u003EB\u003C\u002Fcode\u003E 即可，而不需要修改 \u003Ccode\u003EA\u003C\u002Fcode\u003E ，这个过程中我们就实现了类与类之间的解耦。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E2.3 容器\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E虽然我们实现了解耦，但我们仍需要自己初始化所有的类，并以构造函数参数的形式进行传递。如果存在一个全局的容器，里面\u003Cb\u003E预先注册\u003C\u002Fb\u003E好了我们所需对象的类定义以及初始化参数，每个对象有一个唯一的 key。那么当我们需要用到某个对象时，我们只需要告诉容器它对应的 key，就可以直接从容器中\u003Cb\u003E取出\u003C\u002Fb\u003E实例化好的对象，开发者就不用再关心对象的实例化过程，也不需要将依赖对象作为构造函数的参数在依赖链路上传递。\u003C\u002Fp\u003E\u003Cp\u003E也就是说，我们的容器必须具体两个功能，\u003Cb\u003E实例的注册\u003C\u002Fb\u003E和\u003Cb\u003E获取\u003C\u002Fb\u003E，这很容易让人联想到 Map，基于这个思路，我们首先简单实现一个容器：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F container.ts\nexport class Container {\n    bindMap = new Map();\n\n    \u002F\u002F 实例的注册\n    bind(identifier: string, clazz: any, constructorArgs: Array&lt;any&gt;) {\n        this.bindMap.set(identifier, {\n            clazz,\n            constructorArgs\n        });\n    }\n\n    \u002F\u002F 实例的获取\n    get&lt;T&gt;(identifier: string): T {\n        const target = this.bindMap.get(identifier);\n        const { clazz, constructorArgs } = target;\n        const inst = Reflect.construct(clazz, constructorArgs);\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这里我们用到了 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdeveloper.mozilla.org\u002Fzh-CN\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FReflect\u002Fconstruct\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EReflect.construct\u003C\u002Fa\u003E，它的行为有点像 new 操作符，帮助我们进行对象的实例化。有了容器之后，我们就可以彻底抛弃传参实现解耦，如下所示：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nclass B {\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\n\u002F\u002F a.ts\nclass A {\n    b:B;\n    constructor() {\n        this.b = container.get(&#39;b&#39;);\n    }\n}\n\n\u002F\u002F main.ts\nconst container = new Container();\ncontainer.bind(&#39;a&#39;, A);\ncontainer.bind(&#39;b&#39;, B, [10]);\n\n\u002F\u002F 从容器中取出a\nconst a = container.get(&#39;a&#39;);\nconsole.log(a); \u002F\u002F A =&gt; { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E到这里为止，我们其实已经基本实现了 IoC，基于容器完成了类与类的解耦。但从代码量上看似乎并没有简洁多少，关键问题在于容器的初始化以及类的注册仍然让我们觉得繁琐，如果这部分代码能被封装到框架里面，所有类的注册都能够自动进行，同时，所有类在实例化的时候可以直接拿到依赖对象的实例，而不用在构造函数中手动指定，这样就可以彻底解放开发者的双手，专注编写类内部的逻辑，而这也就是所谓的 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.wikipedia.org\u002Fwiki\u002F%25E4%25BE%259D%25E8%25B5%2596%25E6%25B3%25A8%25E5%2585%25A5\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EDI（Dependency Injection）依赖注入\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E三. DI\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E很多人会混淆 DI 和 IoC，IoC 只是一种设计原则，而 DI 则是实现 IoC 的一种实现技术，简单来说就是我们可以将依赖注入给调用方，而不需要调用方来主动获取依赖。为了实现 DI，主要要解决以下两个问题：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E需要注册到 IoC 容器中的类能够在程序启动时自动进行注册\u003C\u002Fli\u003E\u003Cli\u003E在 IoC 容器中的类实例化时可以直接拿到依赖对象的实例，而不用在构造函数中手动指定\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E针对这两个问题其实也有不同的解决思路，比如大名鼎鼎的 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fspring.io\u002Fwhy-spring\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EJava Spring\u003C\u002Fa\u003E 需要开发者针对容器中的依赖关系定义一份 XML 文件，框架基于这份 XML 文件实例的注册和依赖的注入。但对于前端开发来说，基于 XML 的依赖管理显得太过繁琐，Midway 的 Injection 提供的思路是利用 TypeScript 具备的装饰器特性，通过对元数据的修饰来识别出需要进行注册以及注入的依赖，从而完成依赖的注入。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E3.1 Reflect Metadata\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E要使用装饰器解决上述提到的两个问题，我们需要先简单了解下 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjkchao.github.io\u002Ftypescript-book-chinese\u002Ftips\u002Fmetadata.html%23%25E5%259F%25BA%25E7%25A1%2580\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EReflect Metadata\u003C\u002Fa\u003E。Reflect Metadata 是 ES7 的一个提案，它主要用来在声明的时候添加和读取元数据，TypeScript 在 1.5+ 的版本已经支持它。\u003C\u002Fp\u003E\u003Cp\u003E元数据可以理解为针对类或类里面某个属性的描述信息，它本身不影响类的行为，但你可以在随时拿到某个类上定义的元数据，并根据这些元数据进行对类进行特定的操作。\u003C\u002Fp\u003E\u003Cp\u003EReflect Metadata 的使用非常简单，首先，你需要安装 reflect-metadata 库：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Enpm i reflect-metadata --save\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E在 tsconfig.json 里，emitDecoratorMetadata 需要配置为 \u003Ccode\u003Etrue\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp\u003E然后，我们就可以根据 Reflect.defineMetadata 和 Reflect.getMetadata 进行元数据的定义和获取，比如：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eimport &#39;reflect-metadata&#39;;\n\nconst CLASS_KEY = &#39;ioc:key&#39;;\n\nfunction ClassDecorator() {\n  return function (target: any) {\n      Reflect.defineMetadata(CLASS_KEY, {\n        metaData: &#39;metaData&#39;,\n      }, target);\n      return target;\n  };\n}\n\n@ClassDecorator()\nclass D {\n  constructor(){}\n}\n\nconsole.log(Reflect.getMetadata(CLASS_KEY, D)); \u002F\u002F =&gt; { metaData: &#39;metaData&#39; }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E有了 Reflect，我们就可以对任意类进行标记，并对标记的类进行特殊的处理。更多有关元数据的内容可以参考 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjkchao.github.io\u002Ftypescript-book-chinese\u002Ftips\u002Fmetadata.html%23%25E5%259F%25BA%25E7%25A1%2580\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EReflect Metadata\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E3.2 Provider\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E回到我们刚刚提到的问题，我们需要在应用启动的时候自动对所有类进行定义和参数的注册，问题是并不是所有的类都需要注册到容器中，我们并不清楚哪些类需要注册的，同时也不清楚需要注册的类，它的初始化参数是什么样的。\u003C\u002Fp\u003E\u003Cp\u003E这里就可以引入元数据来解决这个问题，只要在定义的时候为这个类的元数据添加特殊的标记，就可以在扫描的时候识别出来。按照这个思路，我们先来实现一个装饰器标记需要注册的类，这个装饰器可以命名 Provider，代表它将会作为提供者给其他类进行消费。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F provider.ts\nimport &#39;reflect-metadata&#39;\n\nexport const CLASS_KEY = &#39;ioc:tagged_class&#39;;\n\nexport function Provider(identifier: string, args?: Array&lt;any&gt;) {\n    return function (target: any) {\n        Reflect.defineMetadata(CLASS_KEY, {\n            id: identifier,\n            args: args || []\n        }, target);\n        return target;\n    };\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E可以看到，这里的标记包含了 \u003Ccode\u003Eid\u003C\u002Fcode\u003E 和 \u003Ccode\u003Eargs\u003C\u002Fcode\u003E，其中 \u003Ccode\u003Eid\u003C\u002Fcode\u003E 是我们准备用来注册 IoC 容器的 \u003Ccode\u003Ekey\u003C\u002Fcode\u003E，而 \u003Ccode\u003Eargs\u003C\u002Fcode\u003E 则是实例初始化时需要的参数。Provider 可以以装饰器的形式直接进行使用，使用方式如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\nimport { Provider } from &#39;provider&#39;;\n\n@Provider(&#39;b&#39;, [10])\nexport class B {\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E标记完成后，问题又来了，如果在应用启动的时候拿到这些类的定义呢？\u003C\u002Fp\u003E\u003Cp\u003E比较容易想到的思路是在启动的时候对所有文件进行扫描，获取每个文件导出的类，然后根据元数据进行绑定。简单起见，我们假设项目目录只有一级文件，实现如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F load.ts\nimport * as fs from &#39;fs&#39;;\nimport { CLASS_KEY } from &#39;.\u002Fprovider&#39;;\n\nexport function load(container) { \u002F\u002F container 为全局的 IoC 容器\n  const list = fs.readdirSync(&#39;.\u002F&#39;);\n\n  for (const file of list) {\n    if (\u002F\\.ts$\u002F.test(file)) { \u002F\u002F 扫描 ts 文件\n      const exports = require(`.\u002F${file}`);\n      for (const m in exports) {\n        const module = exports[m];\n        if (typeof module === &#39;function&#39;) {\n          const metadata = Reflect.getMetadata(CLASS_KEY, module);\n          \u002F\u002F 注册实例\n          if (metadata) {\n            container.bind(metadata.id, module, metadata.args)\n          }\n        }\n      }\n    }\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E那么现在，我们只要在 main 中运行 load 即可完成项目目录下所有被修饰的类的绑定工作，值得注意的是，load 和 Container 的逻辑是完全通用的，它们完全可以被封装成包，一个简化的 IoC 框架就成型了。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eimport { Container } from &#39;.\u002Fcontainer&#39;;\nimport { load } from &#39;.\u002Fload&#39;;\n\n\u002F\u002F 初始化 IOC 容器，扫描文件\nconst container = new Container();\nload(container);\n\nconsole.log(container.get(&#39;a&#39;)); \u002F\u002F A =&gt; { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E\u003Cb\u003E3.2 Inject\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E解决注册的问题后，我们来看上文中提到的第二个问题：如何在类初始化的时候能直接拿到它所依赖的对象的实例，而不需要手动通过构造函数进行传参。其实思路也很简单，我们已经将所有需要注册的类都放入了 IoC 容器，那么，当我们需要用到某个类时，在获取这个类的实例时可以递归遍历类上的属性，并从 IoC 容器中取出相应的对象并进行赋值，即可完成依赖的注入。\u003C\u002Fp\u003E\u003Cp\u003E那么，又是类似的问题，如何区分哪些属性需要注入？同样，我们可以使用元数据来解决。只要定义一个装饰器，以此来标记哪些属性需要注入即可，这个装饰器命名为 Inject，代表该属性需要注入依赖。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F inject.ts\nimport &#39;reflect-metadata&#39;;\n\nexport const PROPS_KEY = &#39;ioc:inject_props&#39;;\n\nexport function Inject() {\n    return function (target: any, targetKey: string) {\n        const annotationTarget = target.constructor;\n        let props = {};\n        if (Reflect.hasOwnMetadata(PROPS_KEY, annotationTarget)) {\n            props = Reflect.getMetadata(PROPS_KEY, annotationTarget);\n        }\n\n        props[targetKey] = {\n            value: targetKey\n        };\n\n        Reflect.defineMetadata(PROPS_KEY, props, annotationTarget);\n    };\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E需要注意的是，这里我们虽然是对属性进行修饰，但实际元数据是要定义在类上，以维护该类需要注入的属性列表，因此我们必须取 target.constructor 作为要操作的 target。另外，为了方便起见，这里直接用了属性名（targetKey）作为从 IoC 容器中实例对应的 key。\u003C\u002Fp\u003E\u003Cp\u003E然后，我们需要修改 IoC 容器的 get 方法，递归注入所有属性：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F container.ts\nimport { PROPS_KEY } from &#39;.\u002Finject&#39;;\n\nexport class Container {\n    bindMap = new Map();\n\n    bind(identifier: string, clazz: any, constructorArgs?: Array&lt;any&gt;) {\n        this.bindMap.set(identifier, {\n            clazz,\n            constructorArgs: constructorArgs || []\n        });\n    }\n\n    get&lt;T&gt;(identifier: string): T {\n        const target = this.bindMap.get(identifier);\n\n        const { clazz, constructorArgs } = target;\n\n        const props = Reflect.getMetadata(PROPS_KEY, clazz);\n        const inst = Reflect.construct(clazz, constructorArgs);\n\n        for (let prop in props) {\n            const identifier = props[prop].value;\n            \u002F\u002F 递归获取注入的对象\n            inst[ prop ] = this.get(identifier);\n        }\n        return inst;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E使用的时候，用 Inject 对需要的属性进行修饰即可：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F a.ts\nimport { Provider } from &#39;provider&#39;;\n\n@Provider(&#39;a&#39;)\nexport class A {\n    @Inject()\n    b: B;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E\u003Cb\u003E3.3 最终代码\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E经过上述调整后，最终我们的业务代码成了这样：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E\u002F\u002F b.ts\n@Proivder(&#39;b&#39;, [10])\nclass B {\n    constructor(p: number) {\n        this.p = p;\n    }\n}\n\n\u002F\u002F a.ts\n@Proivder(&#39;a&#39;)\nclass A {\n    @Inject()\n    private b:B;\n}\n\n\u002F\u002F main.ts\nconst container = new Container();\nload(container);\n\nconsole.log(container.get(&#39;a&#39;));  \u002F\u002F =&gt; A { b: B { p: 10 } }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E可以看到，代码中不会再有手动进行实例化的情况，无论要注册多少个类，框架层都可以自动处理好一切，并在这些类实例化的时候注入需要的属性。所有类可提供的实例都由类自身来维护，即使存在修改也不需要改动其他文件。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E小结\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cp\u003E本文从类的解耦开始描述了 IoC 的必要性，基于 TypeScript 实现了一个精简的 IoC 框架。事实上，除了解耦外，IoC 还可以给我们带来很多好处，比如基于容器快速进行单元测试，分析类与类之间的依赖关系等等。\u003C\u002Fp\u003E\u003Cp\u003E虽然 IoC 最初是服务端提出的概念，但目前在前端领域也已经有了各种各样的应用，比如 AngularJS 就实现了自己的 IoC 框架来提升开发效率和模块化程度，有兴趣的读者可以通过官方的\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fangular.cn\u002Fguide\u002Fdependency-injection\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E案例\u003C\u002Fa\u003E感受一下 IoC 给前端编码带来的好处。相信随着前端职能的扩张，应用复杂度的提升，这些经典的设计原则正在逐渐成为每个前端开发的必修课程。\u003C\u002Fp\u003E\u003Ch2\u003E\u003Cb\u003E参考资料\u003C\u002Fb\u003E\u003C\u002Fh2\u003E\u003Cul\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjkchao.github.io\u002Ftypescript-book-chinese\u002Ftips\u002Fmetadata.html%23%25E5%259F%25BA%25E7%25A1%2580\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E深入理解TypeScript\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.wikipedia.org\u002Fwiki\u002F%25E6%258E%25A7%25E5%2588%25B6%25E5%258F%258D%25E8%25BD%25AC\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E控制反转-维基百科\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdeveloper.mozilla.org\u002Fzh-CN\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FReflect\u002Fconstruct\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMDN\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmidwayjs.org\u002Fmidway\u002Fioc.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMidway\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fangular.cn\u002Fguide\u002Fdependency-injection\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EAngularJS DI\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cblockquote\u003E本文发布自 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fx-orpheus\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E网易云音乐大前端团队\u003C\u002Fa\u003E，文章未经授权禁止任何形式的转载。我们常年招收前端、iOS、Android，如果你准备换工作，又恰好喜欢云音乐，那就加入我们 grp.music-fe(at)corp.netease.com！\u003C\u002Fblockquote\u003E","is_labeled":false,"visited_count":14810},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 311184005}","uninterest_reasons":[{"reason_id":3,"reason_type":"topic","object_token":"19628542","object_type":"topic","reason_text":"IOC"},{"reason_id":3,"reason_type":"topic","object_token":"19766226","object_type":"topic","reason_text":"TypeScript"},{"reason_id":2,"reason_type":"creator","object_token":"4fead0241377d378785f44ac68a27065","object_type":"people","reason_text":"云音乐前端技术团队创作的内容"}],"attached_info":"CvwCCMicxf7ilp\u002Fk\u002FQEQBxoJMTU3MjgxNjkyIOCD9\u002F0FKLIDMBhAAEoNCgRGUkZSEgEwGAAgAEoNCgRJQ0NPEgEwGAAgAFISZmVlZHJlX2FkZF9hcnRpY2xlWgcxMTIyNDI0cgkzMTExODQwMDV4AYIBUGh0dHBzOi8vcGljNC56aGltZy5jb20vdjItZWI2YjBmNWI3NGQyYmZmNTQxY2E2MjAxOTIyMTRiNzRfci5qcGc\u002Fc291cmNlPTE3MmFlMThiigEHbXVzaWNmZaoBCXJlY29tbWVuZPIBNQgAEjFydzowLjA7aXNvOjAuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJGVhY2Y4M2Q4LWIxYzgtNGU4OC1hOGNiLWUzMTIyYzZjZTUxN4gC9J+Tgu8ukgIgNGZlYWQwMjQxMzc3ZDM3ODc4NWY0NGFjNjhhMjcwNjWaAgA=","actors":[{"id":"19628542","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19628542","avatar_url":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fe82bab09c_s.jpg","name":"IOC","excerpt":"","introduction":""}],"show_actor_time":false,"action_text":"IOC","action_text_tpl":"热门内容, 来自: {}","action_card":false},{"id":"1_1610348810.832","type":"feed","offset":1,"verb":"COMMON_CARD","created_time":1610348810,"updated_time":1610348810,"target":{"id":"1331231587552743424","type":"zvideo","title":"工藤静香年轻时有多美啊？！简直是从漫画里走出来的！！！","description":"BGM：柴 鱼 の c a l l i n g 粉丝想看工藤静香混剪那就出了一期～ 素材真难找......（电影画面和演唱画面）很多都是远古画质，我已经挑出最好的了，希望你们喜欢吧～ 前男友是林佳树，老公是木村拓哉！真的做梦都梦不到...... 审核大大辛苦了，给点推荐吧～喜欢可以点赞持下，谢谢啦！","member_id":60154120,"vote_count":26,"comment_count":14,"author":{"id":"553405688a11bbe454c2b9da5cd09bc5","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F553405688a11bbe454c2b9da5cd09bc5","user_type":"people","url_token":"chen-shu-yong-72","name":"爱睡觉的Koala","headline":"今年目标2w粉～喜欢影视，动物，高颜值可爱的东西～","avatar_url":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-091a09e8f3ae35508a9933ddb0e981b4_m.jpg","is_org":false,"gender":1,"badge":[],"followers_count":18512,"is_following":false,"is_followed":false},"thumbnail_extra_info":{"video_id":"1331231553494441984","type":"video","url":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-4931ffea89ea9ce97e189da2afbd1427.jpg?source=382ee89a","height":720,"width":1280,"duration":70,"playlist":{"ld":{"url":"https:\u002F\u002Fvdn1.vzuu.com\u002FSD\u002F083915f6-523c-11eb-b704-4a6d731ab1a6.mp4?disable_local_cache=1&bu=feedroot&expiration=1610352410&auth_key=1610352410-0-0-4571187c21ddb0db06f57acedccf1da4&f=mp4&v=hw","bitrate":480,"duration":70,"format":"mp4","fps":25,"height":478,"size":4257081,"width":848},"sd":{"url":"https:\u002F\u002Fvdn1.vzuu.com\u002FSD\u002F083915f6-523c-11eb-b704-4a6d731ab1a6.mp4?disable_local_cache=1&bu=feedroot&expiration=1610352410&auth_key=1610352410-0-0-4571187c21ddb0db06f57acedccf1da4&f=mp4&v=hw","bitrate":480,"duration":70,"format":"mp4","fps":25,"height":478,"size":4257081,"width":848},"hd":{"url":"https:\u002F\u002Fvdn1.vzuu.com\u002FHD\u002F083915f6-523c-11eb-b704-4a6d731ab1a6.mp4?disable_local_cache=1&bu=feedroot&expiration=1610352410&auth_key=1610352410-0-0-19ea61c64249b7b63ae4c4b47d36228d&f=mp4&v=hw","bitrate":773,"duration":70,"format":"mp4","fps":25,"height":720,"size":6848074,"width":1280}},"show_maker_entrance":false},"play_count":27479,"excerpt":"BGM：柴 鱼 の c a l l i n g 粉丝想看工藤静香混剪那就出了一期～ 素材真难找......（电影画面和演唱画面）很多都是远古画质，我已经挑出最好的了，希望你们喜欢吧～ 前男友是林佳树，老公是木村拓哉！真的做梦都梦不到...... 审核大大辛苦了，给点推荐吧～喜欢可以点赞持下，谢谢啦！"},"brief":"{\"source\": \"TS\", \"type\": \"zvideo\", \"id\": 1331231587552743424}","uninterest_reasons":[{"reason_id":3,"reason_type":"topic","object_token":"19684455","object_type":"topic","reason_text":"女神"},{"reason_id":3,"reason_type":"topic","object_token":"19550917","object_type":"topic","reason_text":"日本"},{"reason_id":3,"reason_type":"topic","object_token":"20223317","object_type":"topic","reason_text":"工藤静香"},{"reason_id":3,"reason_type":"topic","object_token":"19552207","object_type":"topic","reason_text":"美女"},{"reason_id":2,"reason_type":"creator","object_token":"553405688a11bbe454c2b9da5cd09bc5","object_type":"people","reason_text":"爱睡觉的Koala 创作的内容"}],"attached_info":"CrgDCMicxf7ilp\u002Fk\u002FQEQYxoTMTMzMTIzMTU4NzU1Mjc0MzQyNCCCguX\u002FBSgaMA5AAUoNCgRUU1pDEgEwGAAgAFIZenZpZGVvX2NyZWF0b3JfYWRkX3p2aWRlb2iAwM+et4HfvBJyEzEzMzEyMzE1ODc1NTI3NDM0MjR4bIIBTmh0dHBzOi8vcGljMS56aGltZy5jb20vdjItNDkzMWZmZWE4OWVhOWNlOTdlMTg5ZGEyYWZiZDE0MjcuanBnP3NvdXJjZT0zODJlZTg5YaoBCXJlY29tbWVuZPIBcQgAEm1ydzo0ODMuMDtpc286MTUuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOlp2aWRlb0NyZWF0b3JMZXZlbFdlaWdodFJ1bGUsWlZpZGVvU0FXaGl0ZUxpc3RXZWlnaHRSdWxlLEN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJDg5ZmM1YjhhLWM2ODctNDdiZi04OTQ4LTA0N2NkN2U2ODNjZIgC9J+Tgu8ukgIgNTUzNDA1Njg4YTExYmJlNDU0YzJiOWRhNWNkMDliYzWaAgA=","actors":[{"id":"20223317","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F20223317","avatar_url":"https:\u002F\u002Fpic2.zhimg.com\u002F50\u002Fv2-e495298ae7f12610a10e329b54db7829_s.jpg","name":"工藤静香","excerpt":"","introduction":""}],"show_actor_time":false,"action_text":"工藤静香","action_text_tpl":"热门内容, 来自: {}","action_card":false},{"id":"2_1610348810.175","type":"feed","offset":2,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","created_time":1610348810,"updated_time":1610348810,"target":{"id":338763096,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F338763096","author":{"id":"7df657f88c64f3aa3c9da3bd96ddf032","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F7df657f88c64f3aa3c9da3bd96ddf032","user_type":"people","url_token":"otakustay","name":"张立理","headline":"Web前端工程师","avatar_url":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-2f08aea15aaa195616c3c39c53e2be4e_m.jpg","is_org":false,"gender":1,"badge":[{"type":"best_answerer","description":"优秀回答者","topics":[],"topic_names":["JavaScript","前端开发"]}],"followers_count":24245,"is_following":false,"is_followed":false},"title":"从业务讲React Hook系列 - 异步与带延迟的加载指示器","excerpt_title":"","image_url":"","comment_permission":"all","created":1608631057,"updated":1608631057,"voteup_count":112,"voting":0,"upvoted_followees":[],"comment_count":17,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"背景很多时候，在一个异步过程中，我们需要给用户一个指示，无论是一个遮罩层这样的阻塞式的，还是一个旋转的小圈这种非阻塞式的。 但从另一个角度看，不管异步的实际情况，二话不说地用上指示器，有时候反而会带来用户体验上的倒退。有不少100-200ms就能完&hellip;","excerpt_new":"背景很多时候，在一个异步过程中，我们需要给用户一个指示，无论是一个遮罩层这样的阻塞式的，还是一个旋转的小圈这种非阻塞式的。 但从另一个角度看，不管异步的实际情况，二话不说地用上指示器，有时候反而会带来用户体验上的倒退。有不少100-200ms就能完&hellip;","preview_type":"default","preview_text":"","content":"\u003Ch2\u003E背景\u003C\u002Fh2\u003E\u003Cp\u003E很多时候，在一个异步过程中，我们需要给用户一个指示，无论是一个遮罩层这样的阻塞式的，还是一个旋转的小圈这种非阻塞式的。\u003C\u002Fp\u003E\u003Cp\u003E但从另一个角度看，不管异步的实际情况，二话不说地用上指示器，有时候反而会带来用户体验上的倒退。有不少100-200ms就能完成的请求，突兀地调起指示器，又很快消失，对用户会造成一种不适感。因此，我们需要根据异步的时长来做判断，短时间内不出现指示器，而超过一定时长后则出现。\u003C\u002Fp\u003E\u003Cp\u003E再从第三个角度看，无论指示器是不是调起，我们都要防止用户频繁地进行相同操作导致的请求多发、乱序等问题，所以一但当异步过程开始，要对用户的行为进行屏蔽，即相同的操作不再发起请求。\u003C\u002Fp\u003E\u003Cp\u003E所以总结一下，在异步+指示器的场合下，希望做到比较合理的用户体验，我们要达成以下3个要求：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E可以随异步的开始和结束，按一定的逻辑展示一个指示器。\u003C\u002Fli\u003E\u003Cli\u003E在很短时间内就结束的异步过程中，指示器不易出现。\u003C\u002Fli\u003E\u003Cli\u003E无论指示器出现与否，要让用户的相同操作不再触发异步过程。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E所以这不是一个简单的loading &amp;&amp; &lt;Loading \u002F&gt;的逻辑，需要做更多。\u003C\u002Fp\u003E\u003Ch2\u003E终版\u003C\u002Fh2\u003E\u003Cp\u003E我们最终的代码是这样的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EReact\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EFC\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;react&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EButton\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ESpin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;antd&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EuseActionPending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;@huse\u002Faction-pending&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EuseDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;@huse\u002Fdebounce&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EUser\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;.\u002Fapi&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EUserList\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E&#39;.\u002FUserList&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EApp\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003EFC\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EUser\u003C\u002Fspan\u003E\u003Cspan class=\"err\"\u003E[]\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;([]);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseActionPending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Elist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EloadUsers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kr\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003EsetUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Estyle\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Emargin\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003E40\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}}&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Estyle\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EmarginBottom\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}}&gt;\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EButton\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"na\"\u003Etype\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;primary&#34;\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"na\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"na\"\u003EonClick\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EloadUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"err\"\u003E寻找更多基友\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EButton\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003ESpin\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Espinning\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}&gt;\u003C\u002Fspan\u003E\n                \u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003EUserList\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eusers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E\u002F&gt;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003ESpin\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E&lt;\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kr\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edefault\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EApp\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E以下是实际的沙盒：\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fcodesandbox.io\u002Fs\u002Fdebounced-loading-n25jj\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-3b75a75afa2771967d1a0ef5a84b7a35_180x120.jpg\" data-image-width=\"1200\" data-image-height=\"630\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ecodesandbox.io\u002Fs\u002Fdeboun\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eced-loading-n25jj\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fcodesandbox.io\u002Fs\u002Fdebounced-loading-n25jj\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Edebounced-loading - CodeSandbox\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fcodesandbox.io\u002Fs\u002Fdebounced-loading-n25jj\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-3b75a75afa2771967d1a0ef5a84b7a35_180x120.jpg\" data-image-width=\"1200\" data-image-height=\"630\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ECodeSandbox - 延迟加载指示器\u003C\u002Fa\u003E\u003Cp\u003E我们给假的API提供了50%的概率150ms返回，50%概率1500ms返回。同时加载指示器会在异步超过200ms后出现。因此通过点击按钮，你会发现有一半的情况下界面会迅速刷新并且不会有Spin组件的干扰，而另一半情况则可以看到一个Spin效果。但无论点击多块，都不会重复地去请求用户列表。\u003C\u002Fp\u003E\u003Ch2\u003E分解\u003C\u002Fh2\u003E\u003Cp\u003E第一个问题，我们需要在异步开始的时候知道有异步了，结束的时候知道没异步了。在此我还是强调我们尽量用一个数字去管理这个状态，而不是boolean，万一真的异步并发了呢。所以，代码大概就是这样的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetPendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003EsetPendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Elist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Efinally\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetPendingCount\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E当然你会发现这样的代码随处都是，基本碰上一个异步就要写一遍，因此我们把它封装到了\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fecomfe.github.io\u002Freact-hooks\u002F%23\u002Fhook\u002Faction-pending\u002Fuse-action-pending\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@huse\u002Faction-pending\u003C\u002Fa\u003E里，调用useActionPending，给定任意一个异步的函数，就会返回给你一个签名相同的函数，外加一个pendingCount的数字。\u003C\u002Fp\u003E\u003Cp\u003E第二个问题，我们的pendingCount并不是直接对到Spin组件上去的，因为希望200ms以内不要出现。所以这本质上是一个debounce过程，当值变化后200ms内不要去响应。\u003C\u002Fp\u003E\u003Cp\u003E在这个环节，很多开发者都会进入一个误区，试图在异步的控制过程中去管理这个debounce，因为在多数人的直觉里，debounce是和“操作”、“行为”挂钩的，比如用户快速输入的时候要晚一些去发请求，这时就有“输入”这个操作存在。如果用这个思路，往往会写出类似这样的代码来：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetLoading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kc\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseRef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ElistUsers\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseCallback\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003EclearTimeout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ecurrent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ecurrent\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetTimeout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n            \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetLoading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kc\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n            \u003Cspan class=\"mi\"\u003E200\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eapi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Elist\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Efinally\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EclearTimeout\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Etimer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Ecurrent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Epending\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[]\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E也别问我这代码对不对，我非常不喜欢管理定时器，特别是在混乱的异步流里去管理它。\u003C\u002Fp\u003E\u003Cp\u003E实际上解决这个问题有另一个思路，就是“值也是能被debounce的”。我们把“值发生变化”看作一个动作就行，只不过这个动作并非直接由用户触发。因此，我们可以通过effect去管理这个延迟，这也正是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fecomfe.github.io\u002Freact-hooks\u002F%23\u002Fhook\u002Fdebounce\u002Fuse-debounced-value\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@huse\u002Fdebounce\u003C\u002Fa\u003E中的useDebouncedValue提供的能力。\u003C\u002Fp\u003E\u003Cp\u003E在我们的实现中，首先把debounce做成了useDebouncedEffect，再去它非常简单地去管理useDebouncedValue：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"kd\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"nt\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E&gt;(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ewait\u003C\u002Fspan\u003E: \u003Cspan class=\"kt\"\u003Enumber\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kr\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EdebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EuseState\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nx\"\u003EuseDebouncedEffect\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EsetDebouncedValue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ewait\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Ewait\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EdebouncedValue\u003C\u002Fspan\u003E : \u003Cspan class=\"kt\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E当然useDebouncedEffect还是一个比较复杂的东西，有兴趣的同学可以\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fecomfe\u002Freact-hooks\u002Fblob\u002F1575164b0e68aab7e39361564b3b1fd8907f8416\u002Fpackages\u002Fdebounce\u002Fsrc\u002Findex.ts%23L7-L46\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E直接看源码\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Cp\u003E最后，我们有了一个完全与异步过程对应的pendingCount，以及一个基于pendingCount经过debounce衍生出来的loading属性。现在尝试把我们现有的几个状态组件起来，其实也是有一定复杂度的：\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E只要有异步，按钮的点击就要无效化，所以直接使用!!pendingCount。\u003C\u002Fli\u003E\u003Cli\u003E在异步过程中，Spin要晚200ms出现，所以用loading。\u003C\u002Fli\u003E\u003Cli\u003E但异步结束的时候，Spin不应该再晚200ms消失（useDebouncedValue并不会管理你是true还是false），所以还要配合!!pendingCount配合使用。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E所以对应的逻辑就是：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-ts\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F 只要有异步，不发请求\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EonClick\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003EloadUsers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002F 对于Spin的情况，要同时判断有没有异步，以及是否应该出现\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003Espinning\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!!\u003C\u002Fspan\u003E\u003Cspan class=\"nx\"\u003EpendingCount\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nx\"\u003Eloading\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003E总结\u003C\u002Fh2\u003E\u003Col\u003E\u003Cli\u003E把异步与状态关联起来使用，可以是一个很方便通用的hook实现。\u003C\u002Fli\u003E\u003Cli\u003E对值使用debounce，而不是对用户的具体动作，可以更方便地实现一些能力。\u003C\u002Fli\u003E\u003Cli\u003E组合使用异步状态及期debounce后的衍生状态，可以提供更友好地用户体验。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E当然用起来还不是特别简单，有需要的也可以再自行封装一个useAsyncLoading之类的业务向的hook来用。\u003C\u002Fp\u003E","is_labeled":false,"visited_count":3524},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 338763096}","uninterest_reasons":[{"reason_id":3,"reason_type":"topic","object_token":"20013159","object_type":"topic","reason_text":"React"},{"reason_id":3,"reason_type":"topic","object_token":"21285100","object_type":"topic","reason_text":"React Hooks"},{"reason_id":2,"reason_type":"creator","object_token":"7df657f88c64f3aa3c9da3bd96ddf032","object_type":"people","reason_text":"张立理创作的内容"}],"attached_info":"CpACCMicxf7ilp\u002Fk\u002FQEQBxoJMTYzNDEwODA0IJGGh\u002F8FKHAwEUACSg0KBElDQ08SATAYACAAUhppdGVtY2ZfY29sbGVjdF9hZGRfYXJ0aWNsZXIJMzM4NzYzMDk2eDmqAQlyZWNvbW1lbmTyATcIABIzcnc6NDcuMDtpc286MTkuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJGViMmUxZDczLWMxNmUtNGVlOC1hYmMwLTM2ZGM2Y2M4OTk5N4gC9J+Tgu8ukgIgN2RmNjU3Zjg4YzY0ZjNhYTNjOWRhM2JkOTZkZGYwMzKaAgA=","actors":[{"id":"20013159","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F20013159","avatar_url":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002F6b12d4cbef521b02c5ab2e43e324081b_s.jpg","name":"React","excerpt":"","introduction":""}],"show_actor_time":false,"action_text":"React","action_text_tpl":"热门内容, 来自: {}","action_card":false},{"id":"AD_1119497_16103488102280","type":"feed_advert","brief":"{\"source\":\"PR\",\"type\":\"feed_advert\",\"id\":1119497}","action_text":"","attached_info":"Cj4IyJzF\u002FuKWn+T9AZABAdoBJGJkMzdkODRkLTgxZDQtNDhkYi1hYzQ3LTk2YTllNTc5Nzc3OfIBBggMEgJBZDITLTE1OTc0MDY2NDg0MzUxNDI5Ng==","ad":{"count":0,"position":0,"ad_verb":"PROMOTE_URL_CARD","close_track":"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ut=99dbd420cb1146aeb058bfdaa785c6bc&au=3662&nt=0&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&idi=8005&pf=4&ar=0.0000000000000029641190472714657&pdi=1533202984661615&ed=CjEEfR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5KBvYcEZaGDc%3D","revert_close_track":"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ed=CjEEch4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5w1fmEkh8gyg%3D&ar=0.0000000000000029641190472714657&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&idi=8005&ut=99dbd420cb1146aeb058bfdaa785c6bc&nt=0&pdi=1533202984661615&au=3662&pf=4","template":"web_image_feed","load_tracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ar=0.0000000000000029641190472714657&pf=4&nt=0&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&au=3662&idi=8005&pdi=1533202984661615&ed=CjEEeB4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5uJkne9k8Wuw%3D&ut=99dbd420cb1146aeb058bfdaa785c6bc"],"creatives":[{"landing_url":"https:\u002F\u002Fgitee.com\u002Fgitee-go\u002Fhexo-oss-deploy?utm_source=zhgg&utm_medium=feed&utm_term=gotw3&utm_campaign=giteego","image":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-9226db1ba717a581cae921e33da94eed_400x224.png","image_2x":"","title":"超详细 Hexo+Gitee go博客自动化部署小白教程","description":"你可以根据已有的文档和教程自己搭建 Hexo 站点，并结合 Gitee Go 发布部署 Hexo 到 对象存储，或通过 Fork 本仓库案例快速体验博客自动部署。","button":"查看详情","action_button":false,"footer":{"value":""},"cta":{"value":"查看详情"},"brand":{"id":0,"name":"Gitee","logo":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a97867a4897ccdb22a4efe2bef53c934_250x250.png"},"app_promotion_url":"","native_url":"","deep_url":"","video_watch_num":0,"za_ad_info":"CImqRBAHIgExXfL3v05glYtH","za_ad_info_json":"{\"ad_id\":1119497,\"ad_zone_id\":7,\"category\":\"1\",\"timestamp\":1610348800,\"creative_id\":1164693}","external_click_url":"","impression_tracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?nt=0&pdi=1533202984661615&au=3662&pf=4&ut=99dbd420cb1146aeb058bfdaa785c6bc&idi=8005&ar=0.0000000000000029641190472714657&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&ed=CjEEeR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5cldzxyzz9t4%3D"],"click_tracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?idi=8005&ar=0.0000000000000029641190472714657&nt=0&ut=99dbd420cb1146aeb058bfdaa785c6bc&au=3662&pdi=1533202984661615&pf=4&ed=CjEEfh4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p59NKSInNZSL4%3D&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego"],"id":1119497,"name":"","conversion_tracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ar=0.0000000000000029641190472714657&pf=4&idi=8005&ut=99dbd420cb1146aeb058bfdaa785c6bc&ed=CjEEfx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5GAAeCdoK920%3D&nt=0&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&pdi=1533202984661615&au=3662"],"content_type":"","target_token":""}],"vote_up_count":0,"comment_count":0,"is_following":false,"category":1,"id":1119497,"can_interact":false,"user_id":0,"ctr":0,"display_advertising_tag":true,"debug_tracks":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ed=CjEEcx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5wCyQyfXjJ5s%3D&ut=99dbd420cb1146aeb058bfdaa785c6bc&ar=0.0000000000000029641190472714657&tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego&au=3662&pdi=1533202984661615&idi=8005&nt=0&pf=4"],"land_prefetch":false,"native_prefetch":true,"is_new_webview":true,"experiment_info":"{}","download_silent":false,"is_speeding":false,"brand":{"name":"Gitee","logo":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a97867a4897ccdb22a4efe2bef53c934_250x250.png","type":"brand","action_text":""}},"ad_list":[],"adjson":"{\"ads\":[{\"id\":1119497,\"ad_zone_id\":7,\"template\":\"web_image_feed\",\"style\":\"psi_7\",\"impression_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026pdi=1533202984661615\\u0026ed=CjEEeB4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5uJkne9k8Wuw%3D\\u0026pf=4\\u0026au=3662\\u0026idi=8005\\u0026nt=0\\u0026ar=0.0000000000000029641190472714657\"],\"view_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?au=3662\\u0026idi=8005\\u0026ed=CjEEeR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5cldzxyzz9t4%3D\\u0026nt=0\\u0026ar=0.0000000000000029641190472714657\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026pdi=1533202984661615\\u0026pf=4\"],\"click_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?pf=4\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026pdi=1533202984661615\\u0026au=3662\\u0026nt=0\\u0026ed=CjEEfh4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p59NKSInNZSL4%3D\\u0026ar=0.0000000000000029641190472714657\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026idi=8005\"],\"close_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?nt=0\\u0026au=3662\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026pf=4\\u0026ar=0.0000000000000029641190472714657\\u0026ed=CjEEfR4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5KBvYcEZaGDc%3D\\u0026pdi=1533202984661615\\u0026idi=8005\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\"],\"debug_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026au=3662\\u0026nt=0\\u0026idi=8005\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026ed=CjEEcx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5wCyQyfXjJ5s%3D\\u0026pdi=1533202984661615\\u0026pf=4\\u0026ar=0.0000000000000029641190472714657\"],\"conversion_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026ar=0.0000000000000029641190472714657\\u0026ed=CjEEfx4wM317RzNTAGcpAEZ1Ci8Bbm4ifRV_XgBkeh1bcgx4DiY-JCwXZQYXMTYNXGNYI1x-a3F_HGZeBnY8WVZ2Dn8Bc2JmLUxvVgBmeAZSdh8pTH5qZi1Kb1ABdi5AVnIJbFQ2Z3F6HWVSBGV7AU0wUHcKd2p4dB1mAlJqLQBacwMvCHVuenccZF0HNSgFUXRYLA55aHR2QXQTQm19Blp1Cn4Ae2p5GAAeCdoK920%3D\\u0026pf=4\\u0026pdi=1533202984661615\\u0026au=3662\\u0026nt=0\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026idi=8005\"],\"extra_conversion_tracks\":{\"call_back\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper_callback?si=5ba417e0-03e9-4b30-9146-07526eddb27a\\u0026os=3\\u0026zid=7\\u0026zaid=1119497\\u0026zcid=1164693\\u0026cid=1164693\\u0026event=__EVENTTYPE__\\u0026value=__EVENTVALUE__\\u0026ts=__TIMESTAMP__\\u0026cts=__TS__\\u0026mh=10738d93c0d999cafd6c5d35fa485882\"]},\"za_ad_info\":\"CImqRBAHIgExXfL3v05glYtH\",\"za_ad_info_json\":\"{\\\"ad_id\\\":1119497,\\\"ad_zone_id\\\":7,\\\"category\\\":\\\"1\\\",\\\"timestamp\\\":1610348800,\\\"creative_id\\\":1164693}\",\"creatives\":[{\"id\":1164693,\"asset\":{\"brand_name\":\"Gitee\",\"brand_logo\":\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a97867a4897ccdb22a4efe2bef53c934_250x250.png\",\"title\":\"超详细 Hexo+Gitee go博客自动化部署小白教程\",\"desc\":\"你可以根据已有的文档和教程自己搭建 Hexo 站点，并结合 Gitee Go 发布部署 Hexo 到 对象存储，或通过 Fork 本仓库案例快速体验博客自动部署。\",\"imgs\":[\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-9226db1ba717a581cae921e33da94eed_400x224.png\"],\"landing_url\":\"https:\u002F\u002Fgitee.com\u002Fgitee-go\u002Fhexo-oss-deploy?utm_source=zhgg\\u0026utm_medium=feed\\u0026utm_term=gotw3\\u0026utm_campaign=giteego\",\"img_size\":1,\"cta\":\"查看详情\",\"image_ratio_extra\":{\"width\":25,\"height\":14},\"native_asset\":{}}}],\"expand\":{\"display_advertising_tag\":true,\"is_new_webview\":true,\"is_cdn_speeding\":false,\"is_apk_market_direct\":false,\"interactive\":{\"deliver_time\":\"25 分钟前\",\"browse_string\":\"2.6 万\",\"participate_string\":\"36 \",\"slide_time_one\":3,\"slide_time_two\":-1,\"slide_end\":true}},\"experiment_info\":\"{}\",\"view_x_tracks\":[\"https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper?pdi=1533202984661615\\u0026ar=0.0000000000000029641190472714657\\u0026idi=8005\\u0026ed=CjEEewhlKSlzEDAGBWF7VVtoCXldend0LBZiSghheAZGdQ5_CnU_JCpHYFBQdi1KVnIfK1EnZ3F_FGtTCGdqQAJ4Cn0Nemp4aEY7WgBhegRdfApsWzdncGhGPVoGYGpSG3gOeh4vL31_EWpQBGV5B1pjTCMFcW5wdh9qU1QzdlFbdA9wXXNsdHQca1ELZilUXn8IK151YHJ6HTZBRSNxAV10CXkMe2Jwd8_W2rQc2DJV\\u0026au=3662\\u0026pf=4\\u0026ut=99dbd420cb1146aeb058bfdaa785c6bc\\u0026tu=https%3A%2F%2Fgitee.com%2Fgitee-go%2Fhexo-oss-deploy%3Futm_source%3Dzhgg%26utm_medium%3Dfeed%26utm_term%3Dgotw3%26utm_campaign%3Dgiteego\\u0026nt=0\"],\"mobile_experiment\":{\"ad_comm_70\":\"0\",\"ad_ht\":\"1\",\"ad_new_rt\":\"0\",\"ad_pre_web\":\"1\",\"am_ad_logo\":\"0\",\"am_ad_video\":\"0\",\"am_adx_video\":\"2\",\"am_bid_ratio\":\"10000\",\"am_or_ad\":\"0\",\"am_test_ss\":\"0\",\"andr_pre_web\":\"2\",\"dd_send\":\"1\",\"dsp_replace\":\"1\",\"feed_adv_new\":\"1\",\"feed_advance\":\"0\",\"new_ad_logo\":\"0\",\"notify_page\":\"1\"}}]}","pcontent":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F338763096","ncontent":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F338773444","ext_info":{"content_type":null,"content_id":null,"priority":-1,"ecpm":-1}},{"id":"3_1610348810.285","type":"feed","offset":3,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","created_time":1610348810,"updated_time":1610348810,"target":{"id":338773444,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F338773444","author":{"id":"8c6431b765b4867257de0376c4ee1593","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F8c6431b765b4867257de0376c4ee1593","user_type":"people","url_token":"github-stars","name":"Github掘金计划","headline":"用心发掘优质的开源项目。公号同名。","avatar_url":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-7486cb749e90ac231362fed3648360d0_m.jpg","is_org":false,"gender":0,"badge":[],"followers_count":8681,"is_following":false,"is_followed":false},"title":"Github标星26k+!一个神奇的软件！1分钟即可打造了一个科幻风格的终端","excerpt_title":"","image_url":"https:\u002F\u002Fpic2.zhimg.com\u002F50\u002Fv2-339fcc43b9261db696e50863c913cd59_hd.jpg","comment_permission":"all","created":1608628866,"updated":1608628867,"voteup_count":247,"voting":0,"upvoted_followees":[],"comment_count":19,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"「Github掘金计划项目分类汇总（原创不易，若有帮助，欢迎分享\u002F点赞）：」 编程基础 ：精选编程基础如学习路线、编程语言相关的开源项目。计算机基础 ：精选计算机基础（操作系统、计算机网络、算法、数据结构）相关的开源项目。技术面试 ：精选技术面试相关&hellip;","excerpt_new":"「Github掘金计划项目分类汇总（原创不易，若有帮助，欢迎分享\u002F点赞）：」 编程基础 ：精选编程基础如学习路线、编程语言相关的开源项目。计算机基础 ：精选计算机基础（操作系统、计算机网络、算法、数据结构）相关的开源项目。技术面试 ：精选技术面试相关&hellip;","preview_type":"default","preview_text":"","content":"\u003Cp\u003E\u003Cb\u003E「Github掘金计划项目分类汇总（原创不易，若有帮助，欢迎分享\u002F点赞）：」\u003C\u002Fb\u003E\u003Cbr\u002F\u003E \u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1632585323454971905%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E编程基础\u003C\u002Fa\u003E ：精选编程基础如学习路线、编程语言相关的开源项目。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1635325633234780161%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E计算机基础\u003C\u002Fa\u003E：精选计算机基础（操作系统、计算机网络、算法、数据结构）相关的开源项目。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1632589980491366403%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E技术面试\u003C\u002Fa\u003E ：精选技术面试相关的开源项目。\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fmp\u002Fappmsgalbum%3Faction%3Dgetalbum%26album_id%3D1632590550748938241%26__biz%3DMzIwNDgzMzI3Mg%3D%3D%23wechat_redirect\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E项目实战\u003C\u002Fa\u003E ：精选实战类型的开源项目。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E如果你也是科幻电影迷，想要让自己的终端变得更加极客。就像下面   这样。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1cafd2f64a324a5377a6528e23d084cc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1934\" data-rawheight=\"1094\" class=\"origin_image zh-lightbox-thumb\" width=\"1934\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-1cafd2f64a324a5377a6528e23d084cc_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E你可以试试今天的推荐的开源项目。\u003C\u002Fp\u003E\u003Cp\u003EGithub 上有一个名字叫做 \u003Cb\u003E「 \u003C\u002Fb\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002FGitSquared\u002Fedex-ui\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Eedex-ui\u003C\u002Fa\u003E\u003Cb\u003E」\u003C\u002Fb\u003E 的项目，开源之后便受到了广大开发者的喜爱，多次登上了 Github Trending 榜单！\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44d94fe47aaef86e386d659bc05032f1_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3124\" data-rawheight=\"2164\" class=\"origin_image zh-lightbox-thumb\" width=\"3124\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44d94fe47aaef86e386d659bc05032f1_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E简单来说，通过这个开源项目你可以非常简单地搭建一个科幻风格的终端仿真器，这个模拟器的外观和感觉都像科幻计算机界面一样。\u003C\u002Fp\u003E\u003Cp\u003E\u003Ci\u003E非常适合用来装逼~\u003C\u002Fi\u003E\u003C\u002Fp\u003E\u003Cp\u003E有点科幻电影既视感的感觉！\u003C\u002Fp\u003E\u003Cp\u003E并且，界面样式是可以自定义的，可以满足大部分小伙伴的需求。\u003C\u002Fp\u003E\u003Cp\u003E常见的主流操作系统比如 Linux、Windows、MacOS 都可以安装这个项目。\u003C\u002Fp\u003E\u003Cp\u003E你可以在 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002FGitSquared\u002Fedex-ui\u002Freleases\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Egithub.com\u002FGitSquared\u002Fe\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Edex-ui\u002Freleases\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E 这里进行下载安装。\u003C\u002Fp\u003E\u003Cp\u003E我们只需要选择一个适合自己操作系统的版本即可！\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d296f21ae292d984e5ba8bb4815ea5b8_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2178\" data-rawheight=\"2128\" class=\"origin_image zh-lightbox-thumb\" width=\"2178\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d296f21ae292d984e5ba8bb4815ea5b8_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E如果你访问 Github 的速度比较慢的话，可以下方链接进行下载：\u003C\u002Fp\u003E\u003Cp\u003E链接: \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fpan.baidu.com\u002Fs\u002F1P2AC8kI0wv8DmzqyhVUxvw\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Epan.baidu.com\u002Fs\u002F1P2AC8k\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003EI0wv8DmzqyhVUxvw\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E 密码: 3p7f\u003C\u002Fp\u003E\u003Cp\u003E下载完成之后，我们直接双击安装即可，整个过程非常简单！\u003C\u002Fp\u003E\u003Cp\u003E安装完成之后，我们直接点击运行即可！你可以把它当做一个普通的软件来运行，非常方便。\u003C\u002Fp\u003E\u003Cp\u003E下图是在我的电脑运行的效果图。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-b0090290b8c7908daadc8eb1d5521f67_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3656\" data-rawheight=\"2312\" class=\"origin_image zh-lightbox-thumb\" width=\"3656\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-b0090290b8c7908daadc8eb1d5521f67_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E你可以通过双击\u003Ccode\u003Esettings.json\u003C\u002Fcode\u003E 这个文件的方式来修改一些默认配置比如主题。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f04d52c8a1bf4468a5bc198ef8b22c32_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3656\" data-rawheight=\"2312\" class=\"origin_image zh-lightbox-thumb\" width=\"3656\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f04d52c8a1bf4468a5bc198ef8b22c32_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E如下图所示，我这里把主题的修改为了 \u003Cb\u003E「apollo」\u003C\u002Fb\u003E 的样式。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-99070c08e3316529ecfdff0d72380e51_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3656\" data-rawheight=\"2312\" class=\"origin_image zh-lightbox-thumb\" width=\"3656\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-99070c08e3316529ecfdff0d72380e51_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Ca href=\"https:\u002F\u002Fwww.zhihu.com\u002Fquestion\u002F31092580\u002Fanswer\u002F1534887374\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-82fe7fbe24b1195472311b420da13697_120x160.jpg\" data-image-width=\"1352\" data-image-height=\"4804\" class=\"internal\"\u003E刷 LeetCode 吃力正常吗？\u003C\u002Fa\u003E\u003Cp\u003E\u003C\u002Fp\u003E","is_labeled":false,"visited_count":28587},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 338773444}","uninterest_reasons":[{"reason_id":3,"reason_type":"topic","object_token":"19566035","object_type":"topic","reason_text":"GitHub"},{"reason_id":3,"reason_type":"topic","object_token":"19585070","object_type":"topic","reason_text":"终端"},{"reason_id":3,"reason_type":"topic","object_token":"19554298","object_type":"topic","reason_text":"编程"},{"reason_id":2,"reason_type":"creator","object_token":"8c6431b765b4867257de0376c4ee1593","object_type":"people","reason_text":"Github掘金计划创作的内容"}],"attached_info":"CuICCMicxf7ilp\u002Fk\u002FQEQBxoJMTYzNDEzMTM5IIL1hv8FKPcBMBNAA0oNCgRGT0xVEgEwGAAgAFIXZm9sbG93X3VzZXJfYWRkX2FydGljbGVyCTMzODc3MzQ0NHgbggFQaHR0cHM6Ly9waWMxLnpoaW1nLmNvbS92Mi0zMzlmY2M0M2I5MjYxZGI2OTZlNTA4NjNjOTEzY2Q1OV9yLmpwZz9zb3VyY2U9MTcyYWUxOGKqAQlyZWNvbW1lbmTyATgIABI0cnc6LTEwLjA7aXNvOjIzLjA7Ymk6MC4wO2NyOjAuMDtydWxlczpDdXJyZW5jeVJhbmtlcvIBBQgLEgEx8gEKCAwSBk5vcm1hbPIBKAgKEiRjMWMwYThjYi1jMTYwLTRhYjMtYjA0MC03YmVlZWEyMTRjYzCIAvSfk4LvLpICIDhjNjQzMWI3NjViNDg2NzI1N2RlMDM3NmM0ZWUxNTkzmgIA","actors":[{"id":"19566035","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19566035","avatar_url":"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-253cc14aaee49c2929ecda7376ebc661_s.png","name":"GitHub","excerpt":"","introduction":""}],"show_actor_time":false,"action_text":"GitHub","action_text_tpl":"热门内容, 来自: {}","action_card":false},{"id":"4_1610348810.205","type":"feed","offset":4,"verb":"TOPIC_ACKNOWLEDGED_ARTICLE","created_time":1610348810,"updated_time":1610348810,"target":{"id":285248052,"type":"article","url":"https:\u002F\u002Fapi.zhihu.com\u002Farticles\u002F285248052","author":{"id":"36f69162230003d316d0b8a6d8da20ba","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F36f69162230003d316d0b8a6d8da20ba","user_type":"organization","url_token":"liang-zi-wei-48","name":"量子位","headline":"有趣的AI&amp;前沿科技→_→ 公众号：QbitAI","avatar_url":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-ca6e7ffc10a0d10edbae635cee82d007_m.jpg","is_org":true,"gender":0,"badge":[{"type":"identity","description":"已认证的官方帐号"},{"type":"best_answerer","description":"优秀回答者","topics":[],"topic_names":["人工智能","科技","科研","数学","自动驾驶"]}],"followers_count":327533,"is_following":false,"is_followed":false},"title":"Ubuntu被曝严重漏洞：切换系统语言+输入几行命令，就能获取root权限","excerpt_title":"","image_url":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-445fac421aa55b8304429cd8e587b0ad_hd.jpg","comment_permission":"all","created":1605064523,"updated":1605083002,"voteup_count":618,"voting":0,"upvoted_followees":[],"comment_count":62,"linkbox":{"pic":"","title":"","url":"","category":""},"excerpt":"晓查 发自 凹非寺 量子位 报道 | 公众号 QbitAI无需系统密码，就能添加新的sudo用户、获取root权限，事后还能删除不留痕迹。 这是GitHub安全研究员Kevin Backhouse发现的一个Ubuntu系统大漏洞。 这种攻击方法非常简单，Backhouse在官方博客中写道：&ldquo;使用&hellip;","excerpt_new":"晓查 发自 凹非寺 量子位 报道 | 公众号 QbitAI无需系统密码，就能添加新的sudo用户、获取root权限，事后还能删除不留痕迹。 这是GitHub安全研究员Kevin Backhouse发现的一个Ubuntu系统大漏洞。 这种攻击方法非常简单，Backhouse在官方博客中写道：&ldquo;使用&hellip;","preview_type":"default","preview_text":"","column":{"id":"qbitai","type":"column","url":"https:\u002F\u002Fapi.zhihu.com\u002Fcolumns\u002Fqbitai","author":{"id":"0","type":"people","url":"","user_type":"people","url_token":"","name":"匿名用户","headline":"","avatar_url":"https:\u002F\u002Fpic4.zhimg.com\u002Faadd7b895_m.jpg"},"title":"量子位","image_url":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7e0d98f2a88465d438867a387543a5ca_b.jpg","comment_permission":"public","intro":"","updated":1599141904,"is_following":false},"content":"\u003Cblockquote\u003E晓查 发自 凹非寺 \u003Cbr\u002F\u003E量子位 报道 | 公众号 QbitAI\u003C\u002Fblockquote\u003E\u003Cp\u003E无需系统密码，就能添加新的sudo用户、获取root权限，事后还能删除不留痕迹。\u003C\u002Fp\u003E\u003Cp\u003E这是GitHub安全研究员Kevin Backhouse发现的一个Ubuntu系统大漏洞。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f221aa68f4eea5b58a2a0fba0fc754be_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"561\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-f221aa68f4eea5b58a2a0fba0fc754be_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E这种攻击方法非常简单，Backhouse在官方博客中写道：“使用终端中的一些简单命令，并单击几次鼠标，标准用户就可以为自己创建一个管理员帐户。”\u003C\u002Fp\u003E\u003Cp\u003E目前还在维护的Ubuntu操作系统均受到影响，包括\u003Cb\u003E20.10\u003C\u002Fb\u003E以及\u003Cb\u003E20.04\u003C\u002Fb\u003E、\u003Cb\u003E18.04\u003C\u002Fb\u003E、\u003Cb\u003E16.04\u003C\u002Fb\u003E三个LTS版。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7b8ab98277dc2da7a2025dc5e48829ce_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"462\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7b8ab98277dc2da7a2025dc5e48829ce_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003EBackhouse是如何操作的？我们接着往下看。\u003C\u002Fp\u003E\u003Ch2\u003E攻击方法\u003C\u002Fh2\u003E\u003Cp\u003E首先打开终端，在你的主目录下创建一个软链接：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Eln -s \u002Fdev\u002Fzero .pam_environment\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E（注：如果以上命令无法运行，说明已经存在名为.pam_environment的文件，请把这个文件重命名做好备份！）\u003C\u002Fp\u003E\u003Cp\u003E接下来，在系统设置中打开\u003Cb\u003E“区域和语言”\u003C\u002Fb\u003E，然后尝试更改语言。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44b06f6aa194bb2e4db6120fd54898e9_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"784\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-44b06f6aa194bb2e4db6120fd54898e9_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E该对话框会冻结，只需忽略它，然后返回到终端即可。\u003C\u002Fp\u003E\u003Cp\u003E此时，一个名为\u003Cb\u003Eaccounts-daemon\u003C\u002Fb\u003E的程序正在消耗100％的CPU内核，因此你的计算机可能会变慢并开始变热。\u003C\u002Fp\u003E\u003Cp\u003E在终端中，删除软链接。否则，你可能无法使用自己的帐户！\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003Erm .pam_environment\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E下一步是将\u003Cb\u003ESIGSTOP\u003C\u002Fb\u003E信号发送到accounts-daemon，阻止它破坏该CPU内核。但是要做到这一点，首先需要知道accounts-daemon的PID。\u003C\u002Fp\u003E\u003Cp\u003E你可以通过运行\u003Cb\u003Etop\u003C\u002Fb\u003E来找到PID。由于accounts-daemon被卡在一个无限循环中，因此它很快进入top列表的顶部。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-afdf817ece3465b52da8161b04e1192b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-afdf817ece3465b52da8161b04e1192b_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E或者使用pidof命令来查找PID：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E$ pidof accounts-daemon\n597\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E接着用kill命令杀死SIGSTOP信号：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ekill -SIGSTOP 597\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E然后注销帐户，但首先需要设置一个计时器，保证在注销后重置accounts-daemon。否则，前面的努力都将白费。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Enohup bash -c “sleep 30s; kill -SIGSEGV 597; kill -SIGCONT 597”\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E注销后等待几秒钟，让SIGSEGV起效。如果漏洞利用成功，则会显示一系列对话框，让你创建一个新的用户帐户。这个新帐户具有\u003Cb\u003E管理员权限\u003C\u002Fb\u003E，可以运行sudo命令。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c7eb85617d162bd3bd82bfd3e3f84832_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c7eb85617d162bd3bd82bfd3e3f84832_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003EBackhouse将整个过程录成了2分多钟的视频，不明白操作方法的可以前去观看：\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Fwww.zhihu.com\u002Fzvideo\u002F1309815869246488576\" data-draft-node=\"block\" data-draft-type=\"link-card\"\u003E\u003C\u002Fa\u003E\u003Ch2\u003E攻击原理\u003C\u002Fh2\u003E\u003Cp\u003E该漏洞利用了Ubuntu系统中的两个错误：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E第一个是\u003Cb\u003Eaccountservice\u003C\u002Fb\u003E，它是管理计算机上用户帐户的服务。\u003C\u002Fli\u003E\u003Cli\u003E第二个是\u003Cb\u003EGNOME显示管理器\u003C\u002Fb\u003E（gdm3），它可以处理登录屏幕。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003Eaccounts-daemon漏洞\u003C\u002Fh2\u003E\u003Cp\u003Eaccountsservice守护程序（accounts-daemon）是一项系统服务，可以执行诸如创建新用户帐户或更改用户密码的操作，但也可以执行对安全性较不敏感的操作，例如更改用户的图标或首选语言。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-37e6bd52df4d607ea987135e304b60b4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-37e6bd52df4d607ea987135e304b60b4_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003EUbuntu使用了经过修改的accountservice服务版本，添加了一个名为is_in_pam_environment的函数，该函数会在用户的主目录中查找一个名为.pam_environment的文件并进行读取。\u003C\u002Fp\u003E\u003Cp\u003E将.pam_environment链接到\u002Fdev\u002Fzero可以让accountservice服务被拒绝。\u003C\u002Fp\u003E\u003Cp\u003E因为\u002Fdev\u002Fzero实际上是磁盘上不存在的特殊文件。它由操作系统提供，其行为就像一个无限长的文件，其中每个字节均为0。\u003C\u002Fp\u003E\u003Cp\u003E当is_in_pam_environment尝试读取.pam_environment时，它会通过软链接重定向到\u002Fdev\u002Fzero，然后由于\u002Fdev\u002Fzero无限长而陷入无限循环。\u003C\u002Fp\u003E\u003Cp\u003E如此操作会让accounts-daemon丧失其root权限，转而采用用户的较低特权。然后将SIGSEGV发送给帐户守护程序使其崩溃。\u003C\u002Fp\u003E\u003Ch2\u003EGNOME漏洞\u003C\u002Fh2\u003E\u003Cp\u003EGNOME显示管理器（gdm3）是Ubuntu用户界面的基本组件。它可以处理用户登录和注销时启动和停止用户会话之类的事情，还管理登录屏幕。\u003C\u002Fp\u003E\u003Cp\u003E当用户进行新系统的初始设置时，会启动一个对话框，它其实是一个单独的应用程序，称为gnome-initial-setup。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d2bb6472926dfb82519864d4cf21f490_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-d2bb6472926dfb82519864d4cf21f490_r.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E当gdm3查询到用户数量为0时，会启动这个程序。那么gdm3如何检查系统上有多少用户？通过询问accounts-daemon！\u003C\u002Fp\u003E\u003Cp\u003E不幸的是，accounts-daemon已经被我们前面的操作整崩溃了，所以gdm3在检查超时后认为帐户数量为0，并启动gnome-initial-setup。\u003C\u002Fp\u003E\u003Cp\u003E而初始化设置的用户必须有管理员权限。\u003C\u002Fp\u003E\u003Ch2\u003E官方紧急修复\u003C\u002Fh2\u003E\u003Cp\u003EBackhouse于10月17日向Ubuntu和GNOME维护人员报告了这些错误，官方已经最新代码中提供了修复程序。建议所有Ubuntu用户都尽快安装更新。\u003C\u002Fp\u003E\u003Cp\u003E不过，该漏洞仅对桌面版Ubuntu有效。如果使用的是命令行界面，或者是GNOME之外的其他桌面环境，则暂时不受影响。\u003C\u002Fp\u003E\u003Cp\u003E博客地址：\u003Cbr\u002F\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fsecuritylab.github.com\u002Fresearch\u002FUbuntu-gdm3-accountsservice-LPE\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Esecuritylab.github.com\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eresearch\u002FUbuntu-gdm3-accountsservice-LPE\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E网友讨论：\u003Cbr\u002F\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fnews.ycombinator.com\u002Fitem%3Fid%3D25053238\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Enews.ycombinator.com\u002Fit\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Eem?id=25053238\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E—完—\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.zhihu.com\u002Forg\u002Fliang-zi-wei-48\u002Fcolumns\" class=\"internal\"\u003E@量子位\u003C\u002Fa\u003E · 追踪AI技术和产品新动态\u003C\u002Fp\u003E\u003Cp\u003E深有感触的朋友，欢迎赞同、关注、分享三连վ&#39;ᴗ&#39; ի ❤\u003C\u002Fp\u003E","is_labeled":false,"visited_count":49180},"brief":"{\"source\": \"TS\", \"type\": \"article\", \"id\": 285248052}","uninterest_reasons":[{"reason_id":3,"reason_type":"topic","object_token":"19557067","object_type":"topic","reason_text":"Ubuntu"},{"reason_id":3,"reason_type":"topic","object_token":"19632761","object_type":"topic","reason_text":"Bash"},{"reason_id":3,"reason_type":"topic","object_token":"19554300","object_type":"topic","reason_text":"Linux"},{"reason_id":2,"reason_type":"creator","object_token":"36f69162230003d316d0b8a6d8da20ba","object_type":"people","reason_text":"量子位创作的内容"}],"attached_info":"Cu0CCMicxf7ilp\u002Fk\u002FQEQBxoJMTUxNTE3NjkyIMuurf0FKOoEMD5ABEoNCgRGUkZSEgEwGAAgAFISZmVlZHJlX2FkZF9hcnRpY2xlWgU0MDA2MnIJMjg1MjQ4MDUyeAGCAVBodHRwczovL3BpYzEuemhpbWcuY29tL3YyLTQ0NWZhYzQyMWFhNTViODMwNDQyOWNkOGU1ODdiMGFkX3IuanBnP3NvdXJjZT0xNzJhZTE4YooBBnFiaXRhaaoBCXJlY29tbWVuZPIBOAgAEjRydzotMjEuMDtpc286MzcuMDtiaTowLjA7Y3I6MC4wO3J1bGVzOkN1cnJlbmN5UmFua2Vy8gEFCAsSATHyAQoIDBIGTm9ybWFs8gEoCAoSJDg4NmQxMTkzLWEyMzAtNDI0My04NTUzLWY3MmYyMWZlZTFmMogC9J+Tgu8ukgIgMzZmNjkxNjIyMzAwMDNkMzE2ZDBiOGE2ZDhkYTIwYmGaAgA=","actors":[{"id":"19632761","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19632761","avatar_url":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-a7ec9d26971e38ffa710929331c96dd4_s.jpg","name":"Bash","excerpt":"","introduction":""}],"show_actor_time":false,"action_text":"Bash","action_text_tpl":"热门内容, 来自: {}","action_card":false},{"id":"5_1610348810.731","type":"feed","offset":5,"verb":"TOPIC_ACKNOWLEDGED_ANSWER","created_time":1610348810,"updated_time":1610348810,"target":{"id":1662244682,"type":"answer","url":"https:\u002F\u002Fapi.zhihu.com\u002Fanswers\u002F1662244682","author":{"id":"3ced69919d74a47c8dc35e9140412ff3","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002F3ced69919d74a47c8dc35e9140412ff3","user_type":"people","url_token":"xiao-sheng-lin-9","name":"佳琪小仙女","headline":"大姐姐萌萌哒","avatar_url":"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-6a04e4d480560bf1cc6d49f87e6666d1_m.jpg","is_org":false,"gender":0,"badge":[],"followers_count":3196,"is_following":false,"is_followed":false},"created_time":1609832022,"updated_time":1610265343,"voteup_count":783,"thanks_count":190,"comment_count":536,"is_copyable":true,"question":{"id":377957881,"type":"question","url":"https:\u002F\u002Fapi.zhihu.com\u002Fquestions\u002F377957881","author":{"id":"c268efa6b2c6c05419fc4780be959aff","type":"people","url":"https:\u002F\u002Fapi.zhihu.com\u002Fpeople\u002Fc268efa6b2c6c05419fc4780be959aff","user_type":"people","url_token":"ni-hao-18-5-71","name":"给我自信叫靓女","headline":"怼人精","avatar_url":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-e8022f7b690bbcefa6f4d3d2ac1edbb1_m.jpg","is_org":false,"gender":0,"badge":[],"followers_count":37,"is_following":false,"is_followed":false},"title":"168cm，125斤妹纸，我是不是太胖了？","created":1583726719,"answer_count":5942,"follower_count":8950,"comment_count":80,"bound_topic_ids":[670,14801,28596],"is_following":false,"excerpt":"","relationship":{"is_author":false},"detail":"","question_type":"normal"},"thumbnail":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002Fv2-5d7754f93afe4ff4c9d7b6ec542d1f85_200x112.jpg","excerpt":"我比你矮一点点，最重的时候也有差不多114斤，现在瘦下来一点了，之前也没有人说我胖啊。所以还好吧，应该不算胖，只要整体匀称就可以了，姐妹自信一点最美丽。以前我也觉得自己微胖了，不瘦，没有骨感，而且现在时代变了，流行微胖了，哈哈是吧。 偶们的春天来了，记住，保持身材匀称就欧啦！ 放张图，看看我的小粗腿吧，不说的话你也看不出我有100+斤吧 看了很多评论，我想补充几句。 1，我开头就说了我没有125斤，我最重的时&hellip;","excerpt_new":"我比你矮一点点，最重的时候也有差不多114斤，现在瘦下来一点了，之前也没有人说我胖啊。所以还好吧，应该不算胖，只要整体匀称就可以了，姐妹自信一点最美丽。以前我也觉得自己微胖了，不瘦，没有骨感，而且现在时代变了，流行微胖了，哈哈是吧。 偶们的春天来了，记住，保持身材匀称就欧啦！ 放张图，看看我的小粗腿吧，不说的话你也看不出我有100+斤吧 看了很多评论，我想补充几句。 1，我开头就说了我没有125斤，我最重的时&hellip;","preview_type":"default","preview_text":"","reshipment_settings":"allowed","content":"\u003Cp\u003E我比你矮一点点，最重的时候也有差不多114斤，现在瘦下来一点了，之前也没有人说我胖啊。所以还好吧，应该不算胖，只要整体匀称就可以了，姐妹自信一点最美丽。以前我也觉得自己微胖了，不瘦，没有骨感，而且现在时代变了，流行微胖了，哈哈是吧。 偶们的春天来了，记住，保持身材匀称就欧啦！   \u003C\u002Fp\u003E\u003Cp\u003E放张图，看看我的小粗腿吧，不说的话你也看不出我有100+斤吧\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-1164cb8690c4ed41a09b766b04ada760_hd.jpg?source=1940ef5c\" data-rawwidth=\"1080\" data-rawheight=\"1176\" data-size=\"normal\" data-default-watermark-src=\"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-5130e842c4dc06bba1c5beb74339ec17_hd.jpg?source=1940ef5c\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-1164cb8690c4ed41a09b766b04ada760_r.jpg?source=1940ef5c\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E看了很多评论，我想补充几句。\u003C\u002Fp\u003E\u003Cp\u003E1，我开头就说了我没有125斤，我最重的时候才114，请看仔细。一般体重维持在110左右。还有你们都不看文字只看图的吗？我有说自己身材不好？我是以答题者的身份告诉提问者，只要匀称体重重一点也是可以好看的，好吗？！\u003C\u002Fp\u003E\u003Cp\u003E2，不少评论说我凡尔赛，大概了解了意思。我不是来炫身材的，这确实是真实的我，可能照片美颜过后会比本人好看很多，实际上我的大腿真的不细。\u003C\u002Fp\u003E\u003Cp\u003E3，不少人说我胸大，炫耀。我想说的是，真的只是中等偏上而已，再平常不过了。可能是衣服很修身加上拍照角度比较近的错觉而已。换件不聚拢的内衣和宽松一点的毛衣，也能穿出很平的效果，所以。。。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002F50\u002Fv2-9c19e0ffab37e42f2f7a77877d55ece4_hd.jpg?source=1940ef5c\" data-rawwidth=\"1080\" data-rawheight=\"737\" data-size=\"normal\" data-default-watermark-src=\"https:\u002F\u002Fpic4.zhimg.com\u002F50\u002Fv2-4c0067bd4a6e26cddacfcf663c3e2380_hd.jpg?source=1940ef5c\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-9c19e0ffab37e42f2f7a77877d55ece4_r.jpg?source=1940ef5c\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E最后，不会加好友的，答题只是娱乐一下，分享一下心得罢了，没有其他目的。最多最多有一点小心思是想听大家评论一下自己，打扰了，抱歉\u003C\u002Fp\u003E","mark_infos":[],"relationship":{"is_thanked":false,"is_nothelp":false,"voting":0,"upvoted_followee_ids":[]},"is_labeled":false,"visited_count":168981},"brief":"{\"source\": \"TS\", \"type\": \"answer\", \"id\": 1662244682}","uninterest_reasons":[{"reason_id":3,"reason_type":"topic","object_token":"19635727","object_type":"topic","reason_text":"瘦"},{"reason_id":3,"reason_type":"topic","object_token":"19594665","object_type":"topic","reason_text":"胖"},{"reason_id":3,"reason_type":"topic","object_token":"19552223","object_type":"topic","reason_text":"身材"},{"reason_id":2,"reason_type":"creator","object_token":"3ced69919d74a47c8dc35e9140412ff3","object_type":"people","reason_text":"佳琪小仙女创作的内容"}],"attached_info":"CowDCMicxf7ilp\u002Fk\u002FQEQBBoJMzMyMzAxOTgwINas0P8FKI8GMJgEQAVKDAoDUkVUEgEwGAAgAFIXZmVlZHJlX3RvcGljX2FkZF9hbnN3ZXJaCDQ2MjY5MDUxcgoxNjYyMjQ0NjgyeA6CAUlodHRwczovL3BpYzMuemhpbWcuY29tLzUwL3YyLTVkNzc1NGY5M2FmZTRmZjRjOWQ3YjZlYzU0MmQxZjg1XzIwMHgxMTIuanBnigEJMzc3OTU3ODgxqgEJcmVjb21tZW5k8gFSCAASTnJ3Oi0yMC4wO2lzbzo0MC4wO2JpOjAuMDtjcjowLjA7cnVsZXM6SGlnaEludGVyYWN0aXZlV2VpZ2h0UnVsZSxDdXJyZW5jeVJhbmtlcvIBBQgLEgEx8gEKCAwSBk5vcm1hbPIBKAgKEiRjMTQ0NDE1ZS1mZDViLTRmMDktYjcyYi05YzcyMDM5ZGQxNmOIAvSfk4LvLpICIDNjZWQ2OTkxOWQ3NGE0N2M4ZGMzNWU5MTQwNDEyZmYzmgIA","actors":[{"id":"19552223","type":"topic","url":"https:\u002F\u002Fapi.zhihu.com\u002Ftopics\u002F19552223","avatar_url":"https:\u002F\u002Fpic3.zhimg.com\u002F50\u002F90dcfb4b2cec355b9126ff8fa1a51f34_s.jpeg","name":"身材","excerpt":"","introduction":""}],"show_actor_time":false,"action_text":"身材","action_text_tpl":"热门内容, 来自: {}","action_card":false}],"paging":{"previous":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv3\u002Ffeed\u002Ftopstory\u002Frecommend?session_token=b4d81f3dc95c9a9207fed6008163fc88&desktop=true&page_number=2&limit=6&action=pull&ad_interval=-1&before_id=5","next":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv3\u002Ffeed\u002Ftopstory\u002Frecommend?session_token=b4d81f3dc95c9a9207fed6008163fc88&desktop=true&page_number=2&limit=6&action=down&after_id=5&ad_interval=-1","is_end":false},"fresh_text":"关注动态已更新"}},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"room":{"meta":{},"isFetching":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotListCategories":[],"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}}},"upload":{},"video":{"data":{},"shareVideoDetail":{},"last":{}},"zvideos":{"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"club":{}},"guide":{"guide":{"isFetching":false,"isShowGuide":false}},"reward":{"answer":{},"article":{},"question":{}},"search":{"recommendSearch":[],"topSearch":{},"searchValue":{},"suggestSearch":{},"attachedInfo":{},"nextOffset":{},"topicReview":{},"generalByQuery":{},"generalByQueryInADay":{},"generalByQueryInAWeek":{},"generalByQueryInThreeMonths":{},"peopleByQuery":{},"clubentityByQuery":{},"clubPostByQuery":{},"topicByQuery":{},"columnByQuery":{},"liveByQuery":{},"albumByQuery":{},"eBookByQuery":{},"kmGeneralByQuery":{}},"publicEditPermission":{},"vessay":{"trackData":{"videoTrack":[],"audioTrack":[],"subtitleTrack":[]},"tracks":[],"isLoading":false,"materialLib":{"isLoading":true,"data":[],"paging":{"isEnd":false}},"seekerSecond":0,"player":{"playing":false}},"vessayLoading":{"isLoading":false,"text":""},"readStatus":{},"draftHistory":{"history":{},"drafts":{}},"notifications":{"recent":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"history":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"notificationActors":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"recentNotificationEntry":"all"},"specials":{"entities":{},"all":{"data":[],"paging":{},"isLoading":false}},"collections":{"hot":{"data":[],"paging":{},"isLoading":false},"collectionFeeds":{}},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0},"visible":false}},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"mcnActivity":{"household":{"products":{},"rankList":{"total":{},"yesterday":{}}}},"brand":{"contentPlugin":{}},"host":{"roundtable":{"subjects":{},"applications":{"total":0},"online":{"total":0},"applies":{},"details":{},"includedResource":{},"hotQuestions":{},"warmupContents":{},"batchInclude":{}},"special":{"applications":{"total":0,"pages":{},"entities":{}},"censorHistory":{},"drafts":{}}},"campaign":{"single":{},"list":{},"videoMakerAcq":{},"vote":{},"cardCollecting":{"message":null,"profile":{"balance":"0","chance":0,"coinNum":0,"gatherClose":false,"isGotMagicCard":false,"isPay":false,"partitionStart":false,"totalDone":0,"withdrawStart":false},"sharePoster":{"share":"","sendCard":"","invite":""},"shareLink":null,"shareIntention":"share","shareKey":null,"shareCardId":null,"inviterInfo":null,"giverInfo":null,"prize":null,"receivedCard":null,"newCoinCount":null,"newCardList":[],"newUserCardCount":1,"taskList":[],"prizeList":null,"cardList":null,"panel":{"showTaskPanel":false,"showRewardPanel":false},"modal":{"showWelcomeModal":false,"showFusionModal":false,"showFusionPromptModal":false,"showShareModal":false,"showBackModal":false}},"zhiboPandian2020":null},"knowledgePlan":{"lists":{},"allCreationRankList":{},"featuredQuestions":{}},"wallE":{"protectHistory":{"total":0,"pages":{},"entities":{}}},"roundtables":{"hotQuestions":{},"warmupContents":{},"hotDiscussions":{},"selectedContents":{},"roundtables":{}},"helpCenter":{"entities":{"question":{},"category":{}},"categories":[],"commonQuestions":[],"relatedQuestions":{}},"republish":{},"creatorMCN":{"mcn":{},"mcnStatistics":{},"isNoAuth":false,"creatorManageData":[],"creatorManageDataTotal":1,"mcnDomains":[]}},"subAppName":"main"}</script>
    <script src="./(4 条消息) 首页 - 知乎_files/vendor.8d94b1270b86debd0e1c.js.下载"></script>
    <script src="./(4 条消息) 首页 - 知乎_files/main.app.f8d596eebb4a2286c8e5.js.下载"></script>
    <script src="./(4 条消息) 首页 - 知乎_files/main.topstory-routes.69aa3d7aacb57dc1b600.js.下载"></script>
    <script src="./(4 条消息) 首页 - 知乎_files/hm.js.下载" async=""></script>
    <script src="./(4 条消息) 首页 - 知乎_files/zap.js.下载"></script>
    <div>
        <div style="display: none;">想来知乎工作？请发送邮件到 jobs@zhihu.com</div>
    </div>
    <div>
        <div>
            <div class="css-8pdeid"></div>
        </div>
    </div>
</body>

</html>